/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},r=function(t,e){return t&&i(e)&&t instanceof e},o=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||r(t,Object))},i=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},l=function(t){return t.length},s=function t(n){if(e(n))return n.map((function(e){return t(e)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(n))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(n);if(o(n)){for(var r in n)n[r]=t(n[r]);return n}return"false"!==n&&("null"===n?null:"true"===n||n)},f=function n(){for(var r=arguments.length,u=Array(r),s=0;s<r;s++)u[s]=arguments[s];for(var f=u.shift(),a=0,c=l(u);a<c;++a)for(var d in u[a])if(i(f[d]))if(e(f[d])&&e(u[a][d])){f[d]=[].concat(f[d]);for(var p=0,v=l(u[a][d]);p<v;++p)t(u[a][d][p],f[d])||f[d].push(u[a][d][p])}else o(f[d])&&o(u[a][d])?f[d]=n({},f[d],u[a][d]):f[d]=u[a][d];else f[d]=u[a][d];return f},a=function t(n){if(e(n))return n.map((function(e){return t(n)}));if(o(n)){for(var r in n)n[r]=t(n[r]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},c=document,d=function(t,e){void 0===e&&(e=!0);for(var n,r=t.attributes,o={},i=0,u=r.length;i<u;++i)n=r[i].value,o[r[i].name]=e?s(n):n;return o},p=function(t,e){void 0===e&&(e=!0);var n="innerHTML";if(!g(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},v=function(t){return(t&&t.nodeName||"").toLowerCase()||null},h=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},_=function(t,e){return e?t.closest(e)||null:t.parentNode||null},m=function(t){var e="form";return g(t,e)&&e===v(t.form)?t.form:_(t,e)},b=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},k=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!g(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},w=function(t,e){return t.classList.contains(e)},g=function(t,e){return e in t},y=function(t,e){return t.removeAttribute(e),t},x=function(t,e){return t.classList.remove(e),t},E=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,a(n)),t},L=function(t,e){return t.append(e),e},A=function(t,e){return t.classList.add(e),t},O=function(t,e,n){return t=u(t)?c.createElement(t):t,o(e)&&(n=e,e=!1),u(e)&&T(t,e),o(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?E(t,r,n):y(t,r)}(t,n),t},T=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return g(t,r)&&(t[r]=n?e.trim():e),t};var C=function(t,e,n){e.removeEventListener(t,n)},P=function(t){return t&&t.preventDefault()},I=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)};const D="ArrowDown",H="ArrowUp",K="Enter",M="Escape",N="OptionPicker";function S(t,e){let n,r=this,{self:o,state:i}=r,{n:u}=i;u+="__option",e=e||F(o);for(let o in e){let i=e[o];"data-group"in i[1]?n||L(t,n=O("span",{class:u+"-group","data-value":i[1]["data-group"]})):n=!1;let{disabled:l,selected:s,value:f}=i[1],c=O("span",i[0],{class:u+(l?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":a(f||o),tabindex:!l&&-1});l||(I("blur",c,Q),I("focus",c,V),I("keydown",c,X),I("mousedown",c,Z),I("touchstart",c,Z)),c._of=i[2],c["_"+N]=r,r._options[o]=c,L(n||t,c)}}function B(t,e,n){Object.defineProperty(t,e,n)}function F(t){const e={},n=U(t);if("input"===v(t));else{let r=t.children,o=[];for(let t=0,n=l(r);t<n;++t){let n=r[t],i=d(n);if(["disabled","selected"].forEach((e=>{e in i?(i[e]=""===i[e]||i[e],"selected"===e&&o.push(t)):i[e]=null})),"optgroup"!==v(n))e[n.value]=[k(n)||n.value,i,n];else{let t=F(n);for(let r in t)t[r][1]["data-group"]=n.label,e[r]=t[r]}}0===l(o)&&e[n]&&(e[n][1].selected=!0)}return e}function U(t){return(t.value||"").replace(/\r/g,"")}function $(t){return t.disabled}function q(t){return t.readOnly}function z(t,e){const n=this;return t?r(n,z)?(t["_"+N]=function(t){var e={};return t.hooks=e,t.fire=function(n,r){return i(e[n])?(e[n].forEach((function(e){return e.apply(t,r)})),t):t},t.off=function(n,r){if(!i(n))return e={},t;if(i(e[n]))if(i(r)){for(var o=0,u=e[n].length;o<u;++o)if(r===e[n][o]){e[n].splice(o,1);break}0===j&&delete e[n]}else delete e[n];return t},t.on=function(n,r){return i(e[n])||(e[n]=[]),i(r)&&e[n].push(r),t},t}(n),n.attach(t,f({},z.state,e||{}))):new z(t,e):n}z.state={n:"option-picker",options:null,with:[]},z.version="2.0.0",B(z,"name",{value:N});const G=z.prototype;function J(){let t=this,e=t["_"+N],{state:n}=e,{n:r}=n;x(t,r+="--focus"),x(t,r+="-self")}function Q(){let t=this["_"+N],{mask:e,state:n}=t,{n:r}=n;x(e,r+"--focus-option")}function R(){let t=this,e=t["_"+N],{state:n}=e,{n:r}=n;A(t,r+="--focus"),A(t,r+="-self")}function V(){let t=this["_"+N],{mask:e,state:n}=t,{n:r}=n;A(e,r+"--focus-option")}function W(t){let e,n=t.key,r=this["_"+N];M===n?r.exit(e=!0):D===n||K===n||" "===n?r.enter(e=!0,"down"):H===n&&r.enter(e=!0,"up"),e&&P(t)}function X(t){let e,n=this,r=t.key;t.ctrlKey,t.shiftKey;let o,i,u,l=n["_"+N],{_mask:s,_options:f,mask:a,self:c,state:d}=l,{input:v,value:m}=s,{n:k}=d;if(k+="__option",K===r||M===r||"Tab"===r||" "===r)l.exit(e="Tab"!==r);else if(D===r){for(e=!0,o=h(n);o&&w(o,k+"--disabled");)o=h(o);for(o?w(o,k+"-group")&&(o=o.firstElementChild||null):(i=_(n))&&w(i,k+"-group")&&(o=h(i));o&&w(o,k+"--disabled");)o=h(o);o?(y(n._of,"selected"),x(n,k+"--selected"),o.focus(),E(o._of,"selected",""),A(o,k+"--selected"),T(v||m,p(o))):w(a,d.n+"--open-up")&&l.exit(e)}else if(H===r){for(e=!0,u=b(n);u&&w(u,k+"--disabled");)u=b(u);for(u?w(u,k+"-group")&&(u=function(t){return t.lastElementChild||null}(u)):(i=_(n))&&w(i,k+"-group")&&(u=b(i));u&&w(u,k+"--disabled");)u=b(u);u?(y(n._of,"selected"),x(n,k+"--selected"),u.focus(),E(u._of,"selected",""),A(u,k+"--selected"),T(v||m,p(u))):w(a,d.n+"--open-down")&&l.exit(e)}e&&(P(t),function(t){t&&t.stopPropagation()}(t))}function Y(t){let e=this["_"+N],{state:n}=e,{n:r}=n;e[w(this,r+"--open")?"exit":"enter"](!0),P(t)}function Z(t){let e=this,n=e["_"+N],{_mask:r,_options:o,self:i,state:u}=n,{input:l,value:s}=r,{n:f}=u;f+="__option--selected";for(let t in o){let n=o[t];e!==n&&(y(n._of,"selected"),x(n,f))}E(e._of,"selected",""),A(e,f),T(l||s,p(e)),P(t)}function tt(t){this["_"+N].let().fire("reset",[t])}function et(t){return this["_"+N].fire("submit",[t])}return B(G,"value",{get:function(){let t=this.self.value;return""===t?null:t},set:function(t){this.fire("change")}}),G.attach=function(t,r){let s=this;t=t||s.self,r=r||s.state,s._active=!$(t)&&!q(t),s._options={},s._value=U(t)||null,s.self=t,s.state=r;let f=r.n,a="input"===v(t);const c=O("span",{class:f+"__arrow"}),d=m(t),b=O("div",{class:f,tabindex:!$(t)&&0});s.mask=b;const k=O("div",{class:f+"__options"});let{options:w}=r;n(w)&&(w=w.call(s)),S.call(s,k,w);const g=O("div",{class:f+"__values"}),y=O("span",{class:f+"__"+(a?"text":"value")}),x=O("span",{contenteditable:!($(t)||q(t)||!a)&&"",spellcheck:!!a&&"false"}),j=O("span",a?t.placeholder+"":"");var C,P;L(b,g),L(b,k),L(g,y),L(g,c),a&&(L(y,x),L(y,j)),A(t,f+"__self"),P=b,_(C=t).insertBefore(P,h(C,!0)),d&&(d["_"+N]=s,I("reset",d,tt),I("submit",d,et)),I("blur",b,J),I("focus",b,R),I("keydown",b,W),I("mousedown",b,Y),I("touchstart",b,Y),t.tabIndex=-1,b["_"+N]=s;let D={};D.hint=a?j:null,D.input=a?x:null,D.of=t,D.options=k,D.self=b,D[a?"text":"value"]=y,s._mask=D;let H=s._options[s._value];if(E(H._of,"selected",""),T(a?x:y,p(H)),i(r)&&e(r.with))for(let e=0,i=l(r.with);e<i;++e){let i=r.with[e];u(i)&&(i=z[i]),n(i)?i.call(s,t,r):o(i)&&n(i.attach)&&i.attach.call(s,t,r)}return s},G.blur=function(){},G.detach=function(){let t=this,{_mask:r,mask:i,self:s,state:f}=t;const a=m(s);if(t._active=!1,t._value=U(s)||null,a&&(C("reset",a,tt),C("submit",a,et)),C("blur",i,J),C("focus",i,R),C("keydown",i,W),C("mousedown",i,Y),C("touchstart",i,Y),e(f.with))for(let e=0,r=l(f.with);e<r;++e){let r=f.with[e];u(r)&&(r=z[r]),o(r)&&n(r.detach)&&r.detach.call(t,s,f)}var c;return s.tabIndex=null,x(s,f.n+"__self"),_(c=i),c.remove(),t._mask={of:s},t.mask=null,t},G.enter=function(t,e="down"){let n,r=this,{_options:o,mask:i,self:u,state:l}=r,{n:s}=l;return A(i,s+="--open"),A(i,s+"-"+(e||"down")),r.fire("enter"),t&&(r.fire("focus"),(n=o[u.value])&&n.focus(),r.fire("focus.option")),r},G.exit=function(t,e=["down","up"]){let n=this,{mask:r,state:o}=n,{n:i}=o;return x(r,i+="--open"),u(e)&&(e=[e]),e.forEach((t=>x(r,i+"-"+t))),n.fire("exit"),t&&(r.focus(),n.fire("focus").fire("focus.self")),n},G.focus=function(){},z}));