/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=n()}(this,(function(){"use strict";function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}var n=function(t,n){return-1!==n.indexOf(t)},e=function(t){return Array.isArray(t)},r=function(t){return"function"==typeof t},i=function(t,n){return t&&u(n)&&t instanceof n},o=function(n){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return"object"===t(n)&&(!e||i(n,Object))},u=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},a=function(t){return"string"==typeof t},s=function(t){return t.replace(/[-_.](\w)/g,(function(t,n){return l(n)}))},f=function(t){return t.toLowerCase()},l=function(t){return t.toUpperCase()},c=function(t){return t.length},v=function(t){return Object.values(t)},d=function(t){if(e(t))return t.map((function(t){return d(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(t))return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return n?parseInt(t,n):parseFloat(t)}(t);if(o(t)){for(var n in t)t[n]=d(t[n]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},p=function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=r.shift(),s=0,f=c(r);s<f;++s)for(var l in r[s])if(u(a[l]))if(e(a[l])&&e(r[s][l])){a[l]=[].concat(a[l]);for(var v=0,d=c(r[s][l]);v<d;++v)n(r[s][l][v],a[l])||a[l].push(r[s][l][v])}else o(a[l])&&o(r[s][l])?a[l]=p({},a[l],r[s][l]):a[l]=r[s][l];else a[l]=r[s][l];return a},h=function(t){if(e(t))return t.map((function(n){return h(t)}));if(o(t)){for(var n in t)t[n]=h(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},m=document,_=window,g=m.body,b=m.documentElement,k=function(t){return t.firstElementChild||null},y=function(t){return t.lastElementChild||null},x=function(t,n){var e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=function(t,n){var e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!C(t,n))return null;var r=t.getAttribute(n);return e?d(r):r}(t,"data-"+n,e),i=(r+"").trim();return e&&i&&("["===i[0]&&"]"===i.slice(-1)||"{"===i[0]&&"}"===i.slice(-1))&&null!==(i=function(t){var n=null;try{n=JSON.parse(t)}catch(t){}return n}(r))?i:r},w=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e="innerHTML";if(!j(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},E=function(t){return f(t&&t.nodeName||"")||null},S=function(t,n){return t["next"+(n?"":"Element")+"Sibling"]||null},T=function(t,n){return n?t.closest(n)||null:t.parentNode||null},L=function(t){var n="form";return j(t,n)&&n===E(t[n])?t[n]:T(t,n)},O=function(t,n){return t["previous"+(n?"":"Element")+"Sibling"]||null},A=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e="textContent";if(!j(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},C=function(t,n){return t.hasAttribute(n)},M=function(t,n){return t.classList.contains(n)},j=function(t,n){return n in t},N=function(t,n){return t.removeAttribute(n),t},R=function(t,n){return t.classList.remove(n),t},K=function(t,n){return t.style[s(n)]=null,t},P=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,h(e)),t},z=function(t,n){return t.append(n),n},B=function(t,n){return t.classList.add(n),t},D=function(t,n,r){return(e(r)||o(r))&&(r=JSON.stringify(r)),P(t,"data-"+n,r)},H=function(t,n,e){return t=a(t)?m.createElement(t):t,o(n)&&(e=n,n=!1),a(n)&&I(t,n),o(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?P(t,r,e):N(t,r)}(t,e),t},I=function(t,n){var e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null===n)return t;var r="innerHTML";return j(t,r)&&(t[r]=e?n.trim():n),t},J=function(t,n,e){return"number"==typeof e&&(e+="px"),t.style[s(n)]=h(e),t},U=function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?J(t,r,e):K(t,r);return t},W=function(t,n){var e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null===n)return t;var r="textContent";return j(t,r)&&(t[r]=e?n.trim():n),t},F=function(t,n){var e;return function(){var r=arguments,i=this;e&&clearTimeout(e),e=setTimeout((function(){return t.apply(i,r)}),n)}},X=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}},Y=function(t){var n,e,r,i,o,u,a;return!function(t){return t===_}(t)?(i=(e=t.getBoundingClientRect()).left,o=e.top,r=e.width,n=e.height,u=e.right,a=e.bottom):(i=t.pageXOffset||b.scrollLeft||g.scrollLeft,o=t.pageYOffset||b.scrollTop||g.scrollTop,r=t.innerWidth,n=t.innerHeight),[i,o,r,n,u,a]};var $=function(t,n,e){n.removeEventListener(t,e)},q=function(t){return t&&t.preventDefault()},G=function(t){return t&&t.stopPropagation()},Q=function(t,n,e){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n.addEventListener(t,e,r)},V="ArrowDown",Z="ArrowUp",tt="Backspace",nt="Delete",et="Enter",rt="Escape",it="Tab",ot=F((function(t){return t.fit()}),10),ut=new WeakMap;function at(t,n){var e,r=this,o=r.self,u=r.state.n;u+="__option",(n=i(n,Map)&&n.size>0?n:lt(o)).forEach((function(n,i){"data-group"in n[1]?e&&x(e,"value",!1)===n[1]["data-group"]||z(t,e=H("span",{class:u+"-group","data-value":n[1]["data-group"]})):e=!1;var o=n[1],a=o.disabled,s=o.selected,f=o.value,l=H("span",n[0],{class:u+(a?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":h(f||i),tabindex:!a&&-1});a||(Q("blur",l,kt),Q("focus",l,Et),Q("keydown",l,Ct),Q("mousedown",l,Nt),Q("touchstart",l,Nt)),l._of=n[2],r._options[i]=l,z(e||t,l),ht(l,r)})),r.state.options=n}function st(t,n,e){Object.defineProperty(t,n,e)}function ft(t){t.focus()}function lt(t){var n,e,r=new Map,i=vt(t),o=[];e="input"===E(t)?(e=t.list)?e.children:[]:t.children;for(var u=function(t){var n=e[t],i=function(t){for(var n,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t.attributes,i={},o=0,u=r.length;o<u;++o)n=r[o].value,i[r[o].name]=e?d(n):n;return i}(n);if(["disabled","selected"].forEach((function(n){n in i?(i[n]=""===i[n]||i[n],"selected"===n&&o.push(t)):i[n]=null})),"optgroup"===E(n))return lt(n).forEach((function(t,e){t[1]["data-group"]=n.label,r.set(e,t)})),1;r.set(n.value,[A(n)||n.value,i,n])},a=0,s=c(e);a<s;++a)u(a);return 0===c(o)&&(n=r.get(i))&&(n[1].selected=!0,r.set(i,n)),r}function ct(t){return ut.get(t)}function vt(t){return(t.value||"").replace(/\r/g,"")}function dt(t){return t.disabled}function pt(t){return t.readOnly}function ht(t,n){return ut.set(t,n)}function mt(t,n){var e=this;return t?i(e,mt)?(ht(t,function(t,n){return(n=n||t).fire=function(t,n,e){var r=this,i=r.hooks;return u(i[t])?(i[t].forEach((function(t){return t.apply(e||r,n)})),r):r},n.off=function(t,n){var e=this,r=e.hooks;if(!u(t))return r={},e;if(u(r[t]))if(u(n)){var i=r[t].length;if(0===i)delete r[t];else for(var o=0;o<i;++o)if(n===r[t][o]){r[t].splice(o,1);break}}else delete r[t];return e},n.on=function(t,n){var e=this.hooks;return u(e[t])||(e[t]=[]),u(n)&&e[t].push(n),this},t.hooks={},t}(e,mt.prototype)),e.attach(t,p({},mt.state,n||{}))):new mt(t,n):e}mt.from=function(t,n){return new mt(t,n)},mt.of=ct,mt.state={n:"option-picker",options:null,with:[]},mt.version="2.0.0",st(mt,"name",{value:"OptionPicker"});var _t=mt.prototype;st(_t,"value",{get:function(){var t=vt(this.self);return""===t?null:t},set:function(t){this.fire("change",[d(t)])}});var gt=F((function(t,e,r,i){var o=a(e)?e:A(e)||"",u=f(o),s=t._mask,l=t.self,v=t.state,p=s.value,h=v.n;if(h+="__option",i){var m,_=vt(l);for(var g in r){var b=r[g];N(b._of,"selected"),R(b,h+"--selected")}for(var k in r){var y=r[k],E=f(A(y)+"\t"+(m=x(y,"value",!1)));if(""!==u&&u===E.slice(0,c(u))&&!M(y,h+"--disabled")){l.value=m,P(y._of,"selected",""),B(y,h+"--selected"),D(p,"value",m),I(p,w(y)),m!==_&&t.fire("change",[d(m)]);break}}}else for(var S in r){var T=r[S],L=f(A(T)+"\t"+x(T,"value",!1));""!==u&&!n(u,L)||M(T,h+"--disabled")?P(T,"hidden",""):N(T,"hidden")}t.fire(i?"search":"filter",[o])}),10);function bt(){var t=this,n=ct(t).state.n;R(t,n+="--focus"),R(t,n+="-self")}function kt(){var t=this,n=ct(t);n.mask;var e=n.state.n;R(t,e+="--focus"),R(t,e+="-option")}function yt(){var t=ct(this),n=t._mask,e=t.mask,r=t.state,i=n.text,o=r.n;R(e,o+"--focus-text"),R(i,o+"__text--focus")}function xt(){var t=this,n=ct(t),e=n._mask,r=n.self,i=e.hint;X((function(){return W(i,A(t,!1)?"":r.placeholder)}),1)()}function wt(){var t=this,n=ct(t).state.n;B(t,n+="--focus"),B(t,n+="-self")}function Et(){var t=ct(this),n=t.mask,e=t.state.n;Dt(),B(n,e+="--focus"),B(n,e+="-option")}function St(){var t=ct(this),n=t._mask,e=t.mask;t.self;var r=t.state,i=n.input,o=n.text,u=r.n;B(o,u+"__text--focus"),B(e,u+="--focus"),B(e,u+="-text"),A(i,!1)?Ht(this):t.enter().fit()}function Tt(t){var n,e=this,r=t.key,i=ct(e),o=i._mask,u=i._options,a=i.self,s=i.state,f=o.hint,l=s.n;if(l+="__option--disabled",X((function(){return W(f,A(e,!1)?"":a.placeholder)}),1)(),tt!==r&&nt!==r&&1!==c(r)||X((function(){return i.enter().fit()}),11)(),V===r||Z===r||et===r){var d=u[vt(a)];if(!d||d.hidden)for(d=v(u).shift();d&&(M(d,l)||d.hidden);)d=S(d);d&&ft(d),n=!0}else it===r?i.exit():gt(i,e,u);n&&(q(t),G(t))}var Lt="",Ot=F((function(){return Lt=""}),500);function At(t){var n,e=t.key,r=t.altKey,i=t.ctrlKey,o=ct(this),u=o._options;Ot(),tt===e||nt===e?Lt="":rt===e?(Lt="",o.exit(n=!0)):it===e?(Lt="",o.exit(!(n=!1))):V===e||Z===e||et===e||""===Lt&&" "===e?o.enter(n=!0).fit():1!==c(e)||r||i||(Lt+=e),""!==Lt&&gt(o,Lt,u,n=!0),n&&q(t)}function Ct(t){var n,e=this,r=t.key,i=t.altKey,o=t.ctrlKey,u=ct(e),a=u._mask,s=u._options;u.mask;var f=u.self,l=u.state,p=a.hint,h=a.input,m=a.value,_=l.n;_+="__option";var g,b,L,C="input"===E(f);if(tt===r)u.exit(n=!0);else if(et===r||rt===r||it===r||" "===r){if(rt!==r){var j,K=vt(f);(L=s[vt(f)])&&(N(L._of,"selected"),R(L,_+"--selected")),P(e._of,"selected",""),B(e,_+"--selected"),f.value=j=x(e,"value",!1),C?(W(p,""),W(h,A(e))):(D(m,"value",j),I(m,w(e))),j!==K&&u.fire("change",[d(j)])}u.exit(n=it!==r)}else if(V===r){for(n=!0,g=S(e);g&&(M(g,_+"--disabled")||g.hidden);)g=S(g);for(g?M(g,_+"-group")&&(g=k(g)):((b=T(e))&&M(b,_+"-group")&&(g=S(b)),g&&M(g,_+"-group")&&(g=k(g)));g&&(M(g,_+"--disabled")||g.hidden);)g=S(g);if(g)ft(g);else{var z=v(s).find((function(t){return!t.hidden&&!M(t,_+"--disabled")}));z&&ft(z)}}else if(Z===r){for(n=!0,L=O(e);L&&(M(L,_+"--disabled")||L.hidden);)L=O(L);for(L?M(L,_+"-group")&&(L=y(L)):((b=T(e))&&M(b,_+"-group")&&(L=O(b)),L&&M(L,_+"-group")&&(L=y(L)));L&&(M(L,_+"--disabled")||L.hidden);)L=O(L);if(L)ft(L);else{var H=v(s).findLast((function(t){return!t.hidden&&!M(t,_+"--disabled")}));H&&ft(H)}}else C&&1===c(r)&&!i&&!o&&W(p,""),u.exit(!(n=!1));n&&(q(t),G(t))}function Mt(){var t=this,n=ct(t),e=n._mask,r=n.self,i=e.hint;X((function(){return W(t,A(t))}))(),X((function(){return W(i,A(t,!1)?"":r.placeholder)}),1)()}function jt(t){var n=ct(this),e=n.state.n;n[M(this,e+"--open")?"exit":"enter"](!0).fit(),q(t)}function Nt(t){var n=this,e=ct(n),r=e._mask,i=e._options,o=e.self,u=e.state,a=r.hint,s=r.input,f=r.value,l=u.n;l+="__option--selected";var c,v=vt(o);for(var p in i){var h=i[p];n!==h&&(N(h._of,"selected"),R(h,l))}P(n._of,"selected",""),B(n,l),o.value=c=x(n,"value",!1),"input"===E(o)?(W(a,""),W(s,A(n))):(D(f,"value",c),I(f,w(n))),c!==v&&e.fire("change",[d(c)]),q(t)}function Rt(t){var n=ct(this);if(n){var e=n.mask,r=n.state.n,i=t.target;e!==i&&e!==T(i,"."+r)&&(n.exit(),ut.delete(this))}}function Kt(t){ct(this).let().fire("reset",[t])}function Pt(){var t=ct(this);t&&ot(t)}function zt(){Pt.call(this)}function Bt(t){return ct(this).fire("submit",[t])}function Dt(t){var n=m.getSelection();n.rangeCount&&n.removeRange(n.getRangeAt(0))}function Ht(t,n){var e=m.getSelection();Dt();var r=m.createRange();r.selectNodeContents(t),e.addRange(r),1===n?e.collapseToEnd():-1===n&&e.collapseToStart()}return _t.attach=function(t,n){var i=this;t=t||i.self,n=n||i.state,i._active=!dt(t)&&!pt(t),i._options={},i._value=vt(t)||null,i.self=t,i.state=n;var s="input"===E(t),f=n.n,l=H("span",{class:f+"__arrow"}),v=L(t),d=H("div",{class:f,tabindex:!dt(t)&&!s&&0});i.mask=d;var p=H("div",{class:f+"__options"}),h=n.options;r(h)&&(h=h.call(i));var m=new Map;if(e(h))h.forEach((function(t){var n,r;e(t)?(t[0]=null!==(n=t[0])&&void 0!==n?n:"",t[1]=null!==(r=t[1])&&void 0!==r?r:{},m.set(t[0],t)):m.set(t,[t,{}])}));else if(o(h))for(var g in h){var k,y;if(e(h[g]))h[g][0]=null!==(k=h[g][0])&&void 0!==k?k:"",h[g][1]=null!==(y=h[g][1])&&void 0!==y?y:{};else m.set(g,[h[g],{}])}at.call(i,p,h=m);var O,C,M=H("div",{class:f+"__values"}),j=H("span",{class:f+"__"+(s?"text":"value")}),N=H("span",{contenteditable:!(dt(t)||pt(t)||!s)&&"",spellcheck:!!s&&"false"}),R=H("span",s?t.placeholder+"":"");z(d,M),z(d,p),z(M,j),z(M,l),s?(Q("blur",N,yt),Q("cut",N,xt),Q("focus",N,St),Q("keydown",N,Tt),Q("paste",N,Mt),z(j,N),z(j,R),ht(N,i)):(Q("blur",d,bt),Q("focus",d,wt),Q("keydown",d,At)),B(t,f+"__self"),C=d,T(O=t).insertBefore(C,S(O,!0)),v&&(Q("reset",v,Kt),Q("submit",v,Bt),ht(v,i)),Q("mousedown",b,Rt),Q("mousedown",d,jt),Q("resize",_,Pt),Q("scroll",_,zt),Q("touchstart",b,Rt),Q("touchstart",d,jt),t.tabIndex=-1,ht(d,i);var K,J={};if(J.hint=s?R:null,J.input=s?N:null,J.of=t,J.options=p,J.root=b,J.self=d,J[s?"text":"value"]=j,i._mask=J,(K=i._options[i._value])&&(P(K._of,"selected",""),s?(W(N,A(K)),A(N,!1)&&W(R,"")):(D(j,"value",x(K,"value",!1)),I(j,w(K)))),u(n)&&e(n.with))for(var U=0,F=c(n.with);U<F;++U){var X=n.with[U];a(X)&&(X=mt[X]),r(X)?X.call(i,t,n):o(X)&&r(X.attach)&&X.attach.call(i,t,n)}return i},_t.blur=function(){Dt();var t=this,n=t._mask,e=t.mask;return(n.input||e).blur(),t.exit()},_t.detach=function(){var t,n=this,i=n._mask,u=n.mask,s=n.self,f=n.state,l=i.input,v=L(s);if(n._active=!1,n._value=vt(s)||null,v&&($("reset",v,Kt),$("submit",v,Bt)),l&&($("blur",l,yt),$("blur",u,bt),$("cut",l,xt),$("focus",l,St),$("focus",u,wt),$("keydown",l,Tt),$("keydown",u,At),$("paste",l,Mt)),$("mousedown",b,Rt),$("mousedown",u,jt),$("resize",_,Pt),$("scroll",_,zt),$("touchstart",b,Rt),$("touchstart",u,jt),e(f.with))for(var d=0,p=c(f.with);d<p;++d){var h=f.with[d];a(h)&&(h=mt[h]),o(h)&&r(h.detach)&&h.detach.call(n,s,f)}return s.tabIndex=null,R(s,f.n+"__self"),T(t=u),t.remove(),n._mask={of:s},n.mask=null,n},_t.enter=function(t){var n,e=this,r=e._mask,i=e._options,o=e.mask,u=e.self,a=e.state,s=r.input,f=a.n;B(o,f+"--focus"),B(o,f+"--focus-option"),B(o,f+="--open");var l=ct(b);return l&&e!==l&&l.exit(),ht(b,e),ht(_,e),e.fire("enter"),t&&(e.fire("focus"),"input"===E(u)?(ft(s),Ht(s)):(n=i[vt(u)])&&ft(n),e.fire("focus.option")),e},_t.exit=function(t){var n=this,e=n._mask,r=n.mask,i=n.self,o=n.state,u=e.input,a=o.n;return R(r,a+"--focus"),R(r,a+"--focus-option"),R(r,a+="--open"),n.fire("exit"),t&&("input"===E(i)?(ft(u),Ht(u)):ft(r),n.fire("focus").fire("focus.self")),n},_t.fit=function(){var t=this,n=t._mask,e=t.mask,r=n.options,i=Y(e),o=Y(_);return i[1]+i[3]/2>o[3]/2?U(r,{bottom:"100%","max-height":i[1],top:"auto"}):U(r,{bottom:"auto","max-height":o[3]-i[1]-i[3],top:"100%"}),t},_t.focus=function(t){var n=this,e=n._mask,r=n.mask,i=e.input;return i?(ft(i),Ht(i,t),n):(r&&ft(r),n)},mt}));