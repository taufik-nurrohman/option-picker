/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=n()}(this,(function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},r=function(t,n,e){return!(!t||"object"!=typeof t)&&(e?o(n)&&o(t.constructor)&&n===t.constructor:o(n)&&t instanceof n)},i=function(t,n){return void 0===n&&(n=!0),!(!t||"object"!=typeof t)&&(!n||r(t,Object,1))},o=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},a=function(t){return t.replace(/[-_.](\w)/g,(function(t,n){return f(n)}))},s=function(t){return t.toLowerCase()},f=function(t){return t.toUpperCase()},c=function(t){return t.length},l=function(t){return Object.values(t)},v=function(t){if(n(t))return t.map((function(t){return v(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(t))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(t);if(i(t)){for(var e in t)t[e]=v(t[e]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},d=function(){for(var e=arguments.length,r=Array(e),u=0;u<e;u++)r[u]=arguments[u];for(var a=r.shift(),s=0,f=c(r);s<f;++s)for(var l in r[s])if(o(a[l]))if(n(a[l])&&n(r[s][l])){a[l]=[].concat(a[l]);for(var v=0,p=c(r[s][l]);v<p;++v)t(r[s][l][v],a[l])||a[l].push(r[s][l][v])}else i(a[l])&&i(r[s][l])?a[l]=d({},a[l],r[s][l]):a[l]=r[s][l];else a[l]=r[s][l];return a},p=function(t){if(n(t))return t.map((function(n){return p(t)}));if(i(t)){for(var e in t)t[e]=p(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},h=document,m=window,_=h.body,g=h.documentElement,b=function(t){return t.firstElementChild||null},k=function(t){return t.lastElementChild||null},w=function(t,n,e){var r=function(t,n,e){if(void 0===e&&(e=!0),!C(t,n))return null;var r=t.getAttribute(n);return e?v(r):r}(t,"data-"+n,e);return r},y=function(t,n){void 0===n&&(n=!0);var e="innerHTML";if(!M(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},x=function(t){return s(t&&t.nodeName||"")||null},T=function(t,n){return t["next"+(n?"":"Element")+"Sibling"]||null},E=function(t,n){return n?t.closest(n)||null:t.parentNode||null},L=function(t){var n="form";return M(t,n)&&n===x(t[n])?t[n]:E(t,n)},A=function(t,n){return t["previous"+(n?"":"Element")+"Sibling"]||null},O=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!M(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},C=function(t,n){return t.hasAttribute(n)},j=function(t,n){return t.classList.contains(n)},M=function(t,n){return n in t},S=function(t,n){return t.removeAttribute(n),t},R=function(t,n){return t.classList.remove(n),t},Y=function(t,n){return t.style[a(n)]=null,t},K=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,p(e)),t},N=function(t,n){return t.append(n),n},P=function(t,n){return t.classList.add(n),t},z=function(t,e,r){return(n(r)||i(r))&&(r=JSON.stringify(r)),K(t,"data-"+e,r)},B=function(t,n,e){return t=u(t)?h.createElement(t):t,i(n)&&(e=n,n=!1),u(n)&&D(t,n),i(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?K(t,r,e):S(t,r)}(t,e),t},D=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return M(t,r)&&(t[r]=e?n.trim():n),t},H=function(t,n,e){return"number"==typeof e&&(e+="px"),t.style[a(n)]=p(e),t},I=function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?H(t,r,e):Y(t,r);return t},U=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return M(t,r)&&(t[r]=e?n.trim():n),t},W=function(t,n){var e;return function(){var r=arguments,i=this;e&&clearTimeout(e),e=setTimeout((function(){return t.apply(i,r)}),n)}},F=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}},J=function(t){var n,e,r,i,o,u,a;return!function(t){return t===m}(t)?(i=(e=t.getBoundingClientRect()).left,o=e.top,r=e.width,n=e.height,u=e.right,a=e.bottom):(i=t.pageXOffset||g.scrollLeft||_.scrollLeft,o=t.pageYOffset||g.scrollTop||_.scrollTop,r=t.innerWidth,n=t.innerHeight),[i,o,r,n,u,a]};var X=function(t,n,e){n.removeEventListener(t,e)},$=function(t){return t&&t.preventDefault()},q=function(t){return t&&t.stopPropagation()},G=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},Q="ArrowDown",V="ArrowUp",Z="Backspace",tt="Delete",nt="Enter",et="Escape",rt="Tab",it=W((function(t){return t.fit()}),10),ot=new WeakMap;function ut(t,n){var e,i=this,o=i.self,u=i.state.n;u+="__option",ct(n=r(n,Map)&&n.size>0?n:lt(o),(function(n,r){"data-group"in n[1]?e&&w(e,"value",!1)===n[1]["data-group"]||N(t,e=B("span",{class:u+"-group","data-value":n[1]["data-group"]})):e=!1;var o=n[1],a=o.disabled,s=o.selected,f=o.value,c=B("span",n[0],{class:u+(a?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":p(f||r),tabindex:!a&&-1});a||(G("blur",c,xt),G("focus",c,At),G("keydown",c,Rt),G("mousedown",c,Nt),G("touchstart",c,Nt)),c._of=n[2],i._options[r]=c,N(e||t,c),_t(c,i)})),i.state.options=n}function at(t,n,e){Object.defineProperty(t,n,e)}function st(t){t.focus()}function ft(t,n){t.forEach(n)}function ct(t,n){ft(t,n)}function lt(t){var n,e,r=new Map,i=dt(t),o=[];e="input"===x(t)?(e=t.list)?e.children:[]:t.children;for(var u=function(t){var n=e[t],i=function(t,n){void 0===n&&(n=!0);for(var e,r=t.attributes,i={},o=0,u=r.length;o<u;++o)e=r[o].value,i[r[o].name]=n?v(e):e;return i}(n);if(ft(["disabled","selected"],(function(n){n in i?(i[n]=""===i[n]||i[n],"selected"===n&&o.push(t)):i[n]=null})),"optgroup"===x(n))return ct(lt(n),(function(t,e){t[1]["data-group"]=n.label,gt(e,t,r)})),1;gt(n.value,[O(n)||n.value,i,n],r)},a=0,s=c(e);a<s;++a)u(a);return 0===c(o)&&(n=pt(i,r))&&(n[1].selected=!0,gt(i,n,r)),r}function vt(t){return pt(t,ot)||null}function dt(t){return(t.value||"").replace(/\r/g,"")}function pt(t,n){return n.get(t)}function ht(t){return t.disabled}function mt(t){return t.readOnly}function _t(t,n){return gt(t,n,ot)}function gt(t,n,e){return e.set(t,n)}function bt(t,n){var e=this;return t?r(e,bt)?(_t(t,function(t,n){return(n=n||t).fire=function(t,n,e){var r=this,i=r.hooks;return o(i[t])?(i[t].forEach((function(t){return t.apply(e||r,n)})),r):r},n.off=function(t,n){var e=this,r=e.hooks;if(!o(t))return r={},e;if(o(r[t]))if(o(n)){var i=r[t].length;if(0===i)delete r[t];else for(var u=0;u<i;++u)if(n===r[t][u]){r[t].splice(u,1);break}}else delete r[t];return e},n.on=function(t,n){var e=this.hooks;return o(e[t])||(e[t]=[]),o(n)&&e[t].push(n),this},t.hooks={},t}(e,bt.prototype)),e.attach(t,d({},bt.state,n||{}))):new bt(t,n):e}bt.from=function(t,n){return new bt(t,n)},bt.of=vt,bt.state={n:"option-picker",options:null,with:[]},bt.version="2.0.0",at(bt,"name",{value:"OptionPicker"});var kt=bt.prototype;at(kt,"value",{get:function(){var t=dt(this.self);return""===t?null:t},set:function(t){this.fire("change",[v(t)])}});var wt=W((function(n,e,r,i){var o=u(e)?e:O(e)||"",a=s(o),f=n._mask,l=n.self,d=n.state,p=f.value,h=d.n;if(h+="__option",i){var m,_=dt(l);for(var g in r){var b=r[g];S(b._of,"selected"),R(b,h+"--selected")}for(var k in r){var x=r[k],T=s(O(x)+"\t"+(m=w(x,"value",!1)));if(""!==a&&a===T.slice(0,c(a))&&!j(x,h+"--disabled")){l.value=m,K(x._of,"selected",""),P(x,h+"--selected"),z(p,"value",m),D(p,y(x)),m!==_&&n.fire("change",[v(m)]);break}}}else for(var E in r){var L=r[E],A=s(O(L)+"\t"+w(L,"value",!1));""!==a&&!t(a,A)||j(L,h+"--disabled")?K(L,"hidden",""):S(L,"hidden")}n.fire(i?"search":"filter",[o])}),10);function yt(){var t=this,n=vt(t).state.n;R(t,n+="--focus"),R(t,n+="-self")}function xt(){var t=this,n=vt(t);n.mask;var e=n.state.n;R(t,e+="--focus"),R(t,e+="-option")}function Tt(){var t=vt(this),n=t._mask,e=t.mask,r=t.state,i=n.text,o=r.n;R(e,o+"--focus-text"),R(i,o+"__text--focus")}function Et(){var t=this,n=vt(t),e=n._mask,r=n.self,i=e.hint;F((function(){return U(i,O(t,!1)?"":r.placeholder)}),1)()}function Lt(){var t=this,n=vt(t).state.n;P(t,n+="--focus"),P(t,n+="-self")}function At(){var t=vt(this),n=t.mask,e=t.state.n;Ft(),P(n,e+="--focus"),P(n,e+="-option")}function Ot(){var t=vt(this),n=t._mask,e=t.mask;t.self;var r=t.state,i=n.input,o=n.text,u=r.n;P(o,u+"__text--focus"),P(e,u+="--focus"),P(e,u+="-text"),O(i,!1)?Jt(this):t.enter().fit()}function Ct(t){var n,e=this,r=t.key,i=vt(e),o=i._mask,u=i._options,a=i.self,s=i.state,f=o.hint,v=s.n;if(v+="__option--disabled",F((function(){return U(f,O(e,!1)?"":a.placeholder)}),1)(),Z!==r&&tt!==r&&1!==c(r)||F((function(){return i.enter().fit()}),11)(),Q===r||V===r||nt===r){var d=u[dt(a)];if(!d||d.hidden)for(d=l(u).shift();d&&(j(d,v)||d.hidden);)d=T(d);d&&st(d),n=!0}else rt===r?i.exit():wt(i,e,u);n&&($(t),q(t))}var jt="",Mt=W((function(){return jt=""}),500);function St(t){var n,e=t.key,r=t.altKey,i=t.ctrlKey,o=vt(this),u=o._options;Mt(),Z===e||tt===e?jt="":et===e?(jt="",o.exit(n=!0)):rt===e?(jt="",o.exit(!(n=!1))):Q===e||V===e||nt===e||""===jt&&" "===e?o.enter(n=!0).fit():1!==c(e)||r||i||(jt+=e),""!==jt&&wt(o,jt,u,n=!0),n&&$(t)}function Rt(t){var n,e=this,r=t.key,i=t.altKey,o=t.ctrlKey,u=vt(e),a=u._mask,s=u._options;u.mask;var f=u.self,d=u.state,p=a.hint,h=a.input,m=a.value,_=d.n;_+="__option";var g,L,C,M="input"===x(f);if(Z===r)u.exit(n=!0);else if(nt===r||et===r||rt===r||" "===r){if(et!==r){var Y,N=dt(f);(C=s[dt(f)])&&(S(C._of,"selected"),R(C,_+"--selected")),K(e._of,"selected",""),P(e,_+"--selected"),f.value=Y=w(e,"value",!1),M?(U(p,""),U(h,O(e))):(z(m,"value",Y),D(m,y(e))),Y!==N&&u.fire("change",[v(Y)])}u.exit(n=rt!==r)}else if(Q===r){for(n=!0,g=T(e);g&&(j(g,_+"--disabled")||g.hidden);)g=T(g);for(g?j(g,_+"-group")&&(g=b(g)):((L=E(e))&&j(L,_+"-group")&&(g=T(L)),g&&j(g,_+"-group")&&(g=b(g)));g&&(j(g,_+"--disabled")||g.hidden);)g=T(g);if(g)st(g);else{var B=l(s).find((function(t){return!t.hidden&&!j(t,_+"--disabled")}));B&&st(B)}}else if(V===r){for(n=!0,C=A(e);C&&(j(C,_+"--disabled")||C.hidden);)C=A(C);for(C?j(C,_+"-group")&&(C=k(C)):((L=E(e))&&j(L,_+"-group")&&(C=A(L)),C&&j(C,_+"-group")&&(C=k(C)));C&&(j(C,_+"--disabled")||C.hidden);)C=A(C);if(C)st(C);else{var H=l(s).findLast((function(t){return!t.hidden&&!j(t,_+"--disabled")}));H&&st(H)}}else M&&1===c(r)&&!i&&!o&&U(p,""),u.exit(!(n=!1));n&&($(t),q(t))}function Yt(){var t=this,n=vt(t),e=n._mask,r=n.self,i=e.hint;F((function(){return U(t,O(t))}))(),F((function(){return U(i,O(t,!1)?"":r.placeholder)}),1)()}function Kt(t){var n=vt(this),e=n.state.n,r=t.target;$(t),j(r,e+"__options")||E(r,"."+e+"__options")||n[j(this,e+"--open")?"exit":"enter"](!0).fit()}function Nt(t){var n=this,e=vt(n),r=e._mask,i=e._options,o=e.self,u=e.state,a=r.hint,s=r.input,f=r.value,c=u.n;c+="__option--selected";var l,d=dt(o);for(var p in i){var h=i[p];n!==h&&(S(h._of,"selected"),R(h,c))}K(n._of,"selected",""),P(n,c),o.value=l=w(n,"value",!1),"input"===x(o)?(U(a,""),U(s,O(n))):(z(f,"value",l),D(f,y(n))),l!==d&&e.fire("change",[v(l)]),e.exit(!0),$(t)}var Pt=!1;function zt(t){Pt=t.changedTouches?t.changedTouches[0].clientY:t.clientY;var n=vt(this);if(n){var e,r=n.mask,i=n.state.n,o=t.target;r!==o&&r!==E(o,"."+i)&&(e=this,ot.delete(e),n.exit())}}function Bt(t){if(!1!==Pt){var n=t.changedTouches?t.changedTouches[0].clientY:t.clientY;n>Pt?(console.log("swipe down"),"touchmove"===t.type&&alert("swipe down")):n<Pt&&(console.log("swipe up"),"touchmove"===t.type&&alert("swipe up"))}}function Dt(){Pt=!1}function Ht(t){vt(this).let().fire("reset",[t])}function It(){var t=vt(this);t&&it(t)}function Ut(){It.call(this)}function Wt(t){return vt(this).fire("submit",[t])}function Ft(t){var n=h.getSelection();n.rangeCount&&n.removeRange(n.getRangeAt(0))}function Jt(t,n){var e=h.getSelection();Ft();var r=h.createRange();r.selectNodeContents(t),e.addRange(r),1===n?e.collapseToEnd():-1===n&&e.collapseToStart()}return kt.attach=function(t,r){var a=this;t=t||a.self,r=r||a.state,a._active=!ht(t)&&!mt(t),a._options={},a._value=dt(t)||null,a.self=t,a.state=r;var s="input"===x(t),f=r.n,l=B("span",{class:f+"__arrow"}),v=L(t),d=B("div",{class:f,tabindex:!ht(t)&&!s&&0});a.mask=d;var p=B("div",{class:f+"__options"}),h=r.options;e(h)&&(h=h.call(a));var _=new Map;if(n(h))ft(h,(function(t){var e,r;n(t)?(t[0]=null!=(e=t[0])?e:"",t[1]=null!=(r=t[1])?r:{},gt(t[0],t,_)):gt(t,[t,{}],_)}));else if(i(h))for(var b in h){var k,A;if(n(h[b]))h[b][0]=null!=(k=h[b][0])?k:"",h[b][1]=null!=(A=h[b][1])?A:{};else gt(b,[h[b],{}],_)}ut.call(a,p,h=_);var C,j,M=B("div",{class:f+"__values"}),S=B("span",{class:f+"__"+(s?"text":"value")}),R=B("span",{contenteditable:!(ht(t)||mt(t)||!s)&&"",spellcheck:!!s&&"false"}),Y=B("span",s?t.placeholder+"":"");N(d,M),N(d,p),N(M,S),N(M,l),s?(G("blur",R,Tt),G("cut",R,Et),G("focus",R,Ot),G("keydown",R,Ct),G("paste",R,Yt),N(S,R),N(S,Y),_t(R,a)):(G("blur",d,yt),G("focus",d,Lt),G("keydown",d,St)),P(t,f+"__self"),j=d,E(C=t).insertBefore(j,T(C,!0)),v&&(G("reset",v,Ht),G("submit",v,Wt),_t(v,a)),G("mousedown",g,zt),G("mousedown",d,Kt),G("mousemove",g,Bt),G("mouseup",g,Dt),G("resize",m,It),G("scroll",m,Ut),G("touchend",g,Dt),G("touchmove",g,Bt),G("touchstart",g,zt),G("touchstart",d,Kt),t.tabIndex=-1,_t(d,a);var H,I={};if(I.hint=s?Y:null,I.input=s?R:null,I.of=t,I.options=p,I.root=g,I.self=d,I[s?"text":"value"]=S,a._mask=I,(H=a._options[a._value])&&(K(H._of,"selected",""),s?(U(R,O(H)),O(R,!1)&&U(Y,"")):(z(S,"value",w(H,"value",!1)),D(S,y(H)))),o(r)&&n(r.with))for(var W=0,F=c(r.with);W<F;++W){var J=r.with[W];u(J)&&(J=bt[J]),e(J)?J.call(a,t,r):i(J)&&e(J.attach)&&J.attach.call(a,t,r)}return a},kt.blur=function(){Ft();var t=this,n=t._mask,e=t.mask;return(n.input||e).blur(),t.exit()},kt.detach=function(){var t,r=this,o=r._mask,a=r.mask,s=r.self,f=r.state,l=o.input,v=L(s);if(r._active=!1,r._value=dt(s)||null,v&&(X("reset",v,Ht),X("submit",v,Wt)),l&&(X("blur",l,Tt),X("blur",a,yt),X("cut",l,Et),X("focus",l,Ot),X("focus",a,Lt),X("keydown",l,Ct),X("keydown",a,St),X("paste",l,Yt)),X("mousedown",g,zt),X("mousedown",a,Kt),X("mousemove",g,Bt),X("mouseup",g,Dt),X("resize",m,It),X("scroll",m,Ut),X("touchend",g,Dt),X("touchmove",g,Bt),X("touchstart",g,zt),X("touchstart",a,Kt),n(f.with))for(var d=0,p=c(f.with);d<p;++d){var h=f.with[d];u(h)&&(h=bt[h]),i(h)&&e(h.detach)&&h.detach.call(r,s,f)}return s.tabIndex=null,R(s,f.n+"__self"),E(t=a),t.remove(),r._mask={of:s},r.mask=null,r},kt.enter=function(t){var n,e=this,r=e._mask,i=e._options,o=e.mask,u=e.self,a=e.state,s=r.input,f=a.n;P(o,f+"--focus"),P(o,f+"--focus-option"),P(o,f+="--open");var c=vt(g);return c&&e!==c&&c.exit(),_t(g,e),_t(m,e),e.fire("enter"),t&&(e.fire("focus"),"input"===x(u)?(st(s),Jt(s)):(n=i[dt(u)])&&st(n),e.fire("focus.option")),e},kt.exit=function(t){var n=this,e=n._mask,r=n.mask,i=n.self,o=n.state,u=e.input,a=o.n;return R(r,a+"--focus"),R(r,a+"--focus-option"),R(r,a+="--open"),n.fire("exit"),t&&("input"===x(i)?(st(u),Jt(u)):st(r),n.fire("focus").fire("focus.self")),n},kt.fit=function(){var t=this,n=t._mask,e=t.mask,r=n.options,i=J(e),o=J(m);return i[1]+i[3]/2>o[3]/2?I(r,{bottom:"100%","max-height":i[1],top:"auto"}):I(r,{bottom:"auto","max-height":o[3]-i[1]-i[3],top:"100%"}),t},kt.focus=function(t){var n=this,e=n._mask,r=n.mask,i=e.input;return i?(st(i),Jt(i,t),n):(r&&st(r),n)},bt}));