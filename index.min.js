/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=n()}(this,(function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},r=function(t,n,e){return!(!t||"object"!=typeof t)&&(e?a(n)&&a(t.constructor)&&n===t.constructor:a(n)&&t instanceof n)},i=function(t){return o(t)&&0==t%1},o=function(t){return"number"==typeof t},u=function(t,n){return void 0===n&&(n=!0),!(!t||"object"!=typeof t)&&(!n||r(t,Object,1))},a=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},s=function(t){return"string"==typeof t},f=function(t){return t.replace(/[-_.](\w)/g,(function(t,n){return l(n)}))},c=function(t){return t.toLowerCase()},l=function(t){return t.toUpperCase()},d=function(t){return t.length},v=function(t){if(n(t))return t.map((function(t){return v(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(t))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(t);if(u(t)){for(var e in t)t[e]=v(t[e]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},p=function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];for(var o=r.shift(),s=0,f=d(r);s<f;++s)for(var c in r[s])if(a(o[c]))if(n(o[c])&&n(r[s][c])){o[c]=[].concat(o[c]);for(var l=0,v=d(r[s][c]);l<v;++l)t(r[s][c][l],o[c])||o[c].push(r[s][c][l])}else u(o[c])&&u(r[s][c])?o[c]=p({},o[c],r[s][c]):o[c]=r[s][c];else o[c]=r[s][c];return o},h=function(t){if(n(t))return t.map((function(n){return h(t)}));if(u(t)){for(var e in t)t[e]=h(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},m=document,_=window,g=m.body,b=m.documentElement,k=function(t){return t.firstElementChild||null},y=function(t){return t.lastElementChild||null},x=function(t,n,e){void 0===e&&(e=!0);var r=function(t,n,e){if(void 0===e&&(e=!0),!P(t,n))return null;var r=t.getAttribute(n);return e?v(r):r}(t,"data-"+n,e),i=(r+"").trim();return e&&i&&("["===i[0]&&"]"===i.slice(-1)||"{"===i[0]&&"}"===i.slice(-1))&&null!==(i=function(t){var n=null;try{n=JSON.parse(t)}catch(t){}return n}(r))?i:r},w=function(t,n){void 0===n&&(n=!0);var e="innerHTML";if(!M(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},z=function(t){return c(t&&t.nodeName||"")||null},E=function(t,n){return t["next"+(n?"":"Element")+"Sibling"]||null},L=function(t,n){return n?t.closest(n)||null:t.parentNode||null},T=function(t){var n="form";return M(t,n)&&n===z(t[n])?t[n]:L(t,n)},A=function(t,n){return t["previous"+(n?"":"Element")+"Sibling"]||null},C=function(t,n,e){var r=_.getComputedStyle(t).getPropertyValue(n);return r||""===r||0===r?r:null},O=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!M(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},P=function(t,n){return t.hasAttribute(n)},S=function(t,n){return t.classList.contains(n)},M=function(t,n){return n in t},j=function(t,n){return t.removeAttribute(n),t},N=function(t,n){return t.classList.remove(n),t},R=function(t,n){return t.style[f(n)]=null,t},D=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,h(e)),t},H=function(t,n){return t.append(n),n},I=function(t,n){return t.classList.add(n),t},K=function(t,e,r){return(n(r)||u(r))&&(r=JSON.stringify(r)),D(t,"data-"+e,r)},B=function(t,n,e){return t=s(t)?m.createElement(t):t,u(n)&&(e=n,n=!1),s(n)&&U(t,n),u(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?D(t,r,e):j(t,r)}(t,e),t},U=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return M(t,r)&&(t[r]=e?n.trim():n),t},Y=function(t,n,e){return o(e)&&(e+="px"),t.style[f(n)]=h(e),t},J=function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?Y(t,r,e):R(t,r);return t},V=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return M(t,r)&&(t[r]=e?n.trim():n),t},W=function(t,n){var e;return function(){var r=arguments,i=this;e&&clearTimeout(e),e=setTimeout((function(){return t.apply(i,r)}),n)}},F=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}},X=function(t){var n,e,r,i,o,u,a;return!function(t){return t===_}(t)?(i=(e=t.getBoundingClientRect()).left,o=e.top,r=e.width,n=e.height,u=e.right,a=e.bottom):(i=t.pageXOffset||b.scrollLeft||g.scrollLeft,o=t.pageYOffset||b.scrollTop||g.scrollTop,r=t.innerWidth,n=t.innerHeight),[i,o,r,n,u,a]},$=function(t){return[t.scrollLeft,t.scrollTop]};var q=function(t,n,e){n.removeEventListener(t,e)},G=function(t){return t&&t.preventDefault()},Q=function(t){return t&&t.stopPropagation()},Z=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},tt="ArrowDown",nt="ArrowUp",et="Backspace",rt="Delete",it="Enter",ot="Escape",ut="PageDown",at="PageUp",st="Tab",ft=W((function(t){return t.fit()}),10),ct=new WeakMap;function lt(t,n){var e,i=this,o=i.self,u=i.state.n;u+="__option",mt(n=r(n,Map)&&n.size>0?n:_t(o),(function(n,r){"data-group"in n[1]?e&&x(e,"value",!1)===n[1]["data-group"]||H(t,e=B("span",{class:u+"-group","data-value":n[1]["data-group"]})):e=!1;var a=n[1],s=a.disabled,f=a.selected,c=a.value;yt(o)&&(s=!0);var l=B("span",n[0],{class:u+(s?" "+u+"--disabled":"")+(f?" "+u+"--selected":""),"data-value":h(c||r),tabindex:!s&&-1});if(s||(Z("blur",l,Pt),Z("focus",l,Nt),Z("keydown",l,Ut),Z("mousedown",l,Wt),Z("touchend",l,qt),Z("touchstart",l,Wt)),l._={},n[2])l._[0]=n[2];else{var d=B("option",n[0],{disabled:!!s&&"",selected:!!f&&"",value:c||r});o.add(d),l._[0]=d}H(e||t,l),zt(l,i),Et(r,l,i._options)})),i.state.options=n}function dt(t,e,r){var i=new Map;if(n(e))ht(e,(function(t){var e,r;n(t)?(t[0]=null!=(e=t[0])?e:"",t[1]=null!=(r=t[1])?r:{},Et(t[0],t,i)):Et(t,[t,{}],i)}));else if(u(e))for(var o in e){var a,s;if(n(e[o]))e[o][0]=null!=(a=e[o][0])?a:"",e[o][1]=null!=(s=e[o][1])?s:{},Et(o,e[o],i);else Et(o,[e[o],{}],i)}lt.call(t,r,i)}function vt(t,n,e){Object.defineProperty(t,n,e)}function pt(t){t.focus()}function ht(t,n){t.forEach(n)}function mt(t,n){ht(t,n)}function _t(t){var n,e,r=new Map,i=bt(t),o=[];e="input"===z(t)?(e=t.list)?e.children:[]:t.children;for(var u=function(t){var n=e[t],i=function(t,n){void 0===n&&(n=!0);for(var e,r=t.attributes,i={},o=0,u=r.length;o<u;++o)e=r[o].value,i[r[o].name]=n?v(e):e;return i}(n);if(ht(["disabled","selected"],(function(n){n in i?(i[n]=""===i[n]||i[n],"selected"===n&&o.push(t)):i[n]=null})),"optgroup"===z(n))return mt(_t(n),(function(t,e){t[1]["data-group"]=n.label,Et(e,t,r)})),1;Et(n.value,[O(n)||n.value,i,n],r)},a=0,s=d(e);a<s;++a)u(a);return 0===d(o)&&(n=kt(i,r))&&(n[1].selected=!0,Et(i,n,r)),r}function gt(t){return kt(t,ct)||null}function bt(t){return(t.value||"").replace(/\r/g,"")}function kt(t,n){return n.get(t)}function yt(t){return t.disabled}function xt(t){return t.readOnly}function wt(t){return function(t,n){return n.delete(t)}(t,ct)}function zt(t,n){return Et(t,n,ct)}function Et(t,n,e){return e.set(t,n)}function Lt(t){var n=[];return mt(t,(function(t){return n.push(t)})),n}function Tt(t,n){var e=this;return t?r(e,Tt)?(zt(t,function(t,n){return(n=n||t).fire=function(t,n,e){var r=this,i=r.hooks;return a(i[t])?(i[t].forEach((function(t){return t.apply(e||r,n)})),r):r},n.off=function(t,n){var e=this,r=e.hooks;if(!a(t))return r={},e;if(a(r[t]))if(a(n)){var i=r[t].length;if(0===i)delete r[t];else for(var o=0;o<i;++o)if(n===r[t][o]){r[t].splice(o,1);break}}else delete r[t];return e},n.on=function(t,n){var e=this.hooks;return a(e[t])||(e[t]=[]),a(n)&&e[t].push(n),this},t.hooks={},t}(e,Tt.prototype)),e.attach(t,p({},Tt.state,n||{}))):new Tt(t,n):e}Tt.from=function(t,n){return new Tt(t,n)},Tt.of=gt,Tt.state={n:"option-picker",options:null,size:null,strict:!1,with:[]},Tt.version="2.0.0",vt(Tt,"name",{value:"OptionPicker"});var At=Tt.prototype;vt(At,"size",{get:function(){var t=this.state.size||1;return i(t)?t<1?1:t:1},set:function(t){var n=this,e=n._mask,r=n._options,o=n.mask,u=n.state,a=e.options;u.n;var s=i(t)?t<1?1:t:1;if(n.state.size=s,1===s)j(o,"data-"+"size"),R(a,"max-height"),wt(b);else{var f=Lt(r).find((function(t){return!t.hidden}));if(f){var c,l,d=C(a,"gap"),v=C(a,"padding-bottom"),p=null!=(c=null!=(l=C(f,"height"))?l:C(f,"min-height"))?c:C(f,"line-height");K(o,"size",s),Y(a,"max-height","calc(("+p+" + max("+d+","+v+"))*"+s+")"),zt(b,n)}}}}),vt(At,"value",{get:function(){var t=bt(this.self);return""===t?null:t},set:function(t){this.fire("change",[v(t)])}});var Ct=W((function(n,i,o,u){var a=s(i)?i:O(i)||"",f=c(a),l=n._mask,p=n.mask,h=n.self,m=n.state,_=l.options,g=l.value,b=m.n,k=x(p,"size");if(b+="__option",u){var y,z=bt(h);mt(o,(function(t,n){j(t._[0],"selected"),N(t,b+"--selected")}));try{mt(o,(function(t,e){var r=c(O(t)+"\t"+(y=x(t,"value",!1)));if(""!==f&&f===r.slice(0,d(f))&&!S(t,b+"--disabled"))throw h.value=y,D(t._[0],"selected",""),I(t,b+"--selected"),K(g,"value",y),U(g,w(t)),y!==z&&n.fire("change",[v(y)]),k&&t.scrollIntoView({block:"nearest"}),""}))}catch(t){}}else{var E=o.size;mt(o,(function(n,e){var r=c(O(n)+"\t"+x(n,"value",!1));""!==f&&!t(f,r)||S(n,b+"--disabled")?(n.hidden=!0,--E):n.hidden=!1})),_.hidden=!E}n.fire("search",[a]);var L=m.options;e(L)&&(L=L.call(n,a),r(L,Promise)&&L.then((function(t){dt(n,t,_),n.fire("load",[t,a])})))}),50);function Ot(){var t=this,n=gt(t).state.n;N(t,n+="--focus"),N(t,n+="-self")}function Pt(){var t=this,n=gt(t);n.mask;var e=n.state.n;N(t,e+="--focus"),N(t,e+="-option")}function St(){var t=gt(this),n=t._mask,e=t.mask,r=t.state,i=n.text,o=r.n;N(e,o+"--focus-text"),N(i,o+"__text--focus")}function Mt(){var t=this,n=gt(t),e=n._mask,r=n.self,i=e.hint;F((function(){return V(i,O(t,!1)?"":r.placeholder)}),1)()}function jt(){var t=this,n=gt(t).state.n;I(t,n+="--focus"),I(t,n+="-self")}function Nt(){var t=gt(this),n=t.mask,e=t.state.n;en(),I(n,e+="--focus"),I(n,e+="-option")}function Rt(){gt(this).focus()}function Dt(){var t=gt(this),n=t._mask,e=t.mask;t.self;var r=t.state,i=n.input,o=n.text,u=r.n;I(o,u+"__text--focus"),I(e,u+="--focus"),I(e,u+="-text"),O(i,!1)?rn(this):t.enter().fit()}function Ht(t){var n,e=this,r=t.key,i=gt(e),o=i._mask,u=i._options,a=i.self,s=i.state,f=o.hint,c=s.n;if(c+="__option--disabled",F((function(){return V(f,O(e,!1)?"":a.placeholder)}),1)(),et!==r&&rt!==r&&1!==d(r)||F((function(){return i.enter().fit()}),51)(),tt===r||nt===r||it===r){var l=kt(bt(a),u);if(!l||l.hidden)for(l=Lt(u).shift();l&&(S(l,c)||l.hidden);)l=E(l);l&&pt(l),n=!0}else st===r?(s.strict,i.exit()):Ct(i,e,u);n&&(G(t),Q(t))}var It="",Kt=W((function(){return It=""}),500);function Bt(t){var n,e=t.key,r=t.altKey,i=t.ctrlKey,o=gt(this),u=o._options,a=o.self;if(Kt(),yt(a)||xt(a))return G(t);et===e||rt===e?It="":ot===e?(It="",o.exit(n=!0)):st===e?(It="",o.exit(!(n=!1))):tt===e||nt===e||it===e||ut===e||at===e||""===It&&" "===e?o.enter(n=!0).fit():1!==d(e)||r||i||(It+=e),""!==It&&Ct(o,It,u,n=!0),n&&G(t)}function Ut(t){var n,e=this,r=t.key,i=t.altKey,o=t.ctrlKey,u=gt(e),a=u._mask,s=u._options;u.mask;var f=u.self,c=u.state,l=a.hint,p=a.input,h=a.value,m=c.n;m+="__option";var _,g,b,T,C,P="input"===z(f);if(et===r)u.exit(n=!0);else if(it===r||ot===r||st===r||" "===r){if(ot!==r){var M,R=bt(f);(C=kt(R,s))&&(j(C._[0],"selected"),N(C,m+"--selected")),D(e._[0],"selected",""),I(e,m+"--selected"),f.value=M=x(e,"value",!1),P?(V(l,""),V(p,O(e))):(K(h,"value",M),U(h,w(e))),M!==R&&u.fire("change",[v(M)])}u.exit(n=st!==r)}else if(tt===r||ut===r){for(n=!0,b=ut===r&&S(T=L(e),m+"-group")?E(T):E(e);b&&(S(b,m+"--disabled")||b.hidden);)b=E(b);for(b?S(b,m+"-group")&&(b=k(b)):((T=L(e))&&S(T,m+"-group")&&(b=E(T)),b&&S(b,m+"-group")&&(b=k(b)));b&&(S(b,m+"--disabled")||b.hidden);)b=E(b);b?pt(b):(_=Lt(s).find((function(t){return!t.hidden&&!S(t,m+"--disabled")})))&&pt(_)}else if(nt===r||at===r){for(n=!0,C=at===r&&S(T=L(e),m+"-group")?A(T):A(e);C&&(S(C,m+"--disabled")||C.hidden);)C=A(C);for(C?S(C,m+"-group")&&(C=y(C)):((T=L(e))&&S(T,m+"-group")&&(C=A(T)),C&&S(C,m+"-group")&&(C=y(C)));C&&(S(C,m+"--disabled")||C.hidden);)C=A(C);C?pt(C):(g=Lt(s).findLast((function(t){return!t.hidden&&!S(t,m+"--disabled")})))&&pt(g)}else"Home"===r?(n=!0,(_=Lt(s).find((function(t){return!t.hidden&&!S(t,m+"--disabled")})))&&pt(_)):"End"===r?(n=!0,(g=Lt(s).findLast((function(t){return!t.hidden&&!S(t,m+"--disabled")})))&&pt(g)):(P&&1===d(r)&&!i&&!o&&V(l,""),u.exit(!(n=!1)));n&&(G(t),Q(t))}function Yt(){var t=this,n=gt(t),e=n._mask,r=n.self,i=e.hint;F((function(){return V(t,O(t))}))(),F((function(){return V(i,O(t,!1)?"":r.placeholder)}),1)()}function Jt(t){var n=this,e=gt(n),r=e.self,i=e.state.n,o=t.target;G(t),yt(r)||xt(r)||x(n,"size")||S(o,i+"__options")||L(o,"."+i+"__options")||e[S(n,i+"--open")?"exit":"enter"](!0).fit()}var Vt=0;function Wt(t){var n=this,e=gt(n),r=e._mask,i=e.mask,o=r.options;"mousedown"===t.type?(on(n,e),x(i,"size")||e.exit(!0)):(pt(n),Vt=$(o)[1]),G(t)}var Ft=!1;function Xt(t){"touchstart"===t.type&&(Ft=t.touches[0].clientY);var n=gt(this);if(n){var e=n.mask,r=n.state.n,i=t.target;e!==i&&e!==L(i,"."+r)&&(x(e,"size")?n.blur():(wt(this),n.exit()))}}function $t(t){if(!1!==Ft){var n,e,r=gt(this);if("touchmove"===t.type&&r){var i=r._mask.options,o=t.touches[0].clientY;if(i){var u=$(i);u[1]-=o-Ft,e=u,(n=i).scrollLeft=e[0],n.scrollTop=e[1],Ft=o}}}}function qt(t){var n=gt(this),e=n._mask.options;$(e)[1]===Vt&&(on(this,n),n.exit(!0))}function Gt(t){Ft=!1}function Qt(t){gt(this).let().fire("reset",[t])}function Zt(){var t=gt(this);t&&ft(t)}function tn(){Zt.call(this)}function nn(t){return gt(this).fire("submit",[t])}function en(t){var n=m.getSelection();n.rangeCount&&n.removeRange(n.getRangeAt(0))}function rn(t,n){var e=m.getSelection();en();var r=m.createRange();r.selectNodeContents(t),e.addRange(r),1===n?e.collapseToEnd():-1===n&&e.collapseToStart()}function on(t,n){var e=n._mask,r=n._options,i=n.self,o=n.state,u=e.hint,a=e.input;e.options;var s=e.value,f=o.n;f+="__option--selected";var c,l=bt(i);mt(r,(function(n,e){t!==n&&(j(n._[0],"selected"),N(n,f))})),D(t._[0],"selected",""),I(t,f),i.value=c=x(t,"value",!1),"input"===z(i)?(V(u,""),V(a,O(t))):(K(s,"value",c),U(s,w(t))),c!==l&&n.fire("change",[v(c)])}return At.attach=function(t,i){var o,f=this;t=t||f.self,i=i||f.state,f._active=!yt(t)&&!xt(t),f._options=new Map,f._value=bt(t)||null,f.self=t,f.state=i;var c="input"===z(t),l=i.n,v=B("span",{class:l+"__arrow"}),p=T(t),h=B("div",{class:l,tabindex:!yt(t)&&!c&&0});f.mask=h;var m=B("div",{class:l+"__options"}),g=i.options;e(g)&&(g=g.call(f,null),r(g,Promise)&&g.then((function(t){dt(f,t,m),f.fire("load",[t,null])}))),r(g,Promise)||dt(f,g,m);var k,y,A=B("div",{class:l+"__values"}),C=B("span",{class:l+"__"+(c?"text":"value")}),P=B("span",{autocapitalize:"off",contenteditable:!(yt(t)||xt(t)||!c)&&"",spellcheck:!!c&&"false"}),S=B("span",c?t.placeholder+"":"");H(h,A),H(h,m),H(A,C),H(A,v),c?(Z("blur",P,St),Z("cut",P,Mt),Z("focus",P,Dt),Z("keydown",P,Ht),Z("paste",P,Yt),H(C,P),H(C,S),zt(P,f)):(Z("blur",h,Ot),Z("focus",h,jt),Z("keydown",h,Bt)),I(t,l+"__self"),y=h,L(k=t).insertBefore(y,E(k,!0)),p&&(Z("reset",p,Qt),Z("submit",p,nn),zt(p,f)),Z("focus",t,Rt),Z("mousedown",b,Xt),Z("mousedown",h,Jt),Z("mousemove",b,$t),Z("mouseup",b,Gt),Z("resize",_,Zt),Z("scroll",_,tn),Z("touchend",b,Gt),Z("touchmove",b,$t,{passive:!1}),Z("touchstart",b,Xt),Z("touchstart",h,Jt),t.tabIndex=-1,zt(h,f);var M,j={};if(j.arrow=v,j.hint=c?S:null,j.input=c?P:null,j.of=t,j.options=m,j.root=b,j.self=h,j[c?"text":"value"]=C,f._mask=j,f.size=null!=(o=i.size)?o:c?1:t.size,(M=kt(f._value,f._options)||(c?0:Lt(f._options).find((function(t){return!yt(t._[0])}))))&&(D(M._[0],"selected",""),c?(V(P,O(M)),O(P,!1)&&V(S,"")):(K(C,"value",x(M,"value",!1)),U(C,w(M)))),a(i)&&n(i.with))for(var N=0,R=d(i.with);N<R;++N){var Y=i.with[N];s(Y)&&(Y=Tt[Y]),e(Y)?Y.call(f,t,i):u(Y)&&e(Y.attach)&&Y.attach.call(f,t,i)}return f},At.blur=function(){en();var t=this,n=t._mask,e=t.mask;return(n.input||e).blur(),t.exit()},At.detach=function(){var t,r=this,i=r._mask,o=r.mask,a=r.self,f=r.state,c=i.input,l=T(a);if(r._active=!1,r._value=bt(a)||null,l&&(q("reset",l,Qt),q("submit",l,nn)),c&&(q("blur",c,St),q("blur",o,Ot),q("cut",c,Mt),q("focus",c,Dt),q("focus",o,jt),q("keydown",c,Ht),q("keydown",o,Bt),q("paste",c,Yt)),q("focus",a,Rt),q("mousedown",b,Xt),q("mousedown",o,Jt),q("mousemove",b,$t),q("mouseup",b,Gt),q("resize",_,Zt),q("scroll",_,tn),q("touchend",b,Gt),q("touchmove",b,$t),q("touchstart",b,Xt),q("touchstart",o,Jt),n(f.with))for(var v=0,p=d(f.with);v<p;++v){var h=f.with[v];s(h)&&(h=Tt[h]),u(h)&&e(h.detach)&&h.detach.call(r,a,f)}return a.tabIndex=null,N(a,f.n+"__self"),L(t=o),t.remove(),r._mask={of:a},r.mask=null,r},At.enter=function(t){var n,e=this,r=e._mask,i=e._options,o=e.mask,u=e.self,a=e.state,s=r.input,f=a.n;I(o,f+"--focus"),I(o,f+"--focus-option"),I(o,f+="--open");var c=gt(b);return c&&e!==c&&c.exit(),zt(b,e),zt(_,e),e.fire("enter"),t&&(e.fire("focus"),"input"===z(u)?(pt(s),rn(s)):(n=kt(bt(u),i))&&pt(n),e.fire("focus.option")),e},At.exit=function(t){var n=this,e=n._mask,r=n.mask,i=n.self,o=n.state,u=e.input,a=o.n;return N(r,a+"--focus"),N(r,a+"--focus-option"),N(r,a+="--open"),n.fire("exit"),t&&("input"===z(i)?(pt(u),rn(u)):pt(r),n.fire("focus").fire("focus.self")),n},At.fit=function(){var t=this,n=t._mask,e=t.mask,r=n.options;if(x(e,"size"))return t;var i=C(e,"border-bottom-width"),o=C(e,"border-top-width"),u=X(e),a=X(_);return u[1]+u[3]/2>a[3]/2?J(r,{bottom:"100%","max-height":"calc("+u[1]+"px + "+i+")",top:"auto"}):J(r,{bottom:"auto","max-height":"calc("+(a[3]-u[1]-u[3])+"px + "+o+")",top:"100%"}),t},At.focus=function(t){var n=this,e=n._mask,r=n.mask,i=e.input;return i?(pt(i),rn(i,t),n):(pt(r),n)},Tt}));