/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},o=function(t,e){return t&&r(e)&&t instanceof e},i=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||o(t,Object))},r=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},s=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return f(e)}))},l=function(t){return t.toLowerCase()},f=function(t){return t.toUpperCase()},a=function(t){return t.length},c=function t(n){if(e(n))return n.map((function(e){return t(e)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(n))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(n);if(i(n)){for(var o in n)n[o]=t(n[o]);return n}return"false"!==n&&("null"===n?null:"true"===n||n)},d=function n(){for(var o=arguments.length,u=Array(o),s=0;s<o;s++)u[s]=arguments[s];for(var l=u.shift(),f=0,c=a(u);f<c;++f)for(var d in u[f])if(r(l[d]))if(e(l[d])&&e(u[f][d])){l[d]=[].concat(l[d]);for(var p=0,h=a(u[f][d]);p<h;++p)t(u[f][d][p],l[d])||l[d].push(u[f][d][p])}else i(l[d])&&i(u[f][d])?l[d]=n({},l[d],u[f][d]):l[d]=u[f][d];else l[d]=u[f][d];return l},p=function t(n){if(e(n))return n.map((function(e){return t(n)}));if(i(n)){for(var o in n)n[o]=t(n[o]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},h=document,_=window,v=h.body,m=h.documentElement,b=function(t,e){void 0===e&&(e=!0);for(var n,o=t.attributes,i={},r=0,u=o.length;r<u;++r)n=o[r].value,i[o[r].name]=e?c(n):n;return i},g=function(t,e,n){void 0===n&&(n=!0);var o=function(t,e,n){if(void 0===n&&(n=!0),!L(t,e))return null;var o=t.getAttribute(e);return n?c(o):o}(t,"data-"+e,n),i=(o+"").trim();return n&&i&&("["===i[0]&&"]"===i.slice(-1)||"{"===i[0]&&"}"===i.slice(-1))&&null!==(i=function(t){var e=null;try{e=JSON.parse(t)}catch(t){}return e}(o))?i:o},k=function(t,e){void 0===e&&(e=!0);var n="innerHTML";if(!C(t,n))return!1;var o=t[n];return""!==(o=e?o.trim():o)?o:null},y=function(t){return l(t&&t.nodeName||"")||null},w=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},x=function(t,e){return e?t.closest(e)||null:t.parentNode||null},E=function(t){var e="form";return C(t,e)&&e===y(t.form)?t.form:x(t,e)},T=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},A=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!C(t,n))return!1;var o=t[n];return""!==(o=e?o.trim():o)?o:null},L=function(t,e){return t.hasAttribute(e)},O=function(t,e){return t.classList.contains(e)},C=function(t,e){return e in t},S=function(t,e){return t.removeAttribute(e),t},j=function(t,e){return t.classList.remove(e),t},M=function(t,e){return t.style[s(e)]=null,t},R=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,p(n)),t},N=function(t,e){return t.append(e),e},P=function(t,e){return t.classList.add(e),t},z=function(t,e,n){return t=u(t)?h.createElement(t):t,i(e)&&(n=e,e=!1),u(e)&&B(t,e),i(n)&&function(t,e){var n;for(var o in e)(n=e[o])||""===n||0===n?R(t,o,n):S(t,o)}(t,n),t},B=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var o="innerHTML";return C(t,o)&&(t[o]=n?e.trim():e),t},H=function(t,e,n){return"number"==typeof n&&(n+="px"),t.style[s(e)]=p(n),t},I=function(t,e){var n;for(var o in e)(n=e[o])||""===n||0===n?H(t,o,n):M(t,o);return t},D=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var o="textContent";return C(t,o)&&(t[o]=n?e.trim():e),t},K=function(t,e){var n;return function(){var o=arguments,i=this;n&&clearTimeout(n),n=setTimeout((function(){return t.apply(i,o)}),e)}},U=function(t,e){return function(){var n=arguments,o=this;setTimeout((function(){return t.apply(o,n)}),e)}},F=function(t){var e,n,o,i,r,u,s;return!function(t){return t===_}(t)?(i=(n=t.getBoundingClientRect()).left,r=n.top,o=n.width,e=n.height,u=n.right,s=n.bottom):(i=t.pageXOffset||m.scrollLeft||v.scrollLeft,r=t.pageYOffset||m.scrollTop||v.scrollTop,o=t.innerWidth,e=t.innerHeight),[i,r,o,e,u,s]};var J=function(t,e,n){e.removeEventListener(t,n)},W=function(t){return t&&t.preventDefault()},X=function(t){return t&&t.stopPropagation()},Y=function(t,e,n,o){void 0===o&&(o=!1),e.addEventListener(t,n,o)};const $="ArrowDown",q="ArrowUp",G="Enter",Q="Escape",V="Tab",Z=K((t=>t.fit()),10),tt="OptionPicker";function et(t,e){let n,i=this,{self:r,state:u}=i,{n:s}=u;s+="__option",(e=o(e,Map)&&e.size>0?e:ot(r)).forEach(((e,o)=>{"data-group"in e[1]?n||N(t,n=z("span",{class:s+"-group","data-value":e[1]["data-group"]})):n=!1;let{disabled:r,selected:u,value:l}=e[1],f=z("span",e[0],{class:s+(r?" "+s+"--disabled":"")+(u?" "+s+"--selected":""),"data-value":p(l||o),tabindex:!r&&-1});r||(Y("blur",f,at),Y("focus",f,ht),Y("keydown",f,gt),Y("mousedown",f,wt),Y("touchstart",f,wt)),f._of=e[2],f["_"+tt]=i,i._options[o]=f,N(n||t,f)})),i.state.options=e}function nt(t,e,n){Object.defineProperty(t,e,n)}function ot(t){const e=new Map,n=it(t);let o,i,r=[];"input"===y(t)?(i=t.list,i=i?i.children:[]):i=t.children;for(let t=0,n=a(i);t<n;++t){let n=i[t],o=b(n);["disabled","selected"].forEach((e=>{e in o?(o[e]=""===o[e]||o[e],"selected"===e&&r.push(t)):o[e]=null})),"optgroup"!==y(n)?e.set(n.value,[A(n)||n.value,o,n]):ot(n).forEach(((t,o)=>{t[1]["data-group"]=n.label,e.set(o,t)}))}return 0===a(r)&&(o=e.get(n))&&(o[1].selected=!0,e.set(n,o)),e}function it(t){return(t.value||"").replace(/\r/g,"")}function rt(t){return t.disabled}function ut(t){return t.readOnly}function st(t,e){const n=this;return t?o(n,st)?(t["_"+tt]=function(t,e){return(e=e||t).fire=function(t,e,n){var o=this,i=o.hooks;return r(i[t])?(i[t].forEach((function(t){return t.apply(n||o,e)})),o):o},e.off=function(t,e){var n=this,o=n.hooks;if(!r(t))return o={},n;if(r(o[t]))if(r(e)){var i=o[t].length;if(0===i)delete o[t];else for(var u=0;u<i;++u)if(e===o[t][u]){o[t].splice(u,1);break}}else delete o[t];return n},e.on=function(t,e){var n=this.hooks;return r(n[t])||(n[t]=[]),r(e)&&n[t].push(e),this},t.hooks={},t}(n,st.prototype),n.attach(t,d({},st.state,e||{}))):new st(t,e):n}st.state={n:"option-picker",options:null,with:[]},st.version="2.0.0",nt(st,"name",{value:tt});const lt=st.prototype;function ft(){let t=this,e=t["_"+tt],{state:n}=e,{n:o}=n;j(t,o+="--focus"),j(t,o+="-self")}function at(){let t=this["_"+tt],{mask:e,state:n}=t,{n:o}=n;j(e,o+"--focus-option")}function ct(){let t=this["_"+tt],{_mask:e,mask:n,state:o}=t,{text:i}=e,{n:r}=o;j(n,r+"--focus-text"),j(i,r+"__text--focus")}function dt(){let t=this,e=t["_"+tt],{_mask:n,self:o}=e,{hint:i}=n;U((()=>D(i,A(t,!1)?"":o.placeholder)),1)()}function pt(){let t=this,e=t["_"+tt],{state:n}=e,{n:o}=n;P(t,o+="--focus"),P(t,o+="-self")}function ht(){let t=this["_"+tt],{mask:e,state:n}=t,{n:o}=n;Ot(),P(e,o+"--focus-option")}function _t(){let t=this["_"+tt],{_mask:e,mask:n,self:o,state:i}=t,{text:r}=e,{n:u}=i;P(r,u+"__text--focus"),P(n,u+="--focus"),P(n,u+="-text"),it(o)?Ct(this):t.enter(!0)}nt(lt,"value",{get:function(){let t=it(this.self);return""===t?null:t},set:function(t){this.fire("change")}});const vt=K(((e,n,o)=>{let i=l(A(n)||"");for(let e in o){let n=o[e],r=l(A(n)+"\t"+n);""===i||t(i,r)?S(n,"hidden"):R(n,"hidden","")}}),10);function mt(t){let e,n=this,o=t.key,i=n["_"+tt],{_mask:r,_options:u,self:s,state:l}=i,{hint:f}=r,{n:a}=l;if(a+="__option--disabled",U((()=>D(f,A(n,!1)?"":s.placeholder)),1)(),i.enter(),$===o||q===o||G===o){let t=u[it(s)];if(!t||t.hidden)for(t=(c=u,Object.values(c)).shift();t&&(O(t,a)||t.hidden);)t=w(t);t&&t.focus(),e=!0}else V===o?i.exit():vt(i,n,u);var c;e&&(W(t),X(t))}function bt(t){let e,n=t.key,o=this["_"+tt];Q===n?o.exit(e=!0):$!==n&&q!==n&&G!==n&&" "!==n||o.enter(e=!0).fit(),e&&W(t)}function gt(t){let e,n=this,o=t.key;t.ctrlKey,t.shiftKey;let i=n["_"+tt],{_mask:r,_options:u,mask:s,self:l,state:f}=i,{hint:a,input:c,value:d}=r,{n:p}=f;p+="__option";let h,_,v,m="input"===y(l);if("Backspace"===o)e=!0,Ct(c);else if(G===o||Q===o||V===o||" "===o)Q!==o&&((v=u[it(l)])&&(S(v._of,"selected"),j(v,p+"--selected")),R(n._of,"selected",""),P(n,p+"--selected"),m?(D(a,""),D(c,A(n))):B(d,k(n)),l.value=g(n,"value")),i.exit(e=V!==o);else if($===o){for(e=!0,h=w(n);h&&(O(h,p+"--disabled")||h.hidden);)h=w(h);for(h?O(h,p+"-group")&&(h=h.firstElementChild||null):(_=x(n))&&O(_,p+"-group")&&(h=w(_));h&&(O(h,p+"--disabled")||h.hidden);)h=w(h);h&&h.focus()}else if(q===o){for(e=!0,v=T(n);v&&(O(v,p+"--disabled")||v.hidden);)v=T(v);for(v?O(v,p+"-group")&&(v=function(t){return t.lastElementChild||null}(v)):(_=x(n))&&O(_,p+"-group")&&(v=T(_));v&&(O(v,p+"--disabled")||v.hidden);)v=T(v);v?v.focus():m&&Ct(c)}else e=!1,Ct(c);e&&(W(t),X(t))}function kt(){let t=this,e=t["_"+tt],{_mask:n,self:o}=e,{hint:i}=n;U((()=>D(t,A(t))))(),U((()=>D(i,A(t,!1)?"":o.placeholder)),1)()}function yt(t){let e=this["_"+tt],{state:n}=e,{n:o}=n;e[O(this,o+"--open")?"exit":"enter"](!0).fit(),W(t)}function wt(t){let e=this,n=e["_"+tt],{_mask:o,_options:i,self:r,state:u}=n,{hint:s,input:l,value:f}=o,{n:a}=u;a+="__option--selected";for(let t in i){let n=i[t];e!==n&&(S(n._of,"selected"),j(n,a))}R(e._of,"selected",""),P(e,a),"input"===y(r)?(D(s,""),D(l,A(e))):B(f,k(e)),r.value=g(e,"value"),W(t)}function xt(t){let e=this,n=e["_"+tt];if(!n)return;let{mask:o,state:i}=n,{n:r}=i,u=t.target;o!==u&&o!==x(u,"."+r)&&(n.exit(),delete e["_"+tt])}function Et(t){this["_"+tt].let().fire("reset",[t])}function Tt(){let t=this["_"+tt];t&&Z(t)}function At(){Tt.call(this)}function Lt(t){return this["_"+tt].fire("submit",[t])}function Ot(t){const e=h.getSelection();t||e.rangeCount&&e.removeRange(e.getRangeAt(0))}function Ct(t,e){const n=h.getSelection();Ot();const o=h.createRange();o.selectNodeContents(t),n.addRange(o),1===e?n.collapseToEnd():-1===e&&n.collapseToStart()}return lt.attach=function(t,o){let s=this;t=t||s.self,o=o||s.state,s._active=!rt(t)&&!ut(t),s._options={},s._value=it(t)||null,s.self=t,s.state=o;let l="input"===y(t),{n:f}=o;const c=z("span",{class:f+"__arrow"}),d=E(t),p=z("div",{class:f,tabindex:!rt(t)&&!l&&0});s.mask=p;const h=z("div",{class:f+"__options"});let{options:v}=o;n(v)&&(v=v.call(s));const b=new Map;if(e(v))v.forEach((t=>{e(t)?(t[0]=t[0]??"",t[1]=t[1]??{},b.set(t[0],t)):b.set(t,[t,{}])}));else if(i(v))for(let t in v)e(v[t])?(v[t][0]=v[t][0]??"",v[t][1]=v[t][1]??{}):b.set(t,[v[t],{}]);et.call(s,h,v=b);const g=z("div",{class:f+"__values"}),T=z("span",{class:f+"__"+(l?"text":"value")}),L=z("span",{contenteditable:!(rt(t)||ut(t)||!l)&&"",spellcheck:!!l&&"false"}),O=z("span",l?t.placeholder+"":"");var C,S;N(p,g),N(p,h),N(g,T),N(g,c),l?(N(T,L),N(T,O),Y("blur",L,ct),Y("cut",L,dt),Y("focus",L,_t),Y("keydown",L,mt),Y("paste",L,kt),L["_"+tt]=s):(Y("blur",p,ft),Y("focus",p,pt),Y("keydown",p,bt)),P(t,f+"__self"),S=p,x(C=t).insertBefore(S,w(C,!0)),d&&(d["_"+tt]=s,Y("reset",d,Et),Y("submit",d,Lt)),Y("mousedown",m,xt),Y("mousedown",p,yt),Y("resize",_,Tt),Y("scroll",_,At),Y("touchstart",m,xt),Y("touchstart",p,yt),t.tabIndex=-1,p["_"+tt]=s;let j,M={};if(M.hint=l?O:null,M.input=l?L:null,M.of=t,M.options=h,M.root=m,M.self=p,M[l?"text":"value"]=T,s._mask=M,(j=s._options[s._value])&&(R(j._of,"selected",""),l?(D(L,A(j)),A(L,!1)&&D(O,"")):B(T,k(j))),r(o)&&e(o.with))for(let e=0,r=a(o.with);e<r;++e){let r=o.with[e];u(r)&&(r=st[r]),n(r)?r.call(s,t,o):i(r)&&n(r.attach)&&r.attach.call(s,t,o)}return s},lt.blur=function(){},lt.detach=function(){let t=this,{_mask:o,mask:r,self:s,state:l}=t,{input:f}=o;const c=E(s);if(t._active=!1,t._value=it(s)||null,c&&(J("reset",c,Et),J("submit",c,Lt)),f&&(J("blur",f,ct),J("blur",r,ft),J("cut",f,dt),J("focus",f,_t),J("focus",r,pt),J("keydown",f,mt),J("keydown",r,bt),J("paste",f,kt)),J("mousedown",m,xt),J("mousedown",r,yt),J("resize",_,Tt),J("scroll",_,At),J("touchstart",m,xt),J("touchstart",r,yt),e(l.with))for(let e=0,o=a(l.with);e<o;++e){let o=l.with[e];u(o)&&(o=st[o]),i(o)&&n(o.detach)&&o.detach.call(t,s,l)}var d;return s.tabIndex=null,j(s,l.n+"__self"),x(d=r),d.remove(),t._mask={of:s},t.mask=null,t},lt.enter=function(t){let e,n=this,{_mask:o,_options:i,mask:r,self:u,state:s}=n,{input:l}=o,{n:f}=s;return P(r,f+="--open"),m["_"+tt]&&m["_"+tt]!==n&&m["_"+tt].exit(),m["_"+tt]=n,_["_"+tt]=n,n.fire("enter"),t&&(n.fire("focus"),"input"===y(u)?(l.focus(),Ct(l)):(e=i[it(u)])&&e.focus(),n.fire("focus.option")),n},lt.exit=function(t){let e=this,{_mask:n,mask:o,self:i,state:r}=e,{input:u}=n,{n:s}=r;return j(o,s+="--open"),e.fire("exit"),t&&("input"===y(i)?(u.focus(),Ct(u)):o.focus(),e.fire("focus").fire("focus.self")),e},lt.fit=function(){let{_mask:t,mask:e}=this,{options:n}=t,o=F(e),i=F(_);return o[1]+o[3]/2>i[3]/2?I(n,{bottom:"100%","max-height":o[1],top:"auto"}):I(n,{bottom:"auto","max-height":i[3]-o[1]-o[3],top:"100%"}),this},lt.focus=function(){},st}));