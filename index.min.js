/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=n()}(this,(function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},r=function(t,n){return t&&o(n)&&t instanceof n},i=function(t,n){return void 0===n&&(n=!0),"object"==typeof t&&(!n||r(t,Object))},o=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},a=function(t){return t.replace(/[-_.](\w)/g,(function(t,n){return f(n)}))},s=function(t){return t.toLowerCase()},f=function(t){return t.toUpperCase()},l=function(t){return t.length},c=function(t){return Object.values(t)},v=function(t){if(n(t))return t.map((function(t){return v(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(t))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(t);if(i(t)){for(var e in t)t[e]=v(t[e]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},d=function(){for(var e=arguments.length,r=Array(e),u=0;u<e;u++)r[u]=arguments[u];for(var a=r.shift(),s=0,f=l(r);s<f;++s)for(var c in r[s])if(o(a[c]))if(n(a[c])&&n(r[s][c])){a[c]=[].concat(a[c]);for(var v=0,p=l(r[s][c]);v<p;++v)t(r[s][c][v],a[c])||a[c].push(r[s][c][v])}else i(a[c])&&i(r[s][c])?a[c]=d({},a[c],r[s][c]):a[c]=r[s][c];else a[c]=r[s][c];return a},p=function(t){if(n(t))return t.map((function(n){return p(t)}));if(i(t)){for(var e in t)t[e]=p(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},h=document,m=window,_=h.body,b=h.documentElement,k=function(t,n,e){var r=function(t,n,e){if(void 0===e&&(e=!0),!A(t,n))return null;var r=t.getAttribute(n);return e?v(r):r}(t,"data-"+n,e);return r},g=function(t,n){void 0===n&&(n=!0);var e="innerHTML";if(!C(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},y=function(t){return s(t&&t.nodeName||"")||null},x=function(t,n){return t["next"+(n?"":"Element")+"Sibling"]||null},w=function(t,n){return n?t.closest(n)||null:t.parentNode||null},E=function(t){var n="form";return C(t,n)&&n===y(t[n])?t[n]:w(t,n)},T=function(t,n){return t["previous"+(n?"":"Element")+"Sibling"]||null},L=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!C(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},A=function(t,n){return t.hasAttribute(n)},O=function(t,n){return t.classList.contains(n)},C=function(t,n){return n in t},M=function(t,n){return t.removeAttribute(n),t},S=function(t,n){return t.classList.remove(n),t},j=function(t,n){return t.style[a(n)]=null,t},R=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,p(e)),t},K=function(t,n){return t.append(n),n},N=function(t,n){return t.classList.add(n),t},P=function(t,e,r){return(n(r)||i(r))&&(r=JSON.stringify(r)),R(t,"data-"+e,r)},z=function(t,n,e){return t=u(t)?h.createElement(t):t,i(n)&&(e=n,n=!1),u(n)&&B(t,n),i(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?R(t,r,e):M(t,r)}(t,e),t},B=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return C(t,r)&&(t[r]=e?n.trim():n),t},D=function(t,n,e){return"number"==typeof e&&(e+="px"),t.style[a(n)]=p(e),t},H=function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?D(t,r,e):j(t,r);return t},I=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return C(t,r)&&(t[r]=e?n.trim():n),t},U=function(t,n){var e;return function(){var r=arguments,i=this;e&&clearTimeout(e),e=setTimeout((function(){return t.apply(i,r)}),n)}},W=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}},F=function(t){var n,e,r,i,o,u,a;return!function(t){return t===m}(t)?(i=(e=t.getBoundingClientRect()).left,o=e.top,r=e.width,n=e.height,u=e.right,a=e.bottom):(i=t.pageXOffset||b.scrollLeft||_.scrollLeft,o=t.pageYOffset||b.scrollTop||_.scrollTop,r=t.innerWidth,n=t.innerHeight),[i,o,r,n,u,a]};var J=function(t,n,e){n.removeEventListener(t,e)},X=function(t){return t&&t.preventDefault()},Y=function(t){return t&&t.stopPropagation()},$=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},q="ArrowDown",G="ArrowUp",Q="Backspace",V="Delete",Z="Enter",tt="Escape",nt="Tab",et=U((function(t){return t.fit()}),10),rt=new WeakMap;function it(t,n){var e,i=this,o=i.self,u=i.state.n;u+="__option",(n=r(n,Map)&&n.size>0?n:at(o)).forEach((function(n,r){"data-group"in n[1]?e||K(t,e=z("span",{class:u+"-group","data-value":n[1]["data-group"]})):e=!1;var o=n[1],a=o.disabled,s=o.selected,f=o.value,l=z("span",n[0],{class:u+(a?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":p(f||r),tabindex:!a&&-1});a||($("blur",l,_t),$("focus",l,yt),$("keydown",l,At),$("mousedown",l,Mt),$("touchstart",l,Mt)),l._of=n[2],i._options[r]=l,K(e||t,l),vt(l,i)})),i.state.options=n}function ot(t,n,e){Object.defineProperty(t,n,e)}function ut(t){t.focus()}function at(t){var n,e,r=new Map,i=ft(t),o=[];e="input"===y(t)?(e=t.list)?e.children:[]:t.children;for(var u=function(t){var n=e[t],i=function(t,n){void 0===n&&(n=!0);for(var e,r=t.attributes,i={},o=0,u=r.length;o<u;++o)e=r[o].value,i[r[o].name]=n?v(e):e;return i}(n);if(["disabled","selected"].forEach((function(n){n in i?(i[n]=""===i[n]||i[n],"selected"===n&&o.push(t)):i[n]=null})),"optgroup"===y(n))return at(n).forEach((function(t,e){t[1]["data-group"]=n.label,r.set(e,t)})),1;r.set(n.value,[L(n)||n.value,i,n])},a=0,s=l(e);a<s;++a)u(a);return 0===l(o)&&(n=r.get(i))&&(n[1].selected=!0,r.set(i,n)),r}function st(t){return rt.get(t)}function ft(t){return(t.value||"").replace(/\r/g,"")}function lt(t){return t.disabled}function ct(t){return t.readOnly}function vt(t,n){return rt.set(t,n)}function dt(t,n){var e=this;return t?r(e,dt)?(vt(t,function(t,n){return(n=n||t).fire=function(t,n,e){var r=this,i=r.hooks;return o(i[t])?(i[t].forEach((function(t){return t.apply(e||r,n)})),r):r},n.off=function(t,n){var e=this,r=e.hooks;if(!o(t))return r={},e;if(o(r[t]))if(o(n)){var i=r[t].length;if(0===i)delete r[t];else for(var u=0;u<i;++u)if(n===r[t][u]){r[t].splice(u,1);break}}else delete r[t];return e},n.on=function(t,n){var e=this.hooks;return o(e[t])||(e[t]=[]),o(n)&&e[t].push(n),this},t.hooks={},t}(e,dt.prototype)),e.attach(t,d({},dt.state,n||{}))):new dt(t,n):e}dt.from=function(t,n){return new dt(t,n)},dt.of=st,dt.state={n:"option-picker",options:null,with:[]},dt.version="2.0.0",ot(dt,"name",{value:"OptionPicker"});var pt=dt.prototype;ot(pt,"value",{get:function(){var t=ft(this.self);return""===t?null:t},set:function(t){this.fire("change",[v(t)])}});var ht=U((function(n,e,r,i){var o=u(e)?e:L(e)||"",a=s(o),f=n._mask,c=n.self,d=n.state,p=f.value,h=d.n;if(h+="__option",i){var m,_=ft(c);for(var b in r){var y=r[b];M(y._of,"selected"),S(y,h+"--selected")}for(var x in r){var w=r[x],E=s(L(w)+"\t"+(m=k(w,"value",!1)));if(""!==a&&a===E.slice(0,l(a))&&!O(w,h+"--disabled")){c.value=m,R(w._of,"selected",""),N(w,h+"--selected"),P(p,"value",m),B(p,g(w)),m!==_&&n.fire("change",[v(m)]);break}}}else for(var T in r){var A=r[T],C=s(L(A)+"\t"+k(A,"value",!1));""!==a&&!t(a,C)||O(A,h+"--disabled")?R(A,"hidden",""):M(A,"hidden")}n.fire(i?"search":"filter",[o])}),10);function mt(){var t=this,n=st(t).state.n;S(t,n+="--focus"),S(t,n+="-self")}function _t(){var t=this,n=st(t);n.mask;var e=n.state.n;S(t,e+="--focus"),S(t,e+="-option")}function bt(){var t=st(this),n=t._mask,e=t.mask,r=t.state,i=n.text,o=r.n;S(e,o+"--focus-text"),S(i,o+"__text--focus")}function kt(){var t=this,n=st(t),e=n._mask,r=n.self,i=e.hint;W((function(){return I(i,L(t,!1)?"":r.placeholder)}),1)()}function gt(){var t=this,n=st(t).state.n;N(t,n+="--focus"),N(t,n+="-self")}function yt(){var t=st(this),n=t.mask,e=t.state.n;Pt(),N(n,e+="--focus"),N(n,e+="-option")}function xt(){var t=st(this),n=t._mask,e=t.mask;t.self;var r=t.state,i=n.input,o=n.text,u=r.n;N(o,u+"__text--focus"),N(e,u+="--focus"),N(e,u+="-text"),L(i,!1)?zt(this):t.enter().fit()}function wt(t){var n,e=this,r=t.key,i=st(e),o=i._mask,u=i._options,a=i.self,s=i.state,f=o.hint,v=s.n;if(v+="__option--disabled",W((function(){return I(f,L(e,!1)?"":a.placeholder)}),1)(),Q!==r&&V!==r&&1!==l(r)||W((function(){return i.enter().fit()}),11)(),q===r||G===r||Z===r){var d=u[ft(a)];if(!d||d.hidden)for(d=c(u).shift();d&&(O(d,v)||d.hidden);)d=x(d);d&&ut(d),n=!0}else nt===r?i.exit():ht(i,e,u);n&&(X(t),Y(t))}var Et="",Tt=U((function(){return Et=""}),500);function Lt(t){var n,e=t.key,r=t.altKey,i=t.ctrlKey,o=st(this),u=o._options;Tt(),Q===e||V===e?Et="":tt===e?(Et="",o.exit(n=!0)):nt===e?(Et="",o.exit(!(n=!1))):q===e||G===e||Z===e||""===Et&&" "===e?o.enter(n=!0).fit():1!==l(e)||r||i||(Et+=e),""!==Et&&ht(o,Et,u,n=!0),n&&X(t)}function At(t){var n,e=this,r=t.key,i=t.altKey,o=t.ctrlKey,u=st(e),a=u._mask,s=u._options;u.mask;var f=u.self,d=u.state,p=a.hint,h=a.input,m=a.value,_=d.n;_+="__option";var b,E,A,C="input"===y(f);if(Q===r)u.exit(n=!0);else if(Z===r||tt===r||nt===r||" "===r){if(tt!==r){var j,K=ft(f);(A=s[ft(f)])&&(M(A._of,"selected"),S(A,_+"--selected")),R(e._of,"selected",""),N(e,_+"--selected"),f.value=j=k(e,"value",!1),C?(I(p,""),I(h,L(e))):(P(m,"value",j),B(m,g(e))),j!==K&&u.fire("change",[v(j)])}u.exit(n=nt!==r)}else if(q===r){for(n=!0,b=x(e);b&&(O(b,_+"--disabled")||b.hidden);)b=x(b);for(b?O(b,_+"-group")&&(b=b.firstElementChild||null):(E=w(e))&&O(E,_+"-group")&&(b=x(E));b&&(O(b,_+"--disabled")||b.hidden);)b=x(b);if(b)ut(b);else{var z=c(s).find((function(t){return!t.hidden&&!O(t,_+"--disabled")}));z&&ut(z)}}else if(G===r){for(n=!0,A=T(e);A&&(O(A,_+"--disabled")||A.hidden);)A=T(A);for(A?O(A,_+"-group")&&(A=function(t){return t.lastElementChild||null}(A)):(E=w(e))&&O(E,_+"-group")&&(A=T(E));A&&(O(A,_+"--disabled")||A.hidden);)A=T(A);if(A)ut(A);else{var D=c(s).findLast((function(t){return!t.hidden&&!O(t,_+"--disabled")}));D&&ut(D)}}else C&&1===l(r)&&!i&&!o&&I(p,""),u.exit(!(n=!1));n&&(X(t),Y(t))}function Ot(){var t=this,n=st(t),e=n._mask,r=n.self,i=e.hint;W((function(){return I(t,L(t))}))(),W((function(){return I(i,L(t,!1)?"":r.placeholder)}),1)()}function Ct(t){var n=st(this),e=n.state.n;n[O(this,e+"--open")?"exit":"enter"](!0).fit(),X(t)}function Mt(t){var n=this,e=st(n),r=e._mask,i=e._options,o=e.self,u=e.state,a=r.hint,s=r.input,f=r.value,l=u.n;l+="__option--selected";var c,d=ft(o);for(var p in i){var h=i[p];n!==h&&(M(h._of,"selected"),S(h,l))}R(n._of,"selected",""),N(n,l),o.value=c=k(n,"value",!1),"input"===y(o)?(I(a,""),I(s,L(n))):(P(f,"value",c),B(f,g(n))),c!==d&&e.fire("change",[v(c)]),X(t)}function St(t){var n=st(this);if(n){var e=n.mask,r=n.state.n,i=t.target;e!==i&&e!==w(i,"."+r)&&(n.exit(),rt.delete(this))}}function jt(t){st(this).let().fire("reset",[t])}function Rt(){var t=st(this);t&&et(t)}function Kt(){Rt.call(this)}function Nt(t){return st(this).fire("submit",[t])}function Pt(t){var n=h.getSelection();n.rangeCount&&n.removeRange(n.getRangeAt(0))}function zt(t,n){var e=h.getSelection();Pt();var r=h.createRange();r.selectNodeContents(t),e.addRange(r),1===n?e.collapseToEnd():-1===n&&e.collapseToStart()}return pt.attach=function(t,r){var a=this;t=t||a.self,r=r||a.state,a._active=!lt(t)&&!ct(t),a._options={},a._value=ft(t)||null,a.self=t,a.state=r;var s="input"===y(t),f=r.n,c=z("span",{class:f+"__arrow"}),v=E(t),d=z("div",{class:f,tabindex:!lt(t)&&!s&&0});a.mask=d;var p=z("div",{class:f+"__options"}),h=r.options;e(h)&&(h=h.call(a));var _=new Map;if(n(h))h.forEach((function(t){var e,r;n(t)?(t[0]=null!=(e=t[0])?e:"",t[1]=null!=(r=t[1])?r:{},_.set(t[0],t)):_.set(t,[t,{}])}));else if(i(h))for(var T in h){var A,O;if(n(h[T]))h[T][0]=null!=(A=h[T][0])?A:"",h[T][1]=null!=(O=h[T][1])?O:{};else _.set(T,[h[T],{}])}it.call(a,p,h=_);var C,M,S=z("div",{class:f+"__values"}),j=z("span",{class:f+"__"+(s?"text":"value")}),D=z("span",{contenteditable:!(lt(t)||ct(t)||!s)&&"",spellcheck:!!s&&"false"}),H=z("span",s?t.placeholder+"":"");K(d,S),K(d,p),K(S,j),K(S,c),s?($("blur",D,bt),$("cut",D,kt),$("focus",D,xt),$("keydown",D,wt),$("paste",D,Ot),K(j,D),K(j,H),vt(D,a)):($("blur",d,mt),$("focus",d,gt),$("keydown",d,Lt)),N(t,f+"__self"),M=d,w(C=t).insertBefore(M,x(C,!0)),v&&($("reset",v,jt),$("submit",v,Nt),vt(v,a)),$("mousedown",b,St),$("mousedown",d,Ct),$("resize",m,Rt),$("scroll",m,Kt),$("touchstart",b,St),$("touchstart",d,Ct),t.tabIndex=-1,vt(d,a);var U,W={};if(W.hint=s?H:null,W.input=s?D:null,W.of=t,W.options=p,W.root=b,W.self=d,W[s?"text":"value"]=j,a._mask=W,(U=a._options[a._value])&&(R(U._of,"selected",""),s?(I(D,L(U)),L(D,!1)&&I(H,"")):(P(j,"value",k(U,"value",!1)),B(j,g(U)))),o(r)&&n(r.with))for(var F=0,J=l(r.with);F<J;++F){var X=r.with[F];u(X)&&(X=dt[X]),e(X)?X.call(a,t,r):i(X)&&e(X.attach)&&X.attach.call(a,t,r)}return a},pt.blur=function(){Pt();var t=this,n=t._mask,e=t.mask;return(n.input||e).blur(),t.exit()},pt.detach=function(){var t,r=this,o=r._mask,a=r.mask,s=r.self,f=r.state,c=o.input,v=E(s);if(r._active=!1,r._value=ft(s)||null,v&&(J("reset",v,jt),J("submit",v,Nt)),c&&(J("blur",c,bt),J("blur",a,mt),J("cut",c,kt),J("focus",c,xt),J("focus",a,gt),J("keydown",c,wt),J("keydown",a,Lt),J("paste",c,Ot)),J("mousedown",b,St),J("mousedown",a,Ct),J("resize",m,Rt),J("scroll",m,Kt),J("touchstart",b,St),J("touchstart",a,Ct),n(f.with))for(var d=0,p=l(f.with);d<p;++d){var h=f.with[d];u(h)&&(h=dt[h]),i(h)&&e(h.detach)&&h.detach.call(r,s,f)}return s.tabIndex=null,S(s,f.n+"__self"),w(t=a),t.remove(),r._mask={of:s},r.mask=null,r},pt.enter=function(t){var n,e=this,r=e._mask,i=e._options,o=e.mask,u=e.self,a=e.state,s=r.input,f=a.n;N(o,f+"--focus"),N(o,f+"--focus-option"),N(o,f+="--open");var l=st(b);return l&&e!==l&&l.exit(),vt(b,e),vt(m,e),e.fire("enter"),t&&(e.fire("focus"),"input"===y(u)?(ut(s),zt(s)):(n=i[ft(u)])&&ut(n),e.fire("focus.option")),e},pt.exit=function(t){var n=this,e=n._mask,r=n.mask,i=n.self,o=n.state,u=e.input,a=o.n;return S(r,a+"--focus"),S(r,a+"--focus-option"),S(r,a+="--open"),n.fire("exit"),t&&("input"===y(i)?(ut(u),zt(u)):ut(r),n.fire("focus").fire("focus.self")),n},pt.fit=function(){var t=this,n=t._mask,e=t.mask,r=n.options,i=F(e),o=F(m);return i[1]+i[3]/2>o[3]/2?H(r,{bottom:"100%","max-height":i[1],top:"auto"}):H(r,{bottom:"auto","max-height":o[3]-i[1]-i[3],top:"100%"}),t},pt.focus=function(t){var n=this,e=n._mask,r=n.mask,i=e.input;return i?(ut(i),zt(i,t),n):(r&&ut(r),n)},dt}));