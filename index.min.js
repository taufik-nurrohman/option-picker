/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},r=function(t,e){return t&&o(e)&&t instanceof e},i=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||r(t,Object))},o=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},a=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return f(e)}))},s=function(t){return t.toLowerCase()},f=function(t){return t.toUpperCase()},l=function(t){return t.length},c=function(t){return Object.values(t)},v=function(t){if(e(t))return t.map((function(t){return v(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(t))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(t);if(i(t)){for(var n in t)t[n]=v(t[n]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},d=function(){for(var n=arguments.length,r=Array(n),u=0;u<n;u++)r[u]=arguments[u];for(var a=r.shift(),s=0,f=l(r);s<f;++s)for(var c in r[s])if(o(a[c]))if(e(a[c])&&e(r[s][c])){a[c]=[].concat(a[c]);for(var v=0,p=l(r[s][c]);v<p;++v)t(r[s][c][v],a[c])||a[c].push(r[s][c][v])}else i(a[c])&&i(r[s][c])?a[c]=d({},a[c],r[s][c]):a[c]=r[s][c];else a[c]=r[s][c];return a},p=function(t){if(e(t))return t.map((function(e){return p(t)}));if(i(t)){for(var n in t)t[n]=p(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},h=document,_=window,m=h.body,b=h.documentElement,g=function(t,e,n){var r=function(t,e,n){if(void 0===n&&(n=!0),!O(t,e))return null;var r=t.getAttribute(e);return n?v(r):r}(t,"data-"+e,n);return r},k=function(t,e){void 0===e&&(e=!0);var n="innerHTML";if(!C(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},y=function(t){return s(t&&t.nodeName||"")||null},x=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},w=function(t,e){return e?t.closest(e)||null:t.parentNode||null},E=function(t){var e="form";return C(t,e)&&e===y(t[e])?t[e]:w(t,e)},L=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},A=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!C(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},O=function(t,e){return t.hasAttribute(e)},T=function(t,e){return t.classList.contains(e)},C=function(t,e){return e in t},j=function(t,e){return t.removeAttribute(e),t},M=function(t,e){return t.classList.remove(e),t},R=function(t,e){return t.style[a(e)]=null,t},S=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,p(n)),t},K=function(t,e){return t.append(e),e},N=function(t,e){return t.classList.add(e),t},P=function(t,n,r){return(e(r)||i(r))&&(r=JSON.stringify(r)),S(t,"data-"+n,r)},z=function(t,e,n){return t=u(t)?h.createElement(t):t,i(e)&&(n=e,e=!1),u(e)&&B(t,e),i(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?S(t,r,n):j(t,r)}(t,n),t},B=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return C(t,r)&&(t[r]=n?e.trim():e),t},D=function(t,e,n){return"number"==typeof n&&(n+="px"),t.style[a(e)]=p(n),t},H=function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?D(t,r,n):R(t,r);return t},I=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="textContent";return C(t,r)&&(t[r]=n?e.trim():e),t},U=function(t,e){var n;return function(){var r=arguments,i=this;n&&clearTimeout(n),n=setTimeout((function(){return t.apply(i,r)}),e)}},F=function(t,e){return function(){var n=arguments,r=this;setTimeout((function(){return t.apply(r,n)}),e)}},J=function(t){var e,n,r,i,o,u,a;return!function(t){return t===_}(t)?(i=(n=t.getBoundingClientRect()).left,o=n.top,r=n.width,e=n.height,u=n.right,a=n.bottom):(i=t.pageXOffset||b.scrollLeft||m.scrollLeft,o=t.pageYOffset||b.scrollTop||m.scrollTop,r=t.innerWidth,e=t.innerHeight),[i,o,r,e,u,a]};var W=function(t,e,n){e.removeEventListener(t,n)},X=function(t){return t&&t.preventDefault()},Y=function(t){return t&&t.stopPropagation()},$=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)},q="ArrowDown",G="ArrowUp",Q="Backspace",V="Delete",Z="Enter",tt="Escape",et="Tab",nt=U((function(t){return t.fit()}),10),rt="OptionPicker";function it(t,e){var n,i=this,o=i.self,u=i.state.n;u+="__option",(e=r(e,Map)&&e.size>0?e:at(o)).forEach((function(e,r){"data-group"in e[1]?n||K(t,n=z("span",{class:u+"-group","data-value":e[1]["data-group"]})):n=!1;var o=e[1],a=o.disabled,s=o.selected,f=o.value,l=z("span",e[0],{class:u+(a?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":p(f||r),tabindex:!a&&-1});a||($("blur",l,ht),$("focus",l,gt),$("keydown",l,Lt),$("mousedown",l,Tt),$("touchstart",l,Tt)),l._of=e[2],l["_"+rt]=i,i._options[r]=l,K(n||t,l)})),i.state.options=e}function ot(t,e,n){Object.defineProperty(t,e,n)}function ut(t){t.focus()}function at(t){var e,n,r=new Map,i=st(t),o=[];n="input"===y(t)?(n=t.list)?n.children:[]:t.children;for(var u=function(t){var e=n[t],i=function(t,e){void 0===e&&(e=!0);for(var n,r=t.attributes,i={},o=0,u=r.length;o<u;++o)n=r[o].value,i[r[o].name]=e?v(n):n;return i}(e);if(["disabled","selected"].forEach((function(e){e in i?(i[e]=""===i[e]||i[e],"selected"===e&&o.push(t)):i[e]=null})),"optgroup"===y(e))return at(e).forEach((function(t,n){t[1]["data-group"]=e.label,r.set(n,t)})),1;r.set(e.value,[A(e)||e.value,i,e])},a=0,s=l(n);a<s;++a)u(a);return 0===l(o)&&(e=r.get(i))&&(e[1].selected=!0,r.set(i,e)),r}function st(t){return(t.value||"").replace(/\r/g,"")}function ft(t){return t.disabled}function lt(t){return t.readOnly}function ct(t,e){var n=this;return t?r(n,ct)?(t["_"+rt]=function(t,e){return(e=e||t).fire=function(t,e,n){var r=this,i=r.hooks;return o(i[t])?(i[t].forEach((function(t){return t.apply(n||r,e)})),r):r},e.off=function(t,e){var n=this,r=n.hooks;if(!o(t))return r={},n;if(o(r[t]))if(o(e)){var i=r[t].length;if(0===i)delete r[t];else for(var u=0;u<i;++u)if(e===r[t][u]){r[t].splice(u,1);break}}else delete r[t];return n},e.on=function(t,e){var n=this.hooks;return o(n[t])||(n[t]=[]),o(e)&&n[t].push(e),this},t.hooks={},t}(n,ct.prototype),n.attach(t,d({},ct.state,e||{}))):new ct(t,e):n}ct.state={n:"option-picker",options:null,with:[]},ct.version="2.0.0",ot(ct,"name",{value:rt});var vt=ct.prototype;ot(vt,"value",{get:function(){var t=st(this.self);return""===t?null:t},set:function(t){this.fire("change",[v(t)])}});var dt=U((function(e,n,r,i){var o=u(n)?n:A(n)||"",a=s(o),f=e._mask,c=e.self,d=e.state,p=f.value,h=d.n;if(h+="__option",i){var _,m=st(c);for(var b in r){var y=r[b];j(y._of,"selected"),M(y,h+"--selected")}for(var x in r){var w=r[x],E=s(A(w)+"\t"+(_=g(w,"value",!1)));if(""!==a&&a===E.slice(0,l(a))&&!T(w,h+"--disabled")){c.value=_,S(w._of,"selected",""),N(w,h+"--selected"),P(p,"value",_),B(p,k(w)),_!==m&&e.fire("change",[v(_)]);break}}}else for(var L in r){var O=r[L],C=s(A(O)+"\t"+g(O,"value",!1));""!==a&&!t(a,C)||T(O,h+"--disabled")?S(O,"hidden",""):j(O,"hidden")}e.fire(i?"search":"filter",[o])}),10);function pt(){var t=this,e=t["_"+rt].state.n;M(t,e+="--focus"),M(t,e+="-self")}function ht(){var t=this["_"+rt],e=t.mask,n=t.state.n;M(e,n+"--focus-option")}function _t(){var t=this["_"+rt],e=t._mask,n=t.mask,r=t.state,i=e.text,o=r.n;M(n,o+"--focus-text"),M(i,o+"__text--focus")}function mt(){var t=this,e=t["_"+rt],n=e._mask,r=e.self,i=n.hint;F((function(){return I(i,A(t,!1)?"":r.placeholder)}),1)()}function bt(){var t=this,e=t["_"+rt].state.n;N(t,e+="--focus"),N(t,e+="-self")}function gt(){var t=this["_"+rt],e=t.mask,n=t.state.n;Kt(),N(e,n+="--focus"),N(e,n+="-option")}function kt(){var t=this["_"+rt],e=t._mask,n=t.mask;t.self;var r=t.state,i=e.input,o=e.text,u=r.n;N(o,u+"__text--focus"),N(n,u+="--focus"),N(n,u+="-text"),A(i,!1)?Nt(this):t.enter().fit()}function yt(t){var e,n=this,r=t.key,i=n["_"+rt],o=i._mask,u=i._options,a=i.self,s=i.state,f=o.hint,v=s.n;if(v+="__option--disabled",F((function(){return I(f,A(n,!1)?"":a.placeholder)}),1)(),Q!==r&&V!==r&&1!==l(r)||F((function(){return i.enter().fit()}),11)(),q===r||G===r||Z===r){var d=u[st(a)];if(!d||d.hidden)for(d=c(u).shift();d&&(T(d,v)||d.hidden);)d=x(d);d&&ut(d),e=!0}else et===r?i.exit():dt(i,n,u);e&&(X(t),Y(t))}var xt="",wt=U((function(){return xt=""}),500);function Et(t){var e,n=t.key,r=t.altKey,i=t.ctrlKey,o=this["_"+rt],u=o._options;wt(),Q===n||V===n?xt="":tt===n?(xt="",o.exit(e=!0)):et===n?(xt="",o.exit(!(e=!1))):q===n||G===n||Z===n||""===xt&&" "===n?o.enter(e=!0).fit():1!==l(n)||r||i||(xt+=n),""!==xt&&dt(o,xt,u,e=!0),e&&X(t)}function Lt(t){var e,n=this,r=t.key,i=t.altKey,o=t.ctrlKey,u=n["_"+rt],a=u._mask,s=u._options;u.mask;var f=u.self,d=u.state,p=a.hint,h=a.input,_=a.value,m=d.n;m+="__option";var b,E,O,C="input"===y(f);if(Q===r)u.exit(e=!0);else if(Z===r||tt===r||et===r||" "===r){if(tt!==r){var R,K=st(f);(O=s[st(f)])&&(j(O._of,"selected"),M(O,m+"--selected")),S(n._of,"selected",""),N(n,m+"--selected"),f.value=R=g(n,"value",!1),C?(I(p,""),I(h,A(n))):(P(_,"value",R),B(_,k(n))),R!==K&&u.fire("change",[v(R)])}u.exit(e=et!==r)}else if(q===r){for(e=!0,b=x(n);b&&(T(b,m+"--disabled")||b.hidden);)b=x(b);for(b?T(b,m+"-group")&&(b=b.firstElementChild||null):(E=w(n))&&T(E,m+"-group")&&(b=x(E));b&&(T(b,m+"--disabled")||b.hidden);)b=x(b);if(b)ut(b);else{var z=c(s).find((function(t){return!t.hidden&&!T(t,m+"--disabled")}));z&&ut(z)}}else if(G===r){for(e=!0,O=L(n);O&&(T(O,m+"--disabled")||O.hidden);)O=L(O);for(O?T(O,m+"-group")&&(O=function(t){return t.lastElementChild||null}(O)):(E=w(n))&&T(E,m+"-group")&&(O=L(E));O&&(T(O,m+"--disabled")||O.hidden);)O=L(O);if(O)ut(O);else{var D=c(s).findLast((function(t){return!t.hidden&&!T(t,m+"--disabled")}));D&&ut(D)}}else C&&1===l(r)&&!i&&!o&&I(p,""),u.exit(!(e=!1));e&&(X(t),Y(t))}function At(){var t=this,e=t["_"+rt],n=e._mask,r=e.self,i=n.hint;F((function(){return I(t,A(t))}))(),F((function(){return I(i,A(t,!1)?"":r.placeholder)}),1)()}function Ot(t){var e=this["_"+rt],n=e.state.n;e[T(this,n+"--open")?"exit":"enter"](!0).fit(),X(t)}function Tt(t){var e=this,n=e["_"+rt],r=n._mask,i=n._options,o=n.self,u=n.state,a=r.hint,s=r.input,f=r.value,l=u.n;l+="__option--selected";var c,d=st(o);for(var p in i){var h=i[p];e!==h&&(j(h._of,"selected"),M(h,l))}S(e._of,"selected",""),N(e,l),o.value=c=g(e,"value",!1),"input"===y(o)?(I(a,""),I(s,A(e))):(P(f,"value",c),B(f,k(e))),c!==d&&n.fire("change",[v(c)]),X(t)}function Ct(t){var e=this["_"+rt];if(e){var n=e.mask,r=e.state.n,i=t.target;n!==i&&n!==w(i,"."+r)&&(e.exit(),delete this["_"+rt])}}function jt(t){this["_"+rt].let().fire("reset",[t])}function Mt(){var t=this["_"+rt];t&&nt(t)}function Rt(){Mt.call(this)}function St(t){return this["_"+rt].fire("submit",[t])}function Kt(t){var e=h.getSelection();e.rangeCount&&e.removeRange(e.getRangeAt(0))}function Nt(t,e){var n=h.getSelection();Kt();var r=h.createRange();r.selectNodeContents(t),n.addRange(r)}return vt.attach=function(t,r){var a=this;t=t||a.self,r=r||a.state,a._active=!ft(t)&&!lt(t),a._options={},a._value=st(t)||null,a.self=t,a.state=r;var s="input"===y(t),f=r.n,c=z("span",{class:f+"__arrow"}),v=E(t),d=z("div",{class:f,tabindex:!ft(t)&&!s&&0});a.mask=d;var p=z("div",{class:f+"__options"}),h=r.options;n(h)&&(h=h.call(a));var m=new Map;if(e(h))h.forEach((function(t){var n,r;e(t)?(t[0]=null!=(n=t[0])?n:"",t[1]=null!=(r=t[1])?r:{},m.set(t[0],t)):m.set(t,[t,{}])}));else if(i(h))for(var L in h){var O,T;if(e(h[L]))h[L][0]=null!=(O=h[L][0])?O:"",h[L][1]=null!=(T=h[L][1])?T:{};else m.set(L,[h[L],{}])}it.call(a,p,h=m);var C,j,M=z("div",{class:f+"__values"}),R=z("span",{class:f+"__"+(s?"text":"value")}),D=z("span",{contenteditable:!(ft(t)||lt(t)||!s)&&"",spellcheck:!!s&&"false"}),H=z("span",s?t.placeholder+"":"");K(d,M),K(d,p),K(M,R),K(M,c),s?(K(R,D),K(R,H),$("blur",D,_t),$("cut",D,mt),$("focus",D,kt),$("keydown",D,yt),$("paste",D,At),D["_"+rt]=a):($("blur",d,pt),$("focus",d,bt),$("keydown",d,Et)),N(t,f+"__self"),j=d,w(C=t).insertBefore(j,x(C,!0)),v&&(v["_"+rt]=a,$("reset",v,jt),$("submit",v,St)),$("mousedown",b,Ct),$("mousedown",d,Ot),$("resize",_,Mt),$("scroll",_,Rt),$("touchstart",b,Ct),$("touchstart",d,Ot),t.tabIndex=-1,d["_"+rt]=a;var U,F={};if(F.hint=s?H:null,F.input=s?D:null,F.of=t,F.options=p,F.root=b,F.self=d,F[s?"text":"value"]=R,a._mask=F,(U=a._options[a._value])&&(S(U._of,"selected",""),s?(I(D,A(U)),A(D,!1)&&I(H,"")):(P(R,"value",g(U,"value",!1)),B(R,k(U)))),o(r)&&e(r.with))for(var J=0,W=l(r.with);J<W;++J){var X=r.with[J];u(X)&&(X=ct[X]),n(X)?X.call(a,t,r):i(X)&&n(X.attach)&&X.attach.call(a,t,r)}return a},vt.blur=function(){},vt.detach=function(){var t,r=this,o=r._mask,a=r.mask,s=r.self,f=r.state,c=o.input,v=E(s);if(r._active=!1,r._value=st(s)||null,v&&(W("reset",v,jt),W("submit",v,St)),c&&(W("blur",c,_t),W("blur",a,pt),W("cut",c,mt),W("focus",c,kt),W("focus",a,bt),W("keydown",c,yt),W("keydown",a,Et),W("paste",c,At)),W("mousedown",b,Ct),W("mousedown",a,Ot),W("resize",_,Mt),W("scroll",_,Rt),W("touchstart",b,Ct),W("touchstart",a,Ot),e(f.with))for(var d=0,p=l(f.with);d<p;++d){var h=f.with[d];u(h)&&(h=ct[h]),i(h)&&n(h.detach)&&h.detach.call(r,s,f)}return s.tabIndex=null,M(s,f.n+"__self"),w(t=a),t.remove(),r._mask={of:s},r.mask=null,r},vt.enter=function(t){var e,n=this,r=n._mask,i=n._options,o=n.mask,u=n.self,a=n.state,s=r.input,f=a.n;return N(o,f+="--open"),b["_"+rt]&&b["_"+rt]!==n&&b["_"+rt].exit(),b["_"+rt]=n,_["_"+rt]=n,n.fire("enter"),t&&(n.fire("focus"),"input"===y(u)?(ut(s),Nt(s)):(e=i[st(u)])&&ut(e),n.fire("focus.option")),n},vt.exit=function(t){var e=this,n=e._mask,r=e.mask,i=e.self,o=e.state,u=n.input,a=o.n;return M(r,a+="--open"),e.fire("exit"),t&&("input"===y(i)?(ut(u),Nt(u)):ut(r),e.fire("focus").fire("focus.self")),e},vt.fit=function(){var t=this,e=t._mask,n=t.mask,r=e.options,i=J(n),o=J(_);return i[1]+i[3]/2>o[3]/2?H(r,{bottom:"100%","max-height":i[1],top:"auto"}):H(r,{bottom:"auto","max-height":o[3]-i[1]-i[3],top:"100%"}),t},vt.focus=function(){},ct}));