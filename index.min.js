/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=n()}(this,(function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},r=function(t,n,e){return!(!t||"object"!=typeof t)&&(e?o(n)&&o(t.constructor)&&n===t.constructor:o(n)&&t instanceof n)},i=function(t,n){return void 0===n&&(n=!0),!(!t||"object"!=typeof t)&&(!n||r(t,Object,1))},o=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},a=function(t){return t.replace(/[-_.](\w)/g,(function(t,n){return f(n)}))},s=function(t){return t.toLowerCase()},f=function(t){return t.toUpperCase()},c=function(t){return t.length},l=function(t){return Object.keys(t)},v=function(t){return Object.values(t)},d=function(t){if(n(t))return t.map((function(t){return d(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(t))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(t);if(i(t)){for(var e in t)t[e]=d(t[e]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},p=function(){for(var e=arguments.length,r=Array(e),u=0;u<e;u++)r[u]=arguments[u];for(var a=r.shift(),s=0,f=c(r);s<f;++s)for(var l in r[s])if(o(a[l]))if(n(a[l])&&n(r[s][l])){a[l]=[].concat(a[l]);for(var v=0,d=c(r[s][l]);v<d;++v)t(r[s][l][v],a[l])||a[l].push(r[s][l][v])}else i(a[l])&&i(r[s][l])?a[l]=p({},a[l],r[s][l]):a[l]=r[s][l];else a[l]=r[s][l];return a},h=function(t){if(n(t))return t.map((function(n){return h(t)}));if(i(t)){for(var e in t)t[e]=h(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},m=document,_=window,k=m.body,b=m.documentElement,g=function(t){return t.firstElementChild||null},y=function(t){return t.lastElementChild||null},x=function(t,n,e){var r=function(t,n,e){if(void 0===e&&(e=!0),!j(t,n))return null;var r=t.getAttribute(n);return e?d(r):r}(t,"data-"+n,e);return r},w=function(t,n){void 0===n&&(n=!0);var e="innerHTML";if(!S(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},T=function(t){return s(t&&t.nodeName||"")||null},E=function(t,n){return t["next"+(n?"":"Element")+"Sibling"]||null},L=function(t,n){return n?t.closest(n)||null:t.parentNode||null},O=function(t){var n="form";return S(t,n)&&n===T(t[n])?t[n]:L(t,n)},A=function(t,n){return t["previous"+(n?"":"Element")+"Sibling"]||null},C=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!S(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},j=function(t,n){return t.hasAttribute(n)},M=function(t,n){return t.classList.contains(n)},S=function(t,n){return n in t},R=function(t,n){return t.removeAttribute(n),t},K=function(t,n){return t.classList.remove(n),t},N=function(t,n){return t.style[a(n)]=null,t},P=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,h(e)),t},z=function(t,n){return t.append(n),n},B=function(t,n){return t.classList.add(n),t},D=function(t,e,r){return(n(r)||i(r))&&(r=JSON.stringify(r)),P(t,"data-"+e,r)},H=function(t,n,e){return t=u(t)?m.createElement(t):t,i(n)&&(e=n,n=!1),u(n)&&I(t,n),i(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?P(t,r,e):R(t,r)}(t,e),t},I=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return S(t,r)&&(t[r]=e?n.trim():n),t},Y=function(t,n,e){return"number"==typeof e&&(e+="px"),t.style[a(n)]=h(e),t},U=function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?Y(t,r,e):N(t,r);return t},W=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return S(t,r)&&(t[r]=e?n.trim():n),t},F=function(t,n){var e;return function(){var r=arguments,i=this;e&&clearTimeout(e),e=setTimeout((function(){return t.apply(i,r)}),n)}},J=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}},X=function(t){var n,e,r,i,o,u,a;return!function(t){return t===_}(t)?(i=(e=t.getBoundingClientRect()).left,o=e.top,r=e.width,n=e.height,u=e.right,a=e.bottom):(i=t.pageXOffset||b.scrollLeft||k.scrollLeft,o=t.pageYOffset||b.scrollTop||k.scrollTop,r=t.innerWidth,n=t.innerHeight),[i,o,r,n,u,a]};var $=function(t,n,e){n.removeEventListener(t,e)},q=function(t){return t&&t.preventDefault()},G=function(t){return t&&t.stopPropagation()},Q=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},V="ArrowDown",Z="ArrowUp",tt="Backspace",nt="Delete",et="Enter",rt="Escape",it="Tab",ot=F((function(t){return t.fit()}),10),ut=new WeakMap;function at(t,n){var e,i=this,o=i.self,u=i.state.n;u+="__option",lt(n=r(n,Map)&&n.size>0?n:vt(o),(function(n,r){"data-group"in n[1]?e&&x(e,"value",!1)===n[1]["data-group"]||z(t,e=H("span",{class:u+"-group","data-value":n[1]["data-group"]})):e=!1;var o=n[1],a=o.disabled,s=o.selected,f=o.value,c=H("span",n[0],{class:u+(a?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":h(f||r),tabindex:!a&&-1});a||(Q("blur",c,Tt),Q("focus",c,At),Q("keydown",c,Kt),Q("mousedown",c,Bt),Q("touchend",c,Yt),Q("touchstart",c,Bt)),c._={},c._[0]=n[2],i._options[r]=c,z(e||t,c),kt(c,i)})),i.state.options=n}function st(t,n,e){Object.defineProperty(t,n,e)}function ft(t){t.focus()}function ct(t,n){t.forEach(n)}function lt(t,n){ct(t,n)}function vt(t){var n,e,r=new Map,i=pt(t),o=[];e="input"===T(t)?(e=t.list)?e.children:[]:t.children;for(var u=function(t){var n=e[t],i=function(t,n){void 0===n&&(n=!0);for(var e,r=t.attributes,i={},o=0,u=r.length;o<u;++o)e=r[o].value,i[r[o].name]=n?d(e):e;return i}(n);if(ct(["disabled","selected"],(function(n){n in i?(i[n]=""===i[n]||i[n],"selected"===n&&o.push(t)):i[n]=null})),"optgroup"===T(n))return lt(vt(n),(function(t,e){t[1]["data-group"]=n.label,bt(e,t,r)})),1;bt(n.value,[C(n)||n.value,i,n],r)},a=0,s=c(e);a<s;++a)u(a);return 0===c(o)&&(n=ht(i,r))&&(n[1].selected=!0,bt(i,n,r)),r}function dt(t){return ht(t,ut)||null}function pt(t){return(t.value||"").replace(/\r/g,"")}function ht(t,n){return n.get(t)}function mt(t){return t.disabled}function _t(t){return t.readOnly}function kt(t,n){return bt(t,n,ut)}function bt(t,n,e){return e.set(t,n)}function gt(t,n){var e=this;return t?r(e,gt)?(kt(t,function(t,n){return(n=n||t).fire=function(t,n,e){var r=this,i=r.hooks;return o(i[t])?(i[t].forEach((function(t){return t.apply(e||r,n)})),r):r},n.off=function(t,n){var e=this,r=e.hooks;if(!o(t))return r={},e;if(o(r[t]))if(o(n)){var i=r[t].length;if(0===i)delete r[t];else for(var u=0;u<i;++u)if(n===r[t][u]){r[t].splice(u,1);break}}else delete r[t];return e},n.on=function(t,n){var e=this.hooks;return o(e[t])||(e[t]=[]),o(n)&&e[t].push(n),this},t.hooks={},t}(e,gt.prototype)),e.attach(t,p({},gt.state,n||{}))):new gt(t,n):e}gt.from=function(t,n){return new gt(t,n)},gt.of=dt,gt.state={n:"option-picker",options:null,with:[]},gt.version="2.0.0",st(gt,"name",{value:"OptionPicker"});var yt=gt.prototype;st(yt,"value",{get:function(){var t=pt(this.self);return""===t?null:t},set:function(t){this.fire("change",[d(t)])}});var xt=F((function(n,e,r,i){var o=u(e)?e:C(e)||"",a=s(o),f=n._mask,v=n.self,p=n.state,h=f.options,m=f.value,_=p.n;if(_+="__option",i){var k,b=pt(v);for(var g in r){var y=r[g];R(y._[0],"selected"),K(y,_+"--selected")}for(var T in r){var E=r[T],L=s(C(E)+"\t"+(k=x(E,"value",!1)));if(""!==a&&a===L.slice(0,c(a))&&!M(E,_+"--disabled")){v.value=k,P(E._[0],"selected",""),B(E,_+"--selected"),D(m,"value",k),I(m,w(E)),k!==b&&n.fire("change",[d(k)]);break}}}else{var O=c(l(r));for(var A in r){var j=r[A],S=s(C(j)+"\t"+x(j,"value",!1));""!==a&&!t(a,S)||M(j,_+"--disabled")?(j.hidden=!0,--O):j.hidden=!1}h.hidden=!O}n.fire("search",[o])}),10);function wt(){var t=this,n=dt(t).state.n;K(t,n+="--focus"),K(t,n+="-self")}function Tt(){var t=this,n=dt(t);n.mask;var e=n.state.n;K(t,e+="--focus"),K(t,e+="-option")}function Et(){var t=dt(this),n=t._mask,e=t.mask,r=t.state,i=n.text,o=r.n;K(e,o+"--focus-text"),K(i,o+"__text--focus")}function Lt(){var t=this,n=dt(t),e=n._mask,r=n.self,i=e.hint;J((function(){return W(i,C(t,!1)?"":r.placeholder)}),1)()}function Ot(){var t=this,n=dt(t).state.n;B(t,n+="--focus"),B(t,n+="-self")}function At(){var t=dt(this),n=t.mask,e=t.state.n;$t(),B(n,e+="--focus"),B(n,e+="-option")}function Ct(){var t=dt(this),n=t._mask,e=t.mask;t.self;var r=t.state,i=n.input,o=n.text,u=r.n;B(o,u+"__text--focus"),B(e,u+="--focus"),B(e,u+="-text"),C(i,!1)?qt(this):t.enter().fit()}function jt(t){var n,e=this,r=t.key,i=dt(e),o=i._mask,u=i._options,a=i.self,s=i.state,f=o.hint,l=s.n;if(l+="__option--disabled",J((function(){return W(f,C(e,!1)?"":a.placeholder)}),1)(),tt!==r&&nt!==r&&1!==c(r)||J((function(){return i.enter().fit()}),11)(),V===r||Z===r||et===r){var d=u[pt(a)];if(!d||d.hidden)for(d=v(u).shift();d&&(M(d,l)||d.hidden);)d=E(d);d&&ft(d),n=!0}else it===r?i.exit():xt(i,e,u);n&&(q(t),G(t))}var Mt="",St=F((function(){return Mt=""}),500);function Rt(t){var n,e=t.key,r=t.altKey,i=t.ctrlKey,o=dt(this),u=o._options,a=o.self;if(St(),mt(a)||_t(a))return q(t);tt===e||nt===e?Mt="":rt===e?(Mt="",o.exit(n=!0)):it===e?(Mt="",o.exit(!(n=!1))):V===e||Z===e||et===e||""===Mt&&" "===e?o.enter(n=!0).fit():1!==c(e)||r||i||(Mt+=e),""!==Mt&&xt(o,Mt,u,n=!0),n&&q(t)}function Kt(t){var n,e=this,r=t.key,i=t.altKey,o=t.ctrlKey,u=dt(e),a=u._mask,s=u._options;u.mask;var f=u.self,l=u.state,p=a.hint,h=a.input,m=a.value,_=l.n;_+="__option";var k,b,O,j="input"===T(f);if(tt===r)u.exit(n=!0);else if(et===r||rt===r||it===r||" "===r){if(rt!==r){var S,N=pt(f);(O=s[pt(f)])&&(R(O._[0],"selected"),K(O,_+"--selected")),P(e._[0],"selected",""),B(e,_+"--selected"),f.value=S=x(e,"value",!1),j?(W(p,""),W(h,C(e))):(D(m,"value",S),I(m,w(e))),S!==N&&u.fire("change",[d(S)])}u.exit(n=it!==r)}else if(V===r){for(n=!0,k=E(e);k&&(M(k,_+"--disabled")||k.hidden);)k=E(k);for(k?M(k,_+"-group")&&(k=g(k)):((b=L(e))&&M(b,_+"-group")&&(k=E(b)),k&&M(k,_+"-group")&&(k=g(k)));k&&(M(k,_+"--disabled")||k.hidden);)k=E(k);if(k)ft(k);else{var z=v(s).find((function(t){return!t.hidden&&!M(t,_+"--disabled")}));z&&ft(z)}}else if(Z===r){for(n=!0,O=A(e);O&&(M(O,_+"--disabled")||O.hidden);)O=A(O);for(O?M(O,_+"-group")&&(O=y(O)):((b=L(e))&&M(b,_+"-group")&&(O=A(b)),O&&M(O,_+"-group")&&(O=y(O)));O&&(M(O,_+"--disabled")||O.hidden);)O=A(O);if(O)ft(O);else{var H=v(s).findLast((function(t){return!t.hidden&&!M(t,_+"--disabled")}));H&&ft(H)}}else j&&1===c(r)&&!i&&!o&&W(p,""),u.exit(!(n=!1));n&&(q(t),G(t))}function Nt(){var t=this,n=dt(t),e=n._mask,r=n.self,i=e.hint;J((function(){return W(t,C(t))}))(),J((function(){return W(i,C(t,!1)?"":r.placeholder)}),1)()}function Pt(t){var n=dt(this),e=n.self,r=n.state.n,i=t.target;q(t),mt(e)||_t(e)||M(i,r+"__options")||L(i,"."+r+"__options")||n[M(this,r+"--open")?"exit":"enter"](!0).fit()}var zt=0;function Bt(t){var n=this,e=dt(n),r=e._mask.options;"mousedown"===t.type?(Gt(n,e),e.exit(!0)):(ft(n),zt=r.scrollTop),q(t)}var Dt=!1;function Ht(t){"touchstart"===t.type&&(Dt=t.touches[0].clientY);var n=dt(this);if(n){var e,r=n.mask,i=n.state.n,o=t.target;r!==o&&r!==L(o,"."+i)&&(e=this,ut.delete(e),n.exit())}}function It(t){if(!1!==Dt){var n=dt(this);if("touchmove"===t.type&&n){var e=n._mask.options,r=t.touches[0].clientY;e&&(e.scrollTop-=r-Dt),Dt=r}}}function Yt(t){var n=dt(this);n._mask.options.scrollTop===zt&&(Gt(this,n),n.exit(!0))}function Ut(t){Dt=!1}function Wt(t){dt(this).let().fire("reset",[t])}function Ft(){var t=dt(this);t&&ot(t)}function Jt(){Ft.call(this)}function Xt(t){return dt(this).fire("submit",[t])}function $t(t){var n=m.getSelection();n.rangeCount&&n.removeRange(n.getRangeAt(0))}function qt(t,n){var e=m.getSelection();$t();var r=m.createRange();r.selectNodeContents(t),e.addRange(r),1===n?e.collapseToEnd():-1===n&&e.collapseToStart()}function Gt(t,n){var e=n._mask,r=n._options,i=n.self,o=n.state,u=e.hint,a=e.input;e.options;var s=e.value,f=o.n;f+="__option--selected";var c,l=pt(i);for(var v in r){var p=r[v];t!==p&&(R(p._[0],"selected"),K(p,f))}P(t._[0],"selected",""),B(t,f),i.value=c=x(t,"value",!1),"input"===T(i)?(W(u,""),W(a,C(t))):(D(s,"value",c),I(s,w(t))),c!==l&&n.fire("change",[d(c)])}return yt.attach=function(t,r){var a=this;t=t||a.self,r=r||a.state,a._active=!mt(t)&&!_t(t),a._options={},a._value=pt(t)||null,a.self=t,a.state=r;var s="input"===T(t),f=r.n,l=H("span",{class:f+"__arrow"}),d=O(t),p=H("div",{class:f,tabindex:!mt(t)&&!s&&0});a.mask=p;var h=H("div",{class:f+"__options"}),m=r.options;e(m)&&(m=m.call(a));var k=new Map;if(n(m))ct(m,(function(t){var e,r;n(t)?(t[0]=null!=(e=t[0])?e:"",t[1]=null!=(r=t[1])?r:{},bt(t[0],t,k)):bt(t,[t,{}],k)}));else if(i(m))for(var g in m){var y,A;if(n(m[g]))m[g][0]=null!=(y=m[g][0])?y:"",m[g][1]=null!=(A=m[g][1])?A:{};else bt(g,[m[g],{}],k)}at.call(a,h,m=k);var j,M,S=H("div",{class:f+"__values"}),R=H("span",{class:f+"__"+(s?"text":"value")}),K=H("span",{contenteditable:!(mt(t)||_t(t)||!s)&&"",spellcheck:!!s&&"false"}),N=H("span",s?t.placeholder+"":"");z(p,S),z(p,h),z(S,R),z(S,l),s?(Q("blur",K,Et),Q("cut",K,Lt),Q("focus",K,Ct),Q("keydown",K,jt),Q("paste",K,Nt),z(R,K),z(R,N),kt(K,a)):(Q("blur",p,wt),Q("focus",p,Ot),Q("keydown",p,Rt)),B(t,f+"__self"),M=p,L(j=t).insertBefore(M,E(j,!0)),d&&(Q("reset",d,Wt),Q("submit",d,Xt),kt(d,a)),Q("mousedown",b,Ht),Q("mousedown",p,Pt),Q("mousemove",b,It),Q("mouseup",b,Ut),Q("resize",_,Ft),Q("scroll",_,Jt),Q("touchend",b,Ut),Q("touchmove",b,It,{passive:!1}),Q("touchstart",b,Ht),Q("touchstart",p,Pt),t.tabIndex=-1,kt(p,a);var Y,U={};if(U.arrow=l,U.hint=s?N:null,U.input=s?K:null,U.of=t,U.options=h,U.root=b,U.self=p,U[s?"text":"value"]=R,a._mask=U,(Y=a._options[a._value]||(s?0:v(a._options).find((function(t){return!mt(t._[0])}))))&&(P(Y._[0],"selected",""),s?(W(K,C(Y)),C(K,!1)&&W(N,"")):(D(R,"value",x(Y,"value",!1)),I(R,w(Y)))),o(r)&&n(r.with))for(var F=0,J=c(r.with);F<J;++F){var X=r.with[F];u(X)&&(X=gt[X]),e(X)?X.call(a,t,r):i(X)&&e(X.attach)&&X.attach.call(a,t,r)}return a},yt.blur=function(){$t();var t=this,n=t._mask,e=t.mask;return(n.input||e).blur(),t.exit()},yt.detach=function(){var t,r=this,o=r._mask,a=r.mask,s=r.self,f=r.state,l=o.input,v=O(s);if(r._active=!1,r._value=pt(s)||null,v&&($("reset",v,Wt),$("submit",v,Xt)),l&&($("blur",l,Et),$("blur",a,wt),$("cut",l,Lt),$("focus",l,Ct),$("focus",a,Ot),$("keydown",l,jt),$("keydown",a,Rt),$("paste",l,Nt)),$("mousedown",b,Ht),$("mousedown",a,Pt),$("mousemove",b,It),$("mouseup",b,Ut),$("resize",_,Ft),$("scroll",_,Jt),$("touchend",b,Ut),$("touchmove",b,It),$("touchstart",b,Ht),$("touchstart",a,Pt),n(f.with))for(var d=0,p=c(f.with);d<p;++d){var h=f.with[d];u(h)&&(h=gt[h]),i(h)&&e(h.detach)&&h.detach.call(r,s,f)}return s.tabIndex=null,K(s,f.n+"__self"),L(t=a),t.remove(),r._mask={of:s},r.mask=null,r},yt.enter=function(t){var n,e=this,r=e._mask,i=e._options,o=e.mask,u=e.self,a=e.state,s=r.input,f=a.n;B(o,f+"--focus"),B(o,f+"--focus-option"),B(o,f+="--open");var c=dt(b);return c&&e!==c&&c.exit(),kt(b,e),kt(_,e),e.fire("enter"),t&&(e.fire("focus"),"input"===T(u)?(ft(s),qt(s)):(n=i[pt(u)])&&ft(n),e.fire("focus.option")),e},yt.exit=function(t){var n=this,e=n._mask,r=n.mask,i=n.self,o=n.state,u=e.input,a=o.n;return K(r,a+"--focus"),K(r,a+"--focus-option"),K(r,a+="--open"),n.fire("exit"),t&&("input"===T(i)?(ft(u),qt(u)):ft(r),n.fire("focus").fire("focus.self")),n},yt.fit=function(){var t=this,n=t._mask,e=t.mask,r=n.options,i=X(e),o=X(_);return i[1]+i[3]/2>o[3]/2?U(r,{bottom:"100%","max-height":i[1],top:"auto"}):U(r,{bottom:"auto","max-height":o[3]-i[1]-i[3],top:"100%"}),t},yt.focus=function(t){var n=this,e=n._mask,r=n.mask,i=e.input;return i?(ft(i),qt(i,t),n):(r&&ft(r),n)},gt}));