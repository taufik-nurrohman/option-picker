/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},o=function(t,e){return t&&i(e)&&t instanceof e},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||o(t,Object))},i=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},s=function(t){return t.length},l=function t(n){if(e(n))return n.map((function(e){return t(e)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(n))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(n);if(r(n)){for(var o in n)n[o]=t(n[o]);return n}return"false"!==n&&("null"===n?null:"true"===n||n)},f=function n(){for(var o=arguments.length,u=Array(o),l=0;l<o;l++)u[l]=arguments[l];for(var f=u.shift(),c=0,a=s(u);c<a;++c)for(var d in u[c])if(i(f[d]))if(e(f[d])&&e(u[c][d])){f[d]=[].concat(f[d]);for(var p=0,v=s(u[c][d]);p<v;++p)t(u[c][d][p],f[d])||f[d].push(u[c][d][p])}else r(f[d])&&r(u[c][d])?f[d]=n({},f[d],u[c][d]):f[d]=u[c][d];else f[d]=u[c][d];return f},c=function t(n){if(e(n))return n.map((function(e){return t(n)}));if(r(n)){for(var o in n)n[o]=t(n[o]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},a=document,d=function(t,e){void 0===e&&(e=!0);for(var n,o=t.attributes,r={},i=0,u=o.length;i<u;++i)n=o[i].value,r[o[i].name]=e?l(n):n;return r},p=function(t){return(t&&t.nodeName||"").toLowerCase()||null},v=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},_=function(t,e){return e?t.closest(e)||null:t.parentNode||null},h=function(t){var e="form";return k(t,e)&&e===p(t.form)?t.form:_(t,e)},m=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},b=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!k(t,n))return!1;var o=t[n];return""!==(o=e?o.trim():o)?o:null},y=function(t,e){return t.classList.contains(e)},k=function(t,e){return e in t},w=function(t,e){return t.removeAttribute(e),t},g=function(t,e){return t.classList.remove(e),t},x=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,c(n)),t},E=function(t,e){return t.append(e),e},L=function(t,e){return t.classList.add(e),t},A=function(t,e,n){return t=u(t)?a.createElement(t):t,r(e)&&(n=e,e=!1),u(e)&&O(t,e),r(n)&&function(t,e){var n;for(var o in e)(n=e[o])||""===n||0===n?x(t,o,n):w(t,o)}(t,n),t},O=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var o="innerHTML";return k(t,o)&&(t[o]=n?e.trim():e),t},T=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var o="textContent";return k(t,o)&&(t[o]=n?e.trim():e),t};var K=function(t,e,n){e.removeEventListener(t,n)},P=function(t){return t&&t.preventDefault()},C=function(t,e,n,o){void 0===o&&(o=!1),e.addEventListener(t,n,o)};const I="ArrowDown",D="Enter",N="Escape",S="OptionPicker";function B(t){let e=this,{self:n,state:o}=e,{n:r}=o;r+="__option";let i=function(t){const e={},n=H(t);if("input"===p(t));else{let o=[];for(let n=0,r=s(t.options);n<r;++n){let r=t.options[n],i=d(r);["disabled","selected"].forEach((t=>{t in i?(i[t]=""===i[t]||i[t],"selected"===t&&o.push(n)):i[t]=null})),e[r.value]=[b(r)||r.value,i,r]}0===s(o)&&e[n]&&(e[n][1].selected=!0)}return e}(n);for(let n in i){let o=i[n],{disabled:u,selected:s,value:l}=o[1],f=A("span",o[0],{class:r+(u?" "+r+"--disabled":"")+(s?" "+r+"--selected":""),"data-value":c(l||n),tabindex:!u&&-1});u||(C("blur",f,G),C("focus",f,Q),C("keydown",f,V),C("mousedown",f,X),C("touchstart",f,X)),f._of=o[2],f["_"+S]=e,e._options[n]=f,E(t,f)}}function F(t,e,n){Object.defineProperty(t,e,n)}function H(t){return(t.value||"").replace(/\r/g,"")}function M(t){return t.disabled}function U(t){return t.readOnly}function $(t,e){const n=this;return t?o(n,$)?(t["_"+S]=function(t){var e={};return t.hooks=e,t.fire=function(n,o){return i(e[n])?(e[n].forEach((function(e){return e.apply(t,o)})),t):t},t.off=function(n,o){if(!i(n))return e={},t;if(i(e[n]))if(i(o)){for(var r=0,u=e[n].length;r<u;++r)if(o===e[n][r]){e[n].splice(r,1);break}0===j&&delete e[n]}else delete e[n];return t},t.on=function(n,o){return i(e[n])||(e[n]=[]),i(o)&&e[n].push(o),t},t}(n),n.attach(t,f({},$.state,e||{}))):new $(t,e):n}$.state={n:"option-picker",options:null,with:[]},$.version="2.0.0",F($,"name",{value:S});const q=$.prototype;function z(){let t=this,e=t["_"+S],{state:n}=e,{n:o}=n;g(t,o+="--focus"),g(t,o+="-self")}function G(){let t=this["_"+S],{mask:e,state:n}=t,{n:o}=n;g(e,o+"--focus-option")}function J(){let t=this,e=t["_"+S],{state:n}=e,{n:o}=n;L(t,o+="--focus"),L(t,o+="-self")}function Q(){let t=this["_"+S],{mask:e,state:n}=t,{n:o}=n;L(e,o+"--focus-option")}function R(t){let e,n=this,o=t.key;t.ctrlKey,t.shiftKey;let r=n["_"+S],{_options:i,self:u,state:s}=r,{n:l}=s,f=i[u.value];N===o?(g(n,l+"--open"),n.focus(),e=!0):f&&(I!==o&&D!==o&&" "!==o||(L(n,l+"--open"),f.focus(),e=!0)),e&&P(t)}function V(t){let e,n=this,o=t.key;t.ctrlKey,t.shiftKey;let r,i,u=n["_"+S],{_mask:s,_options:l,mask:f,self:c,state:a}=u,{input:d}=s,{n:p}=a;if(p+="__option",D===o||N===o||"Tab"===o||" "===o)g(f,a.n+"--open"),"Tab"!==o&&(f.focus(),e=!0);else if(I===o){if(r=v(n)){for(;r&&y(r,p+"--disabled");)r=v(r);r&&(w(n._of,"selected"),g(n,p+"--selected"),r.focus(),x(r._of,"selected",""),L(r,p+"--selected"),T(d,b(r)))}e=!0}else if("ArrowUp"===o){if(i=m(n)){for(;i&&y(i,p+"--disabled");)i=m(i);i&&(w(n._of,"selected"),g(n,p+"--selected"),i.focus(),x(i._of,"selected",""),L(i,p+"--selected"),T(d,b(i)))}else g(f,a.n+"--open"),f.focus();e=!0}e&&(P(t),function(t){t&&t.stopPropagation()}(t))}function W(t){let e=this,n=e["_"+S],{_options:o,self:r,state:i}=n,{n:u}=i;u+="--open",function(t,e,n){t.classList.toggle(e,n)}(e,u),y(e,u)&&o[r.value]?o[r.value].focus():e.focus(),P(t)}function X(t){let e=this,n=e["_"+S],{_mask:o,_options:r,self:i,state:u}=n,{input:s}=o,{n:l}=u;l+="__option--selected";for(let t in r){let n=r[t];e!==n&&(w(n._of,"selected"),g(n,l))}x(e._of,"selected",""),L(e,l),T(s,b(e)),P(t)}function Y(t){this["_"+S].let().fire("reset",[t])}function Z(t){return this["_"+S].fire("submit",[t])}return F(q,"value",{get:function(){let t=this.self.value;return""===t?null:t},set:function(t){this.fire("change")}}),q.attach=function(t,o){let l=this;t=t||l.self,o=o||l.state,l._active=!M(t)&&!U(t),l._options={},l._value=H(t)||null,l.self=t,l.state=o;let f=o.n,c="input"===p(t);const a=h(t),d=A("div",{class:f,tabindex:!M(t)&&0});l.mask=d;const m=A("div",{class:f+"__options"});B.call(l,m);const y=A("div",{class:f+"__values"}),k=A("span",{class:f+"__"+(c?"text":"value")}),w=A("span",{contenteditable:!(M(t)||U(t)||!c)&&"",spellcheck:!!c&&"false"}),g=A("span",c?t.placeholder+"":"");var O,j;E(d,y),E(d,m),E(y,k),E(k,w),c&&E(k,g),L(t,f+"__self"),j=d,_(O=t).insertBefore(j,v(O,!0)),a&&(a["_"+S]=l,C("reset",a,Y),C("submit",a,Z)),C("blur",d,z),C("focus",d,J),C("keydown",d,R),C("mousedown",d,W),C("touchstart",d,W),t.tabIndex=-1,d["_"+S]=l;let K={};K.hint=g,K.input=w,K.of=t,K.options=null,K.self=d,K.text=k,l._mask=K;let P=l._options[l._value];if(x(P._of,"selected",""),T(w,b(P)),i(o)&&e(o.with))for(let e=0,i=s(o.with);e<i;++e){let i=o.with[e];u(i)&&(i=$[i]),n(i)?i.call(l,t,o):r(i)&&n(i.attach)&&i.attach.call(l,t,o)}return l},q.blur=function(){},q.detach=function(){let t=this,{_mask:o,mask:i,self:l,state:f}=t;const c=h(l);if(t._active=!1,t._value=H(l)||null,c&&(K("reset",c,Y),K("submit",c,Z)),K("blur",i,z),K("focus",i,J),K("keydown",i,R),K("mousedown",i,W),K("touchstart",i,W),e(f.with))for(let e=0,o=s(f.with);e<o;++e){let o=f.with[e];u(o)&&(o=$[o]),r(o)&&n(o.detach)&&o.detach.call(t,l,f)}var a;return l.tabIndex=null,g(l,f.n+"__self"),_(a=i),a.remove(),t._mask={of:l},t.mask=null,t},q.focus=function(){},$}));