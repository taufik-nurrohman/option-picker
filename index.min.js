/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=n()}(this,(function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},r=function(t,n,e){return!(!t||"object"!=typeof t)&&(e?a(n)&&a(t.constructor)&&n===t.constructor:a(n)&&t instanceof n)},i=function(t){return o(t)&&0==t%1},o=function(t){return"number"==typeof t},u=function(t,n){return void 0===n&&(n=!0),!(!t||"object"!=typeof t)&&(!n||r(t,Object,1))},a=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},s=function(t){return"string"==typeof t},f=function(t){return t.replace(/[-_.](\w)/g,(function(t,n){return l(n)}))},c=function(t){return t.toLowerCase()},l=function(t){return t.toUpperCase()},v=function(t){return t.length},d=function(t){if(n(t))return t.map((function(t){return d(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(t))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(t);if(u(t)){for(var e in t)t[e]=d(t[e]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},p=function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];for(var o=r.shift(),s=0,f=v(r);s<f;++s)for(var c in r[s])if(a(o[c]))if(n(o[c])&&n(r[s][c])){o[c]=[].concat(o[c]);for(var l=0,d=v(r[s][c]);l<d;++l)t(r[s][c][l],o[c])||o[c].push(r[s][c][l])}else u(o[c])&&u(r[s][c])?o[c]=p({},o[c],r[s][c]):o[c]=r[s][c];else o[c]=r[s][c];return o},h=function(t){if(n(t))return t.map((function(n){return h(t)}));if(u(t)){for(var e in t)t[e]=h(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},_=document,m=window,g=_.body,b=_.documentElement,k=function(t){return t.firstElementChild||null},w=function(t){return t.lastElementChild||null},y=function(t,n,e){void 0===e&&(e=!0);var r=function(t,n,e){if(void 0===e&&(e=!0),!P(t,n))return null;var r=t.getAttribute(n);return e?d(r):r}(t,"data-"+n,e),i=(r+"").trim();return e&&i&&("["===i[0]&&"]"===i.slice(-1)||"{"===i[0]&&"}"===i.slice(-1))&&null!==(i=function(t){var n=null;try{n=JSON.parse(t)}catch(t){}return n}(r))?i:r},x=function(t,n){void 0===n&&(n=!0);var e="innerHTML";if(!S(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},z=function(t){return c(t&&t.nodeName||"")||null},E=function(t,n){return t["next"+(n?"":"Element")+"Sibling"]||null},L=function(t,n){return n?t.closest(n)||null:t.parentNode||null},T=function(t){var n="form";return S(t,n)&&n===z(t[n])?t[n]:L(t,n)},A=function(t,n){return t["previous"+(n?"":"Element")+"Sibling"]||null},C=function(t,n,e){var r=m.getComputedStyle(t).getPropertyValue(n);return r||""===r||0===r?r:null},O=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!S(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},P=function(t,n){return t.hasAttribute(n)},M=function(t,n){return t.classList.contains(n)},S=function(t,n){return n in t},j=function(t,n){return t.removeAttribute(n),t},N=function(t,n){return t.classList.remove(n),t},R=function(t){var n=L(t);return t.remove(),n},D=function(t,n){return t.style[f(n)]=null,t},H=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,h(e)),t},I=function(t,n){return t.append(n),n},K=function(t,n){return t.classList.add(n),t},B=function(t,e,r){return(n(r)||u(r))&&(r=JSON.stringify(r)),H(t,"data-"+e,r)},U=function(t,n,e){return t=s(t)?_.createElement(t):t,u(n)&&(e=n,n=!1),s(n)&&Y(t,n),u(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?H(t,r,e):j(t,r)}(t,e),t},Y=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return S(t,r)&&(t[r]=e?n.trim():n),t},J=function(t,n,e){return o(e)&&(e+="px"),t.style[f(n)]=h(e),t},V=function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?J(t,r,e):D(t,r);return t},W=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return S(t,r)&&(t[r]=e?n.trim():n),t},F=function(t,n){var e;return function(){var r=arguments,i=this;e&&clearTimeout(e),e=setTimeout((function(){return t.apply(i,r)}),n)}},X=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}},$=function(t){var n,e,r,i,o,u,a;return!function(t){return t===m}(t)?(i=(e=t.getBoundingClientRect()).left,o=e.top,r=e.width,n=e.height,u=e.right,a=e.bottom):(i=t.pageXOffset||b.scrollLeft||g.scrollLeft,o=t.pageYOffset||b.scrollTop||g.scrollTop,r=t.innerWidth,n=t.innerHeight),[i,o,r,n,u,a]},q=function(t){return[t.scrollLeft,t.scrollTop]};var G=function(t,n,e){n.removeEventListener(t,e)},Q=function(t){return t&&t.preventDefault()},Z=function(t){return t&&t.stopPropagation()},tt=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},nt="ArrowDown",et="ArrowUp",rt="Backspace",it="Delete",ot="Enter",ut="Escape",at="PageDown",st="PageUp",ft="Tab",ct=F((function(t){return t.fit()}),10),lt=new WeakMap;function vt(t,n){var e,i=this,o=i.self,u=i.state.n;u+="__option",mt(n=r(n,Map)&&n.size>0?n:bt(o),(function(n,r){"data-group"in n[1]?e&&gt(e)===n[1]["data-group"]||I(t,e=U("span",{class:u+"-group","data-value":n[1]["data-group"]})):e=!1;var a=n[1],s=a.disabled,f=a.selected,c=a.value;zt(o)&&(s=!0);var l=U("span",n[0],{class:u+(s?" "+u+"--disabled":"")+(f?" "+u+"--selected":""),"data-group":"data-group"in n[1]&&n[1]["data-group"],"data-value":h(c||r),tabindex:!s&&-1});if(s||(tt("blur",l,Nt),tt("focus",l,It),tt("keydown",l,Wt),tt("mousedown",l,qt),tt("touchend",l,tn),tt("touchstart",l,qt)),l._={},n[2])l._[0]=n[2];else{var v=U("option",n[0],{disabled:!!s&&"",selected:!!f&&"",value:c||r});o.add(v),l._[0]=v}I(e||t,l),At(l,i),Ct(r,l,i._options)})),i.state.options=n}function dt(t,e,r){var i=new Map;if(n(e))_t(e,(function(t){var e,r;n(t)?(t[0]=null!=(e=t[0])?e:"",t[1]=null!=(r=t[1])?r:{},Ct(t[0],t,i)):Ct(t,[t,{}],i)}));else if(u(e))for(var o in e){var a,s;if(n(e[o]))e[o][0]=null!=(a=e[o][0])?a:"",e[o][1]=null!=(s=e[o][1])?s:{},Ct(o,e[o],i);else Ct(o,[e[o],{}],i)}vt.call(t,r,i)}function pt(t,n,e){Object.defineProperty(t,n,e)}function ht(t){t.focus()}function _t(t,n){t.forEach(n)}function mt(t,n){_t(t,n)}function gt(t){return y(t,"value",!1)}function bt(t){var n,e,r=new Map,i=wt(t),o=[];e="input"===z(t)?(e=t.list)?e.children:[]:t.children;for(var u=function(t){var n=e[t],i=function(t,n){void 0===n&&(n=!0);for(var e,r=t.attributes,i={},o=0,u=r.length;o<u;++o)e=r[o].value,i[r[o].name]=n?d(e):e;return i}(n);if(_t(["disabled","selected"],(function(n){n in i?(i[n]=""===i[n]||i[n],"selected"===n&&o.push(t)):i[n]=null})),"optgroup"===z(n))return mt(bt(n),(function(t,e){t[1]["data-group"]=n.label,Ct(e,t,r)})),1;Ct(n.value,[O(n)||n.value,i,n],r)},a=0,s=v(e);a<s;++a)u(a);return 0===v(o)&&(n=yt(i,r))&&(n[1].selected=!0,Ct(i,n,r)),r}function kt(t){return yt(t,lt)||null}function wt(t){return(t.value||"").replace(/\r/g,"")}function yt(t,n){return n.get(t)}function xt(t,n){return n.has(t)}function zt(t){return t.disabled}function Et(t){return t.readOnly}function Lt(t){return Tt(t,lt)}function Tt(t,n){return n.delete(t)}function At(t,n){return Ct(t,n,lt)}function Ct(t,n,e){return e.set(t,n)}function Ot(t){var n=[];return mt(t,(function(t){return n.push(t)})),n}function Pt(t,n){var e=this;return t?r(e,Pt)?(At(t,function(t,n){return(n=n||t).fire=function(t,n,e){var r=this,i=r.hooks;return a(i[t])?(i[t].forEach((function(t){return t.apply(e||r,n)})),r):r},n.off=function(t,n){var e=this,r=e.hooks;if(!a(t))return r={},e;if(a(r[t]))if(a(n)){var i=r[t].length;if(0===i)delete r[t];else for(var o=0;o<i;++o)if(n===r[t][o]){r[t].splice(o,1);break}}else delete r[t];return e},n.on=function(t,n){var e=this.hooks;return a(e[t])||(e[t]=[]),a(n)&&e[t].push(n),this},t.hooks={},t}(e,Pt._)),e.attach(t,p({},Pt.state,n||{}))):new Pt(t,n):e}Pt.from=function(t,n){return new Pt(t,n)},Pt.of=kt,Pt.state={n:"option-picker",options:null,size:null,strict:!1,with:[]},Pt.version="2.0.0",pt(Pt,"name",{value:"OptionPicker"});var Mt=Pt._=Pt.prototype;pt(Mt,"size",{get:function(){var t=this.state.size||1;return i(t)?t<1?1:t:1},set:function(t){var n=this,e=n._mask,r=n._options,o=n.mask,u=n.state,a=e.options;u.n;var s=i(t)?t<1?1:t:1;if(n.state.size=s,1===s)j(o,"data-"+"size"),D(a,"max-height"),Lt(b);else{var f=Ot(r).find((function(t){return!t.hidden}));if(f){var c,l,v=C(a,"gap"),d=C(a,"padding-bottom"),p=null!=(c=null!=(l=C(f,"height"))?l:C(f,"min-height"))?c:C(f,"line-height");B(o,"size",s),J(a,"max-height","calc(("+p+" + max("+v+","+d+"))*"+s+")"),At(b,n)}}}}),pt(Mt,"value",{get:function(){var t=wt(this.self);return""===t?null:t},set:function(t){var n=this._event;this.fire("change",[n,d(t)])}}),Mt._let=!1,Mt._set=!1;var St=F((function(n,i,o,u){var a=s(i)?i:O(i)||"",f=c(a),l=n._event,p=n._mask,h=n.mask,_=n.self,m=n.state,g=p.options,b=p.value,k=m.n,w=y(h,"size");if(k+="__option",u){var z,E=wt(_);mt(o,(function(t,n){j(t._[0],"selected"),N(t,k+"--selected")}));try{mt(o,(function(t,e){var r=c(O(t)+"\t"+(z=gt(t)));if(""!==f&&f===r.slice(0,v(f))&&!M(t,k+"--disabled"))throw _.value=z,H(t._[0],"selected",""),K(t,k+"--selected"),B(b,"value",z),Y(b,x(t)),z!==E&&n.fire("change",[l,d(z)]),w&&t.scrollIntoView({block:"nearest"}),""}))}catch(t){}}else{var L=o.size;mt(o,(function(n,e){var r=c(O(n)+"\t"+gt(n));""!==f&&!t(f,r)||M(n,k+"--disabled")?(n.hidden=!0,--L):n.hidden=!1})),g.hidden=!L}n.fire("search",[l,a]);var T=m.options;e(T)&&(T=T.call(n,a),r(T,Promise)&&T.then((function(t){dt(n,t,g),n.fire("load",[l,t,a])})))}),50);function jt(t){var n=this,e=kt(n),r=e.state.n;e._event=t,N(n,r+="--focus"),N(n,r+="-self")}function Nt(t){var n=this,e=kt(n);e.mask;var r=e.state.n;e._event=t,N(n,r+="--focus"),N(n,r+="-option")}function Rt(t){var n=kt(this),e=n._mask,r=n.mask,i=n.state,o=e.text,u=i.n;n._event=t,N(r,u+"--focus-text"),N(o,u+"__text--focus")}function Dt(t){var n=this,e=kt(n),r=e._mask,i=e.self,o=r.hint;e._event=t,X((function(){return W(o,O(n,!1)?"":i.placeholder)}),1)()}function Ht(t){var n=this,e=kt(n),r=e.state.n;e._event=t,K(n,r+="--focus"),K(n,r+="-self")}function It(t){var n=kt(this),e=n.mask,r=n.state.n;an(),n._event=t,K(e,r+="--focus"),K(e,r+="-option")}function Kt(t){var n=kt(this);n._event=t,n.focus()}function Bt(t){var n=kt(this),e=n._mask,r=n.mask;n.self;var i=n.state,o=e.input,u=e.text,a=i.n;n._event=t,K(u,a+"__text--focus"),K(r,a+="--focus"),K(r,a+="-text"),O(o,!1)?sn(this):n.enter().fit()}function Ut(t){var n,e=this,r=t.key,i=kt(e),o=i._mask,u=i._options,a=i.mask,s=i.self,f=i.state,c=o.hint,l=f.n;if(l+="__option--disabled",i._event=t,X((function(){return W(c,O(e,!1)?"":s.placeholder)}),1)(),rt!==r&&it!==r&&1!==v(r)||X((function(){return i.enter().fit()}),51)(),nt===r||et===r||ot===r){var d=yt(wt(s),u);if(!d||d.hidden)for(d=Ot(u).shift();d&&(M(d,l)||d.hidden);)d=E(d);d&&!M(a,l+"--open")&&i.enter(),d&&ht(d),n=!0}else ft===r?(f.strict,i.exit()):St(i,e,u);n&&(Q(t),Z(t))}var Yt="",Jt=F((function(){return Yt=""}),500);function Vt(t){var n,e=t.key,r=t.altKey,i=t.ctrlKey,o=kt(this),u=o._options,a=o.self;if(Jt(),zt(a)||Et(a))return Q(t);o._event=t,rt===e||it===e?Yt="":ut===e?(Yt="",o.exit(n=!0)):ft===e?(Yt="",o.exit(!(n=!1))):nt===e||et===e||ot===e||at===e||st===e||""===Yt&&" "===e?o.enter(n=!0).fit():1!==v(e)||r||i||(Yt+=e),""!==Yt&&St(o,Yt,u,n=!0),n&&Q(t)}function Wt(t){var n,e=this,r=t.key,i=t.altKey,o=t.ctrlKey,u=kt(e),a=u._mask,s=u._options;u.mask;var f=u.self,c=u.state,l=a.hint,p=a.input,h=a.value,_=c.n;_+="__option";var m,g,b,y,T,C="input"===z(f);if(u._event=t,rt===r)u.exit(n=!0);else if(ot===r||ut===r||ft===r||" "===r){if(ut!==r){var P,S=wt(f);(T=yt(S,s))&&(j(T._[0],"selected"),N(T,_+"--selected")),H(e._[0],"selected",""),K(e,_+"--selected"),f.value=P=gt(e),C?(W(l,""),W(p,O(e))):(B(h,"value",P),Y(h,x(e))),P!==S&&u.fire("change",[t,d(P)])}u.exit(n=ft!==r)}else if(nt===r||at===r){for(n=!0,b=at===r&&M(y=L(e),_+"-group")?E(y):E(e);b&&(M(b,_+"--disabled")||b.hidden);)b=E(b);for(b?M(b,_+"-group")&&(b=k(b)):((y=L(e))&&M(y,_+"-group")&&(b=E(y)),b&&M(b,_+"-group")&&(b=k(b)));b&&(M(b,_+"--disabled")||b.hidden);)b=E(b);b?ht(b):(m=Ot(s).find((function(t){return!t.hidden&&!M(t,_+"--disabled")})))&&ht(m)}else if(et===r||st===r){for(n=!0,T=st===r&&M(y=L(e),_+"-group")?A(y):A(e);T&&(M(T,_+"--disabled")||T.hidden);)T=A(T);for(T?M(T,_+"-group")&&(T=w(T)):((y=L(e))&&M(y,_+"-group")&&(T=A(y)),T&&M(T,_+"-group")&&(T=w(T)));T&&(M(T,_+"--disabled")||T.hidden);)T=A(T);T?ht(T):(g=Ot(s).findLast((function(t){return!t.hidden&&!M(t,_+"--disabled")})))&&ht(g)}else"Home"===r?(n=!0,(m=Ot(s).find((function(t){return!t.hidden&&!M(t,_+"--disabled")})))&&ht(m)):"End"===r?(n=!0,(g=Ot(s).findLast((function(t){return!t.hidden&&!M(t,_+"--disabled")})))&&ht(g)):(C&&1===v(r)&&!i&&!o&&W(l,""),u.exit(!(n=!1)));n&&(Q(t),Z(t))}function Ft(t){var n=this,e=kt(n),r=e._mask,i=e.self,o=r.hint;e._event=t,X((function(){return W(n,O(n))}))(),X((function(){return W(o,O(n,!1)?"":i.placeholder)}),1)()}function Xt(t){var n=this,e=kt(n),r=e.self,i=e.state.n,o=t.target;Q(t),zt(r)||Et(r)||y(n,"size")||(e._event=t,M(o,i+"__options")||L(o,"."+i+"__options")||e[M(n,i+"--open")?"exit":"enter"](!0).fit())}var $t=0;function qt(t){var n=this,e=kt(n),r=e._mask,i=e.mask,o=r.options;e._event=t,"mousedown"===t.type?(fn(n,e),y(i,"size")||e.exit(!0)):(ht(n),$t=q(o)[1]),Q(t)}var Gt=!1;function Qt(t){"touchstart"===t.type&&(Gt=t.touches[0].clientY);var n=kt(this);if(n){var e=n.mask,r=n.state.n,i=t.target;n._event=t,e!==i&&e!==L(i,"."+r)&&(y(e,"size")?n.blur():(Lt(this),n.exit()))}}function Zt(t){if(!1!==Gt){var n,e,r=kt(this);if(r._event=t,"touchmove"===t.type&&r){var i=r._mask.options,o=t.touches[0].clientY;if(i){var u=q(i);u[1]-=o-Gt,e=u,(n=i).scrollLeft=e[0],n.scrollTop=e[1],Gt=o}}}}function tn(t){var n=kt(this),e=n._mask.options;n._event=t,q(e)[1]===$t&&(fn(this,n),n.exit(!0))}function nn(){Gt=!1}function en(t){var n=kt(this);n._event=t,n.let().fire("reset",[t])}function rn(t){var n=kt(this);n&&(ct(n),n._event=t)}function on(t){rn.call(this,t)}function un(t){var n=kt(this);return n._event=t,n.fire("submit",[t])}function an(t){var n=_.getSelection();n.rangeCount&&n.removeRange(n.getRangeAt(0))}function sn(t,n){var e=_.getSelection();an();var r=_.createRange();r.selectNodeContents(t),e.addRange(r),1===n?e.collapseToEnd():-1===n&&e.collapseToStart()}function fn(t,n){var e=n._event,r=n._mask,i=n._options,o=n.self,u=n.state,a=r.hint,s=r.input;r.options;var f=r.value,c=u.n;c+="__option--selected";var l,v=wt(o);mt(i,(function(n,e){t!==n&&(j(n._[0],"selected"),N(n,c))})),H(t._[0],"selected",""),K(t,c),o.value=l=gt(t),"input"===z(o)?(W(a,""),W(s,O(t))):(B(f,"value",l),Y(f,x(t))),l!==v&&n.fire("change",[e,d(l)])}return Mt.attach=function(t,i){var o,f=this;t=t||f.self,i=i||f.state,f._active=!zt(t)&&!Et(t),f._event=null,f._options=new Map,f._value=wt(t)||null,f.self=t,f.state=i;var c="input"===z(t),l=i.n,d=U("span",{class:l+"__arrow"}),p=T(t),h=U("div",{class:l,tabindex:!zt(t)&&!c&&0});f.mask=h;var _=U("div",{class:l+"__options"}),g=i.options;e(g)&&(g=g.call(f,null),r(g,Promise)&&g.then((function(t){dt(f,t,_),f.fire("load",[picker._event,t,null])}))),r(g,Promise)||dt(f,g,_);var k,w,y=U("div",{class:l+"__values"}),A=U("span",{class:l+"__"+(c?"text":"value")}),C=U("span",{autocapitalize:"off",contenteditable:!(zt(t)||Et(t)||!c)&&"",spellcheck:!!c&&"false"}),P=U("span",c?t.placeholder+"":"");I(h,y),I(h,_),I(y,A),I(y,d),c?(tt("blur",C,Rt),tt("cut",C,Dt),tt("focus",C,Bt),tt("keydown",C,Ut),tt("paste",C,Ft),I(A,C),I(A,P),At(C,f)):(tt("blur",h,jt),tt("focus",h,Ht),tt("keydown",h,Vt)),K(t,l+"__self"),w=h,L(k=t).insertBefore(w,E(k,!0)),p&&(tt("reset",p,en),tt("submit",p,un),At(p,f)),tt("focus",t,Kt),tt("mousedown",b,Qt),tt("mousedown",h,Xt),tt("mousemove",b,Zt),tt("mouseup",b,nn),tt("resize",m,rn),tt("scroll",m,on),tt("touchend",b,nn),tt("touchmove",b,Zt,{passive:!1}),tt("touchstart",b,Qt),tt("touchstart",h,Xt),t.tabIndex=-1,At(h,f);var M,S={};if(S.arrow=d,S.hint=c?P:null,S.input=c?C:null,S.of=t,S.options=_,S.root=b,S.self=h,S[c?"text":"value"]=A,f._mask=S,f.size=null!=(o=i.size)?o:c?1:t.size,(M=yt(f._value,f._options)||(c?0:Ot(f._options).find((function(t){return!zt(t._[0])}))))&&(H(M._[0],"selected",""),c?(W(C,O(M)),O(C,!1)&&W(P,"")):(B(A,"value",gt(M)),Y(A,x(M)))),a(i)&&n(i.with))for(var j=0,N=v(i.with);j<N;++j){var R=i.with[j];s(R)&&(R=Pt[R]),e(R)?R.call(f,t,i):u(R)&&e(R.attach)&&R.attach.call(f,t,i)}return f},Mt.blur=function(){an();var t=this,n=t._mask,e=t.mask;return(n.input||e).blur(),t.exit()},Mt.detach=function(){var t=this,r=t._mask,i=t.mask,o=t.self,a=t.state,f=r.input,c=T(o);if(t._active=!1,t._value=wt(o)||null,c&&(G("reset",c,en),G("submit",c,un)),f&&(G("blur",f,Rt),G("blur",i,jt),G("cut",f,Dt),G("focus",f,Bt),G("focus",i,Ht),G("keydown",f,Ut),G("keydown",i,Vt),G("paste",f,Ft)),G("focus",o,Kt),G("mousedown",b,Qt),G("mousedown",i,Xt),G("mousemove",b,Zt),G("mouseup",b,nn),G("resize",m,rn),G("scroll",m,on),G("touchend",b,nn),G("touchmove",b,Zt),G("touchstart",b,Qt),G("touchstart",i,Xt),n(a.with))for(var l=0,d=v(a.with);l<d;++l){var p=a.with[l];s(p)&&(p=Pt[p]),u(p)&&e(p.detach)&&p.detach.call(t,o,a)}return o.tabIndex=null,N(o,a.n+"__self"),R(i),t._mask={of:o},t.mask=null,t},Mt.enter=function(t){var n,e=this,r=e._event,i=e._mask,o=e._options,u=e.mask,a=e.self,s=e.state,f=i.input,c=s.n;K(u,c+"--focus"),K(u,c+"--focus-option"),K(u,c+="--open");var l=kt(b);return l&&e!==l&&l.exit(),At(b,e),At(m,e),e.fire("enter",[r]),t&&(e.fire("focus",[r]),"input"===z(a)?(ht(f),sn(f)):(n=yt(wt(a),o))&&ht(n),e.fire("focus.option",[r])),e},Mt.exit=function(t){var n=this,e=n._event,r=n._mask,i=n.mask,o=n.self,u=n.state,a=r.input,s=u.n;return N(i,s+"--focus"),N(i,s+"--focus-option"),N(i,s+="--open"),n.fire("exit",[e]),t&&("input"===z(o)?(ht(a),sn(a)):ht(i),n.fire("focus",[e]).fire("focus.self",[e])),n},Mt.fit=function(){var t=this,n=t._mask,e=t.mask,r=n.options;if(y(e,"size"))return t;var i=C(e,"border-bottom-width"),o=C(e,"border-top-width"),u=$(e),a=$(m);return u[1]+u[3]/2>a[3]/2?V(r,{bottom:"100%","max-height":"calc("+u[1]+"px + "+i+")",top:"auto"}):V(r,{bottom:"auto","max-height":"calc("+(a[3]-u[1]-u[3])+"px + "+o+")",top:"100%"}),t},Mt.focus=function(t){var n=this,e=n._mask,r=n.mask,i=e.input;return i?(ht(i),sn(i,t),n):(ht(r),n)},Mt.get=function(t){var n=this,e=n._active,r=n._event,i=n._options;if(!e)return!1;if(n.fire("get.option",[r,t]),!xt(t,i))return null;var o=-1;try{mt(i,(function(n,e){if(++o,t===e)throw""}))}catch(t){}return o},Mt.let=function(t){var r=this,i=r._active,o=r._event,u=r._let,a=r._options;if(r.state,!i)return r;if(n(t)||(t=[t,t]),!xt(t[0],a))return r.fire("not.option",[o,t[0]]);var s=yt(t[0],a);return e(u)&&u.call(r,s),G("blur",s,Nt),G("focus",s,It),G("keydown",s,Wt),G("mousedown",s,qt),G("touchend",s,tn),G("touchstart",s,qt),R(s),Tt(t[0],r._options),r.fire("let.option",[o,t[0]]),r},Mt.set=function(t,r,o){var u,s,f=this,c=f._active,l=f._event,v=f._mask,d=f._options,p=f._set,h=f.self,_=f.state,m=_.n;if(_.pattern,!c&&!o)return f;if(n(t)||(t=[t,t]),xt(t[0],d))return f.fire("has.option",[l,t[0]]);var g,b="input"===z(h),k=U("span",null!=(u=t[1])?u:t[0],{class:m+"__option","data-group":!!a(t[3])&&t[3],"data-value":t[0],tabindex:!!c&&-1}),w=U("option",null!=(s=t[1])?s:t[0],{value:t[0]});if(k._={},k._[0]=w,c&&(tt("blur",k,Nt),tt("focus",k,It),tt("keydown",k,Wt),tt("mousedown",k,qt),tt("touchend",k,tn),tt("touchstart",k,qt),At(k,f)),i(r)&&r>=0){var y=(g=[],mt(d,(function(t,n){return g.push(n)})),g);y.splice(r,0,t[0]),f._options=new Map,Ct(t[0],k,d),e(p)&&p.call(f,k),_t(y,(function(t){var n;Ct(t,n=yt(t,d),f._options),I(v.options,n),I(b?h.list:h,n._[0])}))}else Ct(t[0],k,f._options),e(p)&&p.call(f,k),I(v.options,k),I(b?h.list:h,w);return f.fire("set.option",[l,t[0]]),f},Pt}));