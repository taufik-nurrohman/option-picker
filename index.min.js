/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},r=function(t,e){return t&&i(e)&&t instanceof e},o=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||r(t,Object))},i=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},l=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return s(e)}))},s=function(t){return t.toUpperCase()},f=function(t){return t.length},a=function t(n){if(e(n))return n.map((function(e){return t(e)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(n))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(n);if(o(n)){for(var r in n)n[r]=t(n[r]);return n}return"false"!==n&&("null"===n?null:"true"===n||n)},c=function n(){for(var r=arguments.length,u=Array(r),l=0;l<r;l++)u[l]=arguments[l];for(var s=u.shift(),a=0,c=f(u);a<c;++a)for(var d in u[a])if(i(s[d]))if(e(s[d])&&e(u[a][d])){s[d]=[].concat(s[d]);for(var p=0,h=f(u[a][d]);p<h;++p)t(u[a][d][p],s[d])||s[d].push(u[a][d][p])}else o(s[d])&&o(u[a][d])?s[d]=n({},s[d],u[a][d]):s[d]=u[a][d];else s[d]=u[a][d];return s},d=function t(n){if(e(n))return n.map((function(e){return t(n)}));if(o(n)){for(var r in n)n[r]=t(n[r]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},p=document,h=window,v=p.body,_=p.documentElement,m=function(t,e){void 0===e&&(e=!0);for(var n,r=t.attributes,o={},i=0,u=r.length;i<u;++i)n=r[i].value,o[r[i].name]=e?a(n):n;return o},b=function(t,e,n){void 0===n&&(n=!0);var r=function(t,e,n){if(void 0===n&&(n=!0),!T(t,e))return null;var r=t.getAttribute(e);return n?a(r):r}(t,"data-"+e,n),o=(r+"").trim();return n&&o&&("["===o[0]&&"]"===o.slice(-1)||"{"===o[0]&&"}"===o.slice(-1))&&null!==(o=function(t){var e=null;try{e=JSON.parse(t)}catch(t){}return e}(r))?o:r},g=function(t,e){void 0===e&&(e=!0);var n="innerHTML";if(!O(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},k=function(t){return(t&&t.nodeName||"").toLowerCase()||null},y=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},w=function(t,e){return e?t.closest(e)||null:t.parentNode||null},x=function(t){var e="form";return O(t,e)&&e===k(t.form)?t.form:w(t,e)},E=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},L=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!O(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},T=function(t,e){return t.hasAttribute(e)},A=function(t,e){return t.classList.contains(e)},O=function(t,e){return e in t},C=function(t,e){return t.removeAttribute(e),t},P=function(t,e){return t.classList.remove(e),t},H=function(t,e){return t.style[l(e)]=null,t},I=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,d(n)),t},N=function(t,e){return t.append(e),e},S=function(t,e){return t.classList.add(e),t},z=function(t,e,n){return t=u(t)?p.createElement(t):t,o(e)&&(n=e,e=!1),u(e)&&B(t,e),o(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?I(t,r,n):C(t,r)}(t,n),t},B=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return O(t,r)&&(t[r]=n?e.trim():e),t},D=function(t,e,n){return"number"==typeof n&&(n+="px"),t.style[l(e)]=d(n),t},K=function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?D(t,r,n):H(t,r);return t},M=function(t){var e,n,r,o,i,u,l;return!function(t){return t===h}(t)?(o=(n=t.getBoundingClientRect()).left,i=n.top,r=n.width,e=n.height,u=n.right,l=n.bottom):(o=t.pageXOffset||_.scrollLeft||v.scrollLeft,i=t.pageYOffset||_.scrollTop||v.scrollTop,r=t.innerWidth,e=t.innerHeight),[o,i,r,e,u,l]};var U=function(t,e,n){e.removeEventListener(t,n)},F=function(t){return t&&t.preventDefault()},J=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)};const R="ArrowDown",W="ArrowUp",X="Enter",Y="Escape",$=(q=t=>t.fit(),G=10,function(){var t=arguments,e=this;Q&&clearTimeout(Q),Q=setTimeout((function(){return q.apply(e,t)}),G)});var q,G,Q;const V="OptionPicker";function Z(t,e){let n,r=this,{self:o,state:i}=r,{n:u}=i;u+="__option",e=e||et(o);for(let o in e){let i=e[o];"data-group"in i[1]?n||N(t,n=z("span",{class:u+"-group","data-value":i[1]["data-group"]})):n=!1;let{disabled:l,selected:s,value:f}=i[1],a=z("span",i[0],{class:u+(l?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":d(f||o),tabindex:!l&&-1});l||(J("blur",a,st),J("focus",a,at),J("keydown",a,dt),J("mousedown",a,ht),J("touchstart",a,ht)),a._of=i[2],a["_"+V]=r,r._options[o]=a,N(n||t,a)}}function tt(t,e,n){Object.defineProperty(t,e,n)}function et(t){const e={},n=nt(t);if("input"===k(t));else{let r=t.children,o=[];for(let t=0,n=f(r);t<n;++t){let n=r[t],i=m(n);if(["disabled","selected"].forEach((e=>{e in i?(i[e]=""===i[e]||i[e],"selected"===e&&o.push(t)):i[e]=null})),"optgroup"!==k(n))e[n.value]=[L(n)||n.value,i,n];else{let t=et(n);for(let r in t)t[r][1]["data-group"]=n.label,e[r]=t[r]}}0===f(o)&&e[n]&&(e[n][1].selected=!0)}return e}function nt(t){return(t.value||"").replace(/\r/g,"")}function rt(t){return t.disabled}function ot(t){return t.readOnly}function it(t,e){const n=this;return t?r(n,it)?(t["_"+V]=function(t){var e={};return t.hooks=e,t.fire=function(n,r){return i(e[n])?(e[n].forEach((function(e){return e.apply(t,r)})),t):t},t.off=function(n,r){if(!i(n))return e={},t;if(i(e[n]))if(i(r)){for(var o=0,u=e[n].length;o<u;++o)if(r===e[n][o]){e[n].splice(o,1);break}0===j&&delete e[n]}else delete e[n];return t},t.on=function(n,r){return i(e[n])||(e[n]=[]),i(r)&&e[n].push(r),t},t}(n),n.attach(t,c({},it.state,e||{}))):new it(t,e):n}it.state={n:"option-picker",options:null,with:[]},it.version="2.0.0",tt(it,"name",{value:V});const ut=it.prototype;function lt(){let t=this,e=t["_"+V],{state:n}=e,{n:r}=n;P(t,r+="--focus"),P(t,r+="-self")}function st(){let t=this["_"+V],{mask:e,state:n}=t,{n:r}=n;P(e,r+"--focus-option")}function ft(){let t=this,e=t["_"+V],{state:n}=e,{n:r}=n;S(t,r+="--focus"),S(t,r+="-self")}function at(){let t=this["_"+V],{mask:e,state:n}=t,{n:r}=n;S(e,r+"--focus-option")}function ct(t){let e,n=t.key,r=this["_"+V];Y===n?r.exit(e=!0):R!==n&&W!==n&&X!==n&&" "!==n||r.enter(e=!0).fit(),e&&F(t)}function dt(t){let e,n=this,r=t.key;t.ctrlKey,t.shiftKey;let o,i,u,l=n["_"+V],{_mask:s,_options:f,mask:a,self:c,state:d}=l,{input:p,value:h}=s,{n:v}=d;if(v+="__option",X===r||Y===r||"Tab"===r||" "===r)l.exit(e="Tab"!==r);else if(R===r){for(e=!0,o=y(n);o&&A(o,v+"--disabled");)o=y(o);for(o?A(o,v+"-group")&&(o=o.firstElementChild||null):(i=w(n))&&A(i,v+"-group")&&(o=y(i));o&&A(o,v+"--disabled");)o=y(o);o&&(C(n._of,"selected"),P(n,v+"--selected"),o.focus(),I(o._of,"selected",""),S(o,v+"--selected"),B(p||h,g(o)),c.value=b(o,"value"))}else if(W===r){for(e=!0,u=E(n);u&&A(u,v+"--disabled");)u=E(u);for(u?A(u,v+"-group")&&(u=function(t){return t.lastElementChild||null}(u)):(i=w(n))&&A(i,v+"-group")&&(u=E(i));u&&A(u,v+"--disabled");)u=E(u);u&&(C(n._of,"selected"),P(n,v+"--selected"),u.focus(),I(u._of,"selected",""),S(u,v+"--selected"),B(p||h,g(u)),c.value=b(u,"value"))}e&&(F(t),function(t){t&&t.stopPropagation()}(t))}function pt(t){let e=this["_"+V],{state:n}=e,{n:r}=n;e[A(this,r+"--open")?"exit":"enter"](!0).fit(),F(t)}function ht(t){let e=this,n=e["_"+V],{_mask:r,_options:o,self:i,state:u}=n,{input:l,value:s}=r,{n:f}=u;f+="__option--selected";for(let t in o){let n=o[t];e!==n&&(C(n._of,"selected"),P(n,f))}I(e._of,"selected",""),S(e,f),B(l||s,g(e)),i.value=b(e,"value"),F(t)}function vt(t){let e=this,n=e["_"+V];if(!n)return;let{mask:r,state:o}=n,{n:i}=o,u=t.target;r!==u&&r!==w(u,"."+i)&&(n.exit(),delete e["_"+V])}function _t(t){this["_"+V].let().fire("reset",[t])}function mt(){let t=this["_"+V];t&&$(t)}function bt(){mt.call(this)}function gt(t){return this["_"+V].fire("submit",[t])}return tt(ut,"value",{get:function(){let t=this.self.value;return""===t?null:t},set:function(t){this.fire("change")}}),ut.attach=function(t,r){let l=this;t=t||l.self,r=r||l.state,l._active=!rt(t)&&!ot(t),l._options={},l._value=nt(t)||null,l.self=t,l.state=r;let s="input"===k(t),{n:a}=r;const c=z("span",{class:a+"__arrow"}),d=x(t),p=z("div",{class:a,tabindex:!rt(t)&&0});l.mask=p;const v=z("div",{class:a+"__options"});let{options:m}=r;n(m)&&(m=m.call(l)),Z.call(l,v,m);const b=z("div",{class:a+"__values"}),E=z("span",{class:a+"__"+(s?"text":"value")}),L=z("span",{contenteditable:!(rt(t)||ot(t)||!s)&&"",spellcheck:!!s&&"false"}),T=z("span",s?t.placeholder+"":"");var A,O;N(p,b),N(p,v),N(b,E),N(b,c),s&&(N(E,L),N(E,T)),S(t,a+"__self"),O=p,w(A=t).insertBefore(O,y(A,!0)),d&&(d["_"+V]=l,J("reset",d,_t),J("submit",d,gt)),J("blur",p,lt),J("focus",p,ft),J("keydown",p,ct),J("mousedown",_,vt),J("mousedown",p,pt),J("resize",h,mt),J("scroll",h,bt),J("touchstart",_,vt),J("touchstart",p,pt),t.tabIndex=-1,p["_"+V]=l;let C={};C.hint=s?T:null,C.input=s?L:null,C.of=t,C.options=v,C.root=_,C.self=p,C[s?"text":"value"]=E,l._mask=C;let j=l._options[l._value];if(I(j._of,"selected",""),B(s?L:E,g(j)),i(r)&&e(r.with))for(let e=0,i=f(r.with);e<i;++e){let i=r.with[e];u(i)&&(i=it[i]),n(i)?i.call(l,t,r):o(i)&&n(i.attach)&&i.attach.call(l,t,r)}return l},ut.blur=function(){},ut.detach=function(){let t=this,{_mask:r,mask:i,self:l,state:s}=t;const a=x(l);if(t._active=!1,t._value=nt(l)||null,a&&(U("reset",a,_t),U("submit",a,gt)),U("blur",i,lt),U("focus",i,ft),U("keydown",i,ct),U("mousedown",_,vt),U("mousedown",i,pt),U("resize",h,mt),U("scroll",h,bt),U("touchstart",_,vt),U("touchstart",i,pt),e(s.with))for(let e=0,r=f(s.with);e<r;++e){let r=s.with[e];u(r)&&(r=it[r]),o(r)&&n(r.detach)&&r.detach.call(t,l,s)}var c;return l.tabIndex=null,P(l,s.n+"__self"),w(c=i),c.remove(),t._mask={of:l},t.mask=null,t},ut.enter=function(t){let e,n=this,{_options:r,mask:o,self:i,state:u}=n,{n:l}=u;return S(o,l+="--open"),_["_"+V]=n,h["_"+V]=n,n.fire("enter"),t&&(n.fire("focus"),(e=r[i.value])&&e.focus(),n.fire("focus.option")),n},ut.exit=function(t){let e=this,{mask:n,state:r}=e,{n:o}=r;return P(n,o+="--open"),e.fire("exit"),t&&(n.focus(),e.fire("focus").fire("focus.self")),e},ut.fit=function(){let{_mask:t,mask:e}=this,{options:n}=t,r=M(e),o=M(h);return r[1]+r[3]/2>o[3]/2?K(n,{bottom:"100%","max-height":r[1],top:"auto"}):K(n,{bottom:"auto","max-height":o[3]-r[1]-r[3],top:"100%"}),this},ut.focus=function(){},it}));