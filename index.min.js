/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=n()}(this,(function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},r=function(t,n){return t&&o(n)&&t instanceof n},i=function(t,n){return void 0===n&&(n=!0),"object"==typeof t&&(!n||r(t,Object))},o=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},a=function(t){return t.replace(/[-_.](\w)/g,(function(t,n){return f(n)}))},s=function(t){return t.toLowerCase()},f=function(t){return t.toUpperCase()},l=function(t){return t.length},c=function(t){if(n(t))return t.map((function(t){return c(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(t))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(t);if(i(t)){for(var e in t)t[e]=c(t[e]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},v=function(){for(var e=arguments.length,r=Array(e),u=0;u<e;u++)r[u]=arguments[u];for(var a=r.shift(),s=0,f=l(r);s<f;++s)for(var c in r[s])if(o(a[c]))if(n(a[c])&&n(r[s][c])){a[c]=[].concat(a[c]);for(var d=0,p=l(r[s][c]);d<p;++d)t(r[s][c][d],a[c])||a[c].push(r[s][c][d])}else i(a[c])&&i(r[s][c])?a[c]=v({},a[c],r[s][c]):a[c]=r[s][c];else a[c]=r[s][c];return a},d=function(t){if(n(t))return t.map((function(n){return d(t)}));if(i(t)){for(var e in t)t[e]=d(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},p=document,h=window,_=p.body,m=p.documentElement,b=function(t,n,e){var r=function(t,n,e){if(void 0===e&&(e=!0),!L(t,n))return null;var r=t.getAttribute(n);return e?c(r):r}(t,"data-"+n,e);return r},g=function(t,n){void 0===n&&(n=!0);var e="innerHTML";if(!C(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},k=function(t){return s(t&&t.nodeName||"")||null},x=function(t,n){return t["next"+(n?"":"Element")+"Sibling"]||null},y=function(t,n){return n?t.closest(n)||null:t.parentNode||null},w=function(t){var n="form";return C(t,n)&&n===k(t[n])?t[n]:y(t,n)},E=function(t,n){return t["previous"+(n?"":"Element")+"Sibling"]||null},A=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!C(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},L=function(t,n){return t.hasAttribute(n)},T=function(t,n){return t.classList.contains(n)},C=function(t,n){return n in t},O=function(t,n){return t.removeAttribute(n),t},j=function(t,n){return t.classList.remove(n),t},M=function(t,n){return t.style[a(n)]=null,t},R=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,d(e)),t},P=function(t,n){return t.append(n),n},S=function(t,n){return t.classList.add(n),t},z=function(t,n,e){return t=u(t)?p.createElement(t):t,i(n)&&(e=n,n=!1),u(n)&&B(t,n),i(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?R(t,r,e):O(t,r)}(t,e),t},B=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return C(t,r)&&(t[r]=e?n.trim():n),t},H=function(t,n,e){return"number"==typeof e&&(e+="px"),t.style[a(n)]=d(e),t},I=function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?H(t,r,e):M(t,r);return t},N=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return C(t,r)&&(t[r]=e?n.trim():n),t},D=function(t,n){var e;return function(){var r=arguments,i=this;e&&clearTimeout(e),e=setTimeout((function(){return t.apply(i,r)}),n)}},K=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}},U=function(t){var n,e,r,i,o,u,a;return!function(t){return t===h}(t)?(i=(e=t.getBoundingClientRect()).left,o=e.top,r=e.width,n=e.height,u=e.right,a=e.bottom):(i=t.pageXOffset||m.scrollLeft||_.scrollLeft,o=t.pageYOffset||m.scrollTop||_.scrollTop,r=t.innerWidth,n=t.innerHeight),[i,o,r,n,u,a]};var F=function(t,n,e){n.removeEventListener(t,e)},W=function(t){return t&&t.preventDefault()},X=function(t){return t&&t.stopPropagation()},Y=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},$="ArrowDown",q="ArrowUp",G="Enter",J="Escape",Q="Tab",V=D((function(t){return t.fit()}),10),Z="OptionPicker";function tt(t,n){var e,i=this,o=i.self,u=i.state.n;u+="__option",(n=r(n,Map)&&n.size>0?n:rt(o)).forEach((function(n,r){"data-group"in n[1]?e||P(t,e=z("span",{class:u+"-group","data-value":n[1]["data-group"]})):e=!1;var o=n[1],a=o.disabled,s=o.selected,f=o.value,l=z("span",n[0],{class:u+(a?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":d(f||r),tabindex:!a&&-1});a||(Y("blur",l,lt),Y("focus",l,pt),Y("keydown",l,gt),Y("mousedown",l,yt),Y("touchstart",l,yt)),l._of=n[2],l["_"+Z]=i,i._options[r]=l,P(e||t,l)})),i.state.options=n}function nt(t,n,e){Object.defineProperty(t,n,e)}function et(t){t.focus()}function rt(t){var n,e,r=new Map,i=it(t),o=[];e="input"===k(t)?(e=t.list)?e.children:[]:t.children;for(var u=function(t){var n=e[t],i=function(t,n){void 0===n&&(n=!0);for(var e,r=t.attributes,i={},o=0,u=r.length;o<u;++o)e=r[o].value,i[r[o].name]=n?c(e):e;return i}(n);if(["disabled","selected"].forEach((function(n){n in i?(i[n]=""===i[n]||i[n],"selected"===n&&o.push(t)):i[n]=null})),"optgroup"===k(n))return rt(n).forEach((function(t,e){t[1]["data-group"]=n.label,r.set(e,t)})),1;r.set(n.value,[A(n)||n.value,i,n])},a=0,s=l(e);a<s;++a)u(a);return 0===l(o)&&(n=r.get(i))&&(n[1].selected=!0,r.set(i,n)),r}function it(t){return(t.value||"").replace(/\r/g,"")}function ot(t){return t.disabled}function ut(t){return t.readOnly}function at(t,n){var e=this;return t?r(e,at)?(t["_"+Z]=function(t,n){return(n=n||t).fire=function(t,n,e){var r=this,i=r.hooks;return o(i[t])?(i[t].forEach((function(t){return t.apply(e||r,n)})),r):r},n.off=function(t,n){var e=this,r=e.hooks;if(!o(t))return r={},e;if(o(r[t]))if(o(n)){var i=r[t].length;if(0===i)delete r[t];else for(var u=0;u<i;++u)if(n===r[t][u]){r[t].splice(u,1);break}}else delete r[t];return e},n.on=function(t,n){var e=this.hooks;return o(e[t])||(e[t]=[]),o(n)&&e[t].push(n),this},t.hooks={},t}(e,at.prototype),e.attach(t,v({},at.state,n||{}))):new at(t,n):e}at.state={n:"option-picker",options:null,with:[]},at.version="2.0.0",nt(at,"name",{value:Z});var st=at.prototype;function ft(){var t=this,n=t["_"+Z].state.n;j(t,n+="--focus"),j(t,n+="-self")}function lt(){var t=this["_"+Z],n=t.mask,e=t.state.n;j(n,e+"--focus-option")}function ct(){var t=this["_"+Z],n=t._mask,e=t.mask,r=t.state,i=n.text,o=r.n;j(e,o+"--focus-text"),j(i,o+"__text--focus")}function vt(){var t=this,n=t["_"+Z],e=n._mask,r=n.self,i=e.hint;K((function(){return N(i,A(t,!1)?"":r.placeholder)}),1)()}function dt(){var t=this,n=t["_"+Z].state.n;S(t,n+="--focus"),S(t,n+="-self")}function pt(){var t=this["_"+Z],n=t.mask,e=t.state.n;Ct(),S(n,e+="--focus"),S(n,e+="-option")}function ht(){var t=this["_"+Z],n=t._mask,e=t.mask,r=t.self,i=t.state,o=n.text,u=i.n;S(o,u+"__text--focus"),S(e,u+="--focus"),S(e,u+="-text"),it(r)?Ot(this):t.enter(!0)}nt(st,"value",{get:function(){var t=it(this.self);return""===t?null:t},set:function(t){this.fire("change",[c(t)])}});var _t=D((function(n,e,r){var i=A(e)||"",o=s(i);for(var u in r){var a=r[u],f=s(A(a)+"\t"+a);""===o||t(o,f)?O(a,"hidden"):R(a,"hidden","")}n.fire("found",[i])}),10);function mt(t){var n,e,r=this,i=t.key,o=r["_"+Z],u=o._mask,a=o._options,s=o.self,f=o.state,l=u.hint,c=f.n;if(c+="__option--disabled",K((function(){return N(l,A(r,!1)?"":s.placeholder)}),1)(),o.enter(),$===i||q===i||G===i){var v=a[it(s)];if(!v||v.hidden)for(v=(e=a,Object.values(e)).shift();v&&(T(v,c)||v.hidden);)v=x(v);v&&et(v),n=!0}else Q===i?o.exit():(o.fire("find",[A(r)]),_t(o,r,a));n&&(W(t),X(t))}function bt(t){var n,e=t.key,r=this["_"+Z];J===e?r.exit(n=!0):$!==e&&q!==e&&G!==e&&" "!==e||r.enter(n=!0).fit(),n&&W(t)}function gt(t){var n,e=this,r=t.key;t.ctrlKey,t.shiftKey;var i=e["_"+Z],o=i._mask,u=i._options;i.mask;var a=i.self,s=i.state,f=o.hint,v=o.input,d=o.value,p=s.n;p+="__option";var h,_,m,w="input"===k(a);if("Backspace"===r)i.exit(n=!0);else if(G===r||J===r||Q===r||" "===r){if(J!==r){var L,C=it(a);(m=u[it(a)])&&(O(m._of,"selected"),j(m,p+"--selected")),R(e._of,"selected",""),S(e,p+"--selected"),w?(N(f,""),N(v,A(e))):B(d,g(e)),a.value=L=b(e,"value",!1),L!==C&&i.fire("change",[c(L)])}i.exit(n=Q!==r)}else if($===r){for(n=!0,h=x(e);h&&(T(h,p+"--disabled")||h.hidden);)h=x(h);for(h?T(h,p+"-group")&&(h=h.firstElementChild||null):(_=y(e))&&T(_,p+"-group")&&(h=x(_));h&&(T(h,p+"--disabled")||h.hidden);)h=x(h);h&&et(h)}else if(q===r){for(n=!0,m=E(e);m&&(T(m,p+"--disabled")||m.hidden);)m=E(m);for(m?T(m,p+"-group")&&(m=function(t){return t.lastElementChild||null}(m)):(_=y(e))&&T(_,p+"-group")&&(m=E(_));m&&(T(m,p+"--disabled")||m.hidden);)m=E(m);m?et(m):w?(et(v),Ot(v)):i.exit(n)}else w&&1===l(r)&&N(f,""),i.exit(!(n=!1));n&&(W(t),X(t))}function kt(){var t=this,n=t["_"+Z],e=n._mask,r=n.self,i=e.hint;K((function(){return N(t,A(t))}))(),K((function(){return N(i,A(t,!1)?"":r.placeholder)}),1)()}function xt(t){var n=this["_"+Z],e=n.state.n;n[T(this,e+"--open")?"exit":"enter"](!0).fit(),W(t)}function yt(t){var n=this,e=n["_"+Z],r=e._mask,i=e._options,o=e.self,u=e.state,a=r.hint,s=r.input,f=r.value,l=u.n;l+="__option--selected";var v,d=it(o);for(var p in i){var h=i[p];n!==h&&(O(h._of,"selected"),j(h,l))}R(n._of,"selected",""),S(n,l),"input"===k(o)?(N(a,""),N(s,A(n))):B(f,g(n)),o.value=v=b(n,"value",!1),v!==d&&e.fire("change",[c(v)]),W(t)}function wt(t){var n=this["_"+Z];if(n){var e=n.mask,r=n.state.n,i=t.target;e!==i&&e!==y(i,"."+r)&&(n.exit(),delete this["_"+Z])}}function Et(t){this["_"+Z].let().fire("reset",[t])}function At(){var t=this["_"+Z];t&&V(t)}function Lt(){At.call(this)}function Tt(t){return this["_"+Z].fire("submit",[t])}function Ct(t){var n=p.getSelection();n.rangeCount&&n.removeRange(n.getRangeAt(0))}function Ot(t,n){var e=p.getSelection();Ct();var r=p.createRange();r.selectNodeContents(t),e.addRange(r)}return st.attach=function(t,r){var a=this;t=t||a.self,r=r||a.state,a._active=!ot(t)&&!ut(t),a._options={},a._value=it(t)||null,a.self=t,a.state=r;var s="input"===k(t),f=r.n,c=z("span",{class:f+"__arrow"}),v=w(t),d=z("div",{class:f,tabindex:!ot(t)&&!s&&0});a.mask=d;var p=z("div",{class:f+"__options"}),_=r.options;e(_)&&(_=_.call(a));var b=new Map;if(n(_))_.forEach((function(t){var e,r;n(t)?(t[0]=null!=(e=t[0])?e:"",t[1]=null!=(r=t[1])?r:{},b.set(t[0],t)):b.set(t,[t,{}])}));else if(i(_))for(var E in _){var L,T;if(n(_[E]))_[E][0]=null!=(L=_[E][0])?L:"",_[E][1]=null!=(T=_[E][1])?T:{};else b.set(E,[_[E],{}])}tt.call(a,p,_=b);var C,O,j=z("div",{class:f+"__values"}),M=z("span",{class:f+"__"+(s?"text":"value")}),H=z("span",{contenteditable:!(ot(t)||ut(t)||!s)&&"",spellcheck:!!s&&"false"}),I=z("span",s?t.placeholder+"":"");P(d,j),P(d,p),P(j,M),P(j,c),s?(P(M,H),P(M,I),Y("blur",H,ct),Y("cut",H,vt),Y("focus",H,ht),Y("keydown",H,mt),Y("paste",H,kt),H["_"+Z]=a):(Y("blur",d,ft),Y("focus",d,dt),Y("keydown",d,bt)),S(t,f+"__self"),O=d,y(C=t).insertBefore(O,x(C,!0)),v&&(v["_"+Z]=a,Y("reset",v,Et),Y("submit",v,Tt)),Y("mousedown",m,wt),Y("mousedown",d,xt),Y("resize",h,At),Y("scroll",h,Lt),Y("touchstart",m,wt),Y("touchstart",d,xt),t.tabIndex=-1,d["_"+Z]=a;var D,K={};if(K.hint=s?I:null,K.input=s?H:null,K.of=t,K.options=p,K.root=m,K.self=d,K[s?"text":"value"]=M,a._mask=K,(D=a._options[a._value])&&(R(D._of,"selected",""),s?(N(H,A(D)),A(H,!1)&&N(I,"")):B(M,g(D))),o(r)&&n(r.with))for(var U=0,F=l(r.with);U<F;++U){var W=r.with[U];u(W)&&(W=at[W]),e(W)?W.call(a,t,r):i(W)&&e(W.attach)&&W.attach.call(a,t,r)}return a},st.blur=function(){},st.detach=function(){var t,r=this,o=r._mask,a=r.mask,s=r.self,f=r.state,c=o.input,v=w(s);if(r._active=!1,r._value=it(s)||null,v&&(F("reset",v,Et),F("submit",v,Tt)),c&&(F("blur",c,ct),F("blur",a,ft),F("cut",c,vt),F("focus",c,ht),F("focus",a,dt),F("keydown",c,mt),F("keydown",a,bt),F("paste",c,kt)),F("mousedown",m,wt),F("mousedown",a,xt),F("resize",h,At),F("scroll",h,Lt),F("touchstart",m,wt),F("touchstart",a,xt),n(f.with))for(var d=0,p=l(f.with);d<p;++d){var _=f.with[d];u(_)&&(_=at[_]),i(_)&&e(_.detach)&&_.detach.call(r,s,f)}return s.tabIndex=null,j(s,f.n+"__self"),y(t=a),t.remove(),r._mask={of:s},r.mask=null,r},st.enter=function(t){var n,e=this,r=e._mask,i=e._options,o=e.mask,u=e.self,a=e.state,s=r.input,f=a.n;return S(o,f+="--open"),m["_"+Z]&&m["_"+Z]!==e&&m["_"+Z].exit(),m["_"+Z]=e,h["_"+Z]=e,e.fire("enter"),t&&(e.fire("focus"),"input"===k(u)?(et(s),Ot(s)):(n=i[it(u)])&&et(n),e.fire("focus.option")),e},st.exit=function(t){var n=this,e=n._mask,r=n.mask,i=n.self,o=n.state,u=e.input,a=o.n;return j(r,a+="--open"),n.fire("exit"),t&&("input"===k(i)?(et(u),Ot(u)):et(r),n.fire("focus").fire("focus.self")),n},st.fit=function(){var t=this,n=t._mask,e=t.mask,r=n.options,i=U(e),o=U(h);return i[1]+i[3]/2>o[3]/2?I(r,{bottom:"100%","max-height":i[1],top:"auto"}):I(r,{bottom:"auto","max-height":o[3]-i[1]-i[3],top:"100%"}),t},st.focus=function(){},at}));