/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},r=function(t,e,n){return!(!t||"object"!=typeof t)&&(n?a(e)&&a(t.constructor)&&e===t.constructor:a(e)&&t instanceof e)},i=function(t){return o(t)&&0==t%1},o=function(t){return"number"==typeof t},u=function(t,e){return void 0===e&&(e=!0),!(!t||"object"!=typeof t)&&(!e||r(t,Object,1))},a=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},s=function(t){return"string"==typeof t},f=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return c(e)}))},l=function(t){return t.toLowerCase()},c=function(t){return t.toUpperCase()},v=function(t){return t.length},d=function(t){if(e(t))return t.map((function(t){return d(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(t))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(t);if(u(t)){for(var n in t)t[n]=d(t[n]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},p=function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];for(var o=r.shift(),s=0,f=v(r);s<f;++s)for(var l in r[s])if(a(o[l]))if(e(o[l])&&e(r[s][l])){o[l]=[].concat(o[l]);for(var c=0,d=v(r[s][l]);c<d;++c)t(r[s][l][c],o[l])||o[l].push(r[s][l][c])}else u(o[l])&&u(r[s][l])?o[l]=p({},o[l],r[s][l]):o[l]=r[s][l];else o[l]=r[s][l];return o},h=function(t){if(e(t))return t.map((function(e){return h(t)}));if(u(t)){for(var n in t)t[n]=h(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},m=document,_=window,g=m.body,b=m.documentElement,k=function(t){return t.firstElementChild||null},y=function(t){return t.lastElementChild||null},x=function(t,e,n){void 0===n&&(n=!0);var r=function(t,e,n){if(void 0===n&&(n=!0),!P(t,e))return null;var r=t.getAttribute(e);return n?d(r):r}(t,"data-"+e,n),i=(r+"").trim();return n&&i&&("["===i[0]&&"]"===i.slice(-1)||"{"===i[0]&&"}"===i.slice(-1))&&null!==(i=function(t){var e=null;try{e=JSON.parse(t)}catch(t){}return e}(r))?i:r},w=function(t,e){void 0===e&&(e=!0);var n="innerHTML";if(!M(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},z=function(t){return l(t&&t.nodeName||"")||null},E=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},L=function(t,e){return e?t.closest(e)||null:t.parentNode||null},T=function(t){var e="form";return M(t,e)&&e===z(t[e])?t[e]:L(t,e)},A=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},C=function(t,e,n){var r=_.getComputedStyle(t).getPropertyValue(e);return r||""===r||0===r?r:null},O=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!M(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},P=function(t,e){return t.hasAttribute(e)},S=function(t,e){return t.classList.contains(e)},M=function(t,e){return e in t},j=function(t,e){return t.removeAttribute(e),t},N=function(t,e){return t.classList.remove(e),t},R=function(t,e){return t.style[f(e)]=null,t},D=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,h(n)),t},H=function(t,e){return t.append(e),e},I=function(t,e){return t.classList.add(e),t},K=function(t,n,r){return(e(r)||u(r))&&(r=JSON.stringify(r)),D(t,"data-"+n,r)},B=function(t,e,n){return t=s(t)?m.createElement(t):t,u(e)&&(n=e,e=!1),s(e)&&U(t,e),u(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?D(t,r,n):j(t,r)}(t,n),t},U=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return M(t,r)&&(t[r]=n?e.trim():e),t},Y=function(t,e,n){return o(n)&&(n+="px"),t.style[f(e)]=h(n),t},J=function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?Y(t,r,n):R(t,r);return t},V=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="textContent";return M(t,r)&&(t[r]=n?e.trim():e),t},W=function(t,e){var n;return function(){var r=arguments,i=this;n&&clearTimeout(n),n=setTimeout((function(){return t.apply(i,r)}),e)}},F=function(t,e){return function(){var n=arguments,r=this;setTimeout((function(){return t.apply(r,n)}),e)}},X=function(t){var e,n,r,i,o,u,a;return!function(t){return t===_}(t)?(i=(n=t.getBoundingClientRect()).left,o=n.top,r=n.width,e=n.height,u=n.right,a=n.bottom):(i=t.pageXOffset||b.scrollLeft||g.scrollLeft,o=t.pageYOffset||b.scrollTop||g.scrollTop,r=t.innerWidth,e=t.innerHeight),[i,o,r,e,u,a]},$=function(t){return[t.scrollLeft,t.scrollTop]};var q=function(t,e,n){e.removeEventListener(t,n)},G=function(t){return t&&t.preventDefault()},Q=function(t){return t&&t.stopPropagation()},Z=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)},tt="ArrowDown",et="ArrowUp",nt="Backspace",rt="Delete",it="Enter",ot="Escape",ut="PageDown",at="PageUp",st="Tab",ft=W((function(t){return t.fit()}),10),lt=new WeakMap;function ct(t,e){var n,i=this,o=i.self,u=i.state.n;u+="__option",mt(e=r(e,Map)&&e.size>0?e:_t(o),(function(e,r){"data-group"in e[1]?n&&x(n,"value",!1)===e[1]["data-group"]||H(t,n=B("span",{class:u+"-group","data-value":e[1]["data-group"]})):n=!1;var a=e[1],s=a.disabled,f=a.selected,l=a.value;yt(o)&&(s=!0);var c=B("span",e[0],{class:u+(s?" "+u+"--disabled":"")+(f?" "+u+"--selected":""),"data-value":h(l||r),tabindex:!s&&-1});if(s||(Z("blur",c,Pt),Z("focus",c,Nt),Z("keydown",c,Ut),Z("mousedown",c,Wt),Z("touchend",c,qt),Z("touchstart",c,Wt)),c._={},e[2])c._[0]=e[2];else{var v=B("option",e[0],{disabled:!!s&&"",selected:!!f&&"",value:l||r});o.add(v),c._[0]=v}H(n||t,c),zt(c,i),Et(r,c,i._options)})),i.state.options=e}function vt(t,n,r){var i=new Map;if(e(n))ht(n,(function(t){var n,r;e(t)?(t[0]=null!=(n=t[0])?n:"",t[1]=null!=(r=t[1])?r:{},Et(t[0],t,i)):Et(t,[t,{}],i)}));else if(u(n))for(var o in n){var a,s;if(e(n[o]))n[o][0]=null!=(a=n[o][0])?a:"",n[o][1]=null!=(s=n[o][1])?s:{},Et(o,n[o],i);else Et(o,[n[o],{}],i)}ct.call(t,r,i)}function dt(t,e,n){Object.defineProperty(t,e,n)}function pt(t){t.focus()}function ht(t,e){t.forEach(e)}function mt(t,e){ht(t,e)}function _t(t){var e,n,r=new Map,i=bt(t),o=[];n="input"===z(t)?(n=t.list)?n.children:[]:t.children;for(var u=function(t){var e=n[t],i=function(t,e){void 0===e&&(e=!0);for(var n,r=t.attributes,i={},o=0,u=r.length;o<u;++o)n=r[o].value,i[r[o].name]=e?d(n):n;return i}(e);if(ht(["disabled","selected"],(function(e){e in i?(i[e]=""===i[e]||i[e],"selected"===e&&o.push(t)):i[e]=null})),"optgroup"===z(e))return mt(_t(e),(function(t,n){t[1]["data-group"]=e.label,Et(n,t,r)})),1;Et(e.value,[O(e)||e.value,i,e],r)},a=0,s=v(n);a<s;++a)u(a);return 0===v(o)&&(e=kt(i,r))&&(e[1].selected=!0,Et(i,e,r)),r}function gt(t){return kt(t,lt)||null}function bt(t){return(t.value||"").replace(/\r/g,"")}function kt(t,e){return e.get(t)}function yt(t){return t.disabled}function xt(t){return t.readOnly}function wt(t){return function(t,e){return e.delete(t)}(t,lt)}function zt(t,e){return Et(t,e,lt)}function Et(t,e,n){return n.set(t,e)}function Lt(t){var e=[];return mt(t,(function(t){return e.push(t)})),e}function Tt(t,e){var n=this;return t?r(n,Tt)?(zt(t,function(t,e){return(e=e||t).fire=function(t,e,n){var r=this,i=r.hooks;return a(i[t])?(i[t].forEach((function(t){return t.apply(n||r,e)})),r):r},e.off=function(t,e){var n=this,r=n.hooks;if(!a(t))return r={},n;if(a(r[t]))if(a(e)){var i=r[t].length;if(0===i)delete r[t];else for(var o=0;o<i;++o)if(e===r[t][o]){r[t].splice(o,1);break}}else delete r[t];return n},e.on=function(t,e){var n=this.hooks;return a(n[t])||(n[t]=[]),a(e)&&n[t].push(e),this},t.hooks={},t}(n,Tt.prototype)),n.attach(t,p({},Tt.state,e||{}))):new Tt(t,e):n}Tt.from=function(t,e){return new Tt(t,e)},Tt.of=gt,Tt.state={n:"option-picker",options:null,size:null,strict:!1,with:[]},Tt.version="2.0.0",dt(Tt,"name",{value:"OptionPicker"});var At=Tt.prototype;dt(At,"size",{get:function(){var t=this.state.size||1;return i(t)?t<1?1:t:1},set:function(t){var e=this,n=e._mask,r=e._options,o=e.mask,u=e.state,a=n.options;u.n;var s=i(t)?t<1?1:t:1;if(e.state.size=s,1===s)j(o,"data-"+"size"),R(a,"max-height"),wt(b);else{var f=Lt(r).find((function(t){return!t.hidden}));if(f){var l,c,v=C(a,"gap"),d=C(a,"padding-bottom"),p=null!=(l=null!=(c=C(f,"height"))?c:C(f,"min-height"))?l:C(f,"line-height");K(o,"size",s),Y(a,"max-height","calc(("+p+" + max("+v+","+d+"))*"+s+")"),zt(b,e)}}}}),dt(At,"value",{get:function(){var t=bt(this.self);return""===t?null:t},set:function(t){var e=this._event;this.fire("change",[e,d(t)])}});var Ct=W((function(e,i,o,u){var a=s(i)?i:O(i)||"",f=l(a),c=e._event,p=e._mask,h=e.mask,m=e.self,_=e.state,g=p.options,b=p.value,k=_.n,y=x(h,"size");if(k+="__option",u){var z,E=bt(m);mt(o,(function(t,e){j(t._[0],"selected"),N(t,k+"--selected")}));try{mt(o,(function(t,n){var r=l(O(t)+"\t"+(z=x(t,"value",!1)));if(""!==f&&f===r.slice(0,v(f))&&!S(t,k+"--disabled"))throw m.value=z,D(t._[0],"selected",""),I(t,k+"--selected"),K(b,"value",z),U(b,w(t)),z!==E&&e.fire("change",[c,d(z)]),y&&t.scrollIntoView({block:"nearest"}),""}))}catch(t){}}else{var L=o.size;mt(o,(function(e,n){var r=l(O(e)+"\t"+x(e,"value",!1));""!==f&&!t(f,r)||S(e,k+"--disabled")?(e.hidden=!0,--L):e.hidden=!1})),g.hidden=!L}e.fire("search",[c,a]);var T=_.options;n(T)&&(T=T.call(e,a),r(T,Promise)&&T.then((function(t){vt(e,t,g),e.fire("load",[c,t,a])})))}),50);function Ot(t){var e=this,n=gt(e),r=n.state.n;n._event=t,N(e,r+="--focus"),N(e,r+="-self")}function Pt(t){var e=this,n=gt(e);n.mask;var r=n.state.n;n._event=t,N(e,r+="--focus"),N(e,r+="-option")}function St(t){var e=gt(this),n=e._mask,r=e.mask,i=e.state,o=n.text,u=i.n;e._event=t,N(r,u+"--focus-text"),N(o,u+"__text--focus")}function Mt(t){var e=this,n=gt(e),r=n._mask,i=n.self,o=r.hint;n._event=t,F((function(){return V(o,O(e,!1)?"":i.placeholder)}),1)()}function jt(t){var e=this,n=gt(e),r=n.state.n;n._event=t,I(e,r+="--focus"),I(e,r+="-self")}function Nt(t){var e=gt(this),n=e.mask,r=e.state.n;ne(),e._event=t,I(n,r+="--focus"),I(n,r+="-option")}function Rt(t){var e=gt(this);e._event=t,e.focus()}function Dt(t){var e=gt(this),n=e._mask,r=e.mask;e.self;var i=e.state,o=n.input,u=n.text,a=i.n;e._event=t,I(u,a+"__text--focus"),I(r,a+="--focus"),I(r,a+="-text"),O(o,!1)?re(this):e.enter().fit()}function Ht(t){var e,n=this,r=t.key,i=gt(n),o=i._mask,u=i._options,a=i.mask,s=i.self,f=i.state,l=o.hint,c=f.n;if(c+="__option--disabled",i._event=t,F((function(){return V(l,O(n,!1)?"":s.placeholder)}),1)(),nt!==r&&rt!==r&&1!==v(r)||F((function(){return i.enter().fit()}),51)(),tt===r||et===r||it===r){var d=kt(bt(s),u);if(!d||d.hidden)for(d=Lt(u).shift();d&&(S(d,c)||d.hidden);)d=E(d);d&&!S(a,c+"--open")&&i.enter(),d&&pt(d),e=!0}else st===r?(f.strict,i.exit()):Ct(i,n,u);e&&(G(t),Q(t))}var It="",Kt=W((function(){return It=""}),500);function Bt(t){var e,n=t.key,r=t.altKey,i=t.ctrlKey,o=gt(this),u=o._options,a=o.self;if(Kt(),yt(a)||xt(a))return G(t);o._event=t,nt===n||rt===n?It="":ot===n?(It="",o.exit(e=!0)):st===n?(It="",o.exit(!(e=!1))):tt===n||et===n||it===n||ut===n||at===n||""===It&&" "===n?o.enter(e=!0).fit():1!==v(n)||r||i||(It+=n),""!==It&&Ct(o,It,u,e=!0),e&&G(t)}function Ut(t){var e,n=this,r=t.key,i=t.altKey,o=t.ctrlKey,u=gt(n),a=u._mask,s=u._options;u.mask;var f=u.self,l=u.state,c=a.hint,p=a.input,h=a.value,m=l.n;m+="__option";var _,g,b,T,C,P="input"===z(f);if(u._event=t,nt===r)u.exit(e=!0);else if(it===r||ot===r||st===r||" "===r){if(ot!==r){var M,R=bt(f);(C=kt(R,s))&&(j(C._[0],"selected"),N(C,m+"--selected")),D(n._[0],"selected",""),I(n,m+"--selected"),f.value=M=x(n,"value",!1),P?(V(c,""),V(p,O(n))):(K(h,"value",M),U(h,w(n))),M!==R&&u.fire("change",[t,d(M)])}u.exit(e=st!==r)}else if(tt===r||ut===r){for(e=!0,b=ut===r&&S(T=L(n),m+"-group")?E(T):E(n);b&&(S(b,m+"--disabled")||b.hidden);)b=E(b);for(b?S(b,m+"-group")&&(b=k(b)):((T=L(n))&&S(T,m+"-group")&&(b=E(T)),b&&S(b,m+"-group")&&(b=k(b)));b&&(S(b,m+"--disabled")||b.hidden);)b=E(b);b?pt(b):(_=Lt(s).find((function(t){return!t.hidden&&!S(t,m+"--disabled")})))&&pt(_)}else if(et===r||at===r){for(e=!0,C=at===r&&S(T=L(n),m+"-group")?A(T):A(n);C&&(S(C,m+"--disabled")||C.hidden);)C=A(C);for(C?S(C,m+"-group")&&(C=y(C)):((T=L(n))&&S(T,m+"-group")&&(C=A(T)),C&&S(C,m+"-group")&&(C=y(C)));C&&(S(C,m+"--disabled")||C.hidden);)C=A(C);C?pt(C):(g=Lt(s).findLast((function(t){return!t.hidden&&!S(t,m+"--disabled")})))&&pt(g)}else"Home"===r?(e=!0,(_=Lt(s).find((function(t){return!t.hidden&&!S(t,m+"--disabled")})))&&pt(_)):"End"===r?(e=!0,(g=Lt(s).findLast((function(t){return!t.hidden&&!S(t,m+"--disabled")})))&&pt(g)):(P&&1===v(r)&&!i&&!o&&V(c,""),u.exit(!(e=!1)));e&&(G(t),Q(t))}function Yt(t){var e=this,n=gt(e),r=n._mask,i=n.self,o=r.hint;n._event=t,F((function(){return V(e,O(e))}))(),F((function(){return V(o,O(e,!1)?"":i.placeholder)}),1)()}function Jt(t){var e=this,n=gt(e),r=n.self,i=n.state.n,o=t.target;G(t),yt(r)||xt(r)||x(e,"size")||(n._event=t,S(o,i+"__options")||L(o,"."+i+"__options")||n[S(e,i+"--open")?"exit":"enter"](!0).fit())}var Vt=0;function Wt(t){var e=this,n=gt(e),r=n._mask,i=n.mask,o=r.options;n._event=t,"mousedown"===t.type?(ie(e,n),x(i,"size")||n.exit(!0)):(pt(e),Vt=$(o)[1]),G(t)}var Ft=!1;function Xt(t){"touchstart"===t.type&&(Ft=t.touches[0].clientY);var e=gt(this);if(e){var n=e.mask,r=e.state.n,i=t.target;e._event=t,n!==i&&n!==L(i,"."+r)&&(x(n,"size")?e.blur():(wt(this),e.exit()))}}function $t(t){if(!1!==Ft){var e,n,r=gt(this);if(r._event=t,"touchmove"===t.type&&r){var i=r._mask.options,o=t.touches[0].clientY;if(i){var u=$(i);u[1]-=o-Ft,n=u,(e=i).scrollLeft=n[0],e.scrollTop=n[1],Ft=o}}}}function qt(t){var e=gt(this),n=e._mask.options;e._event=t,$(n)[1]===Vt&&(ie(this,e),e.exit(!0))}function Gt(){Ft=!1}function Qt(t){var e=gt(this);e._event=t,e.let().fire("reset",[t])}function Zt(t){var e=gt(this);e&&(ft(e),e._event=t)}function te(t){Zt.call(this,t)}function ee(t){var e=gt(this);return e._event=t,e.fire("submit",[t])}function ne(t){var e=m.getSelection();e.rangeCount&&e.removeRange(e.getRangeAt(0))}function re(t,e){var n=m.getSelection();ne();var r=m.createRange();r.selectNodeContents(t),n.addRange(r),1===e?n.collapseToEnd():-1===e&&n.collapseToStart()}function ie(t,e){var n=e._event,r=e._mask,i=e._options,o=e.self,u=e.state,a=r.hint,s=r.input;r.options;var f=r.value,l=u.n;l+="__option--selected";var c,v=bt(o);mt(i,(function(e,n){t!==e&&(j(e._[0],"selected"),N(e,l))})),D(t._[0],"selected",""),I(t,l),o.value=c=x(t,"value",!1),"input"===z(o)?(V(a,""),V(s,O(t))):(K(f,"value",c),U(f,w(t))),c!==v&&e.fire("change",[n,d(c)])}return At.attach=function(t,i){var o,f=this;t=t||f.self,i=i||f.state,f._active=!yt(t)&&!xt(t),f._event=null,f._options=new Map,f._value=bt(t)||null,f.self=t,f.state=i;var l="input"===z(t),c=i.n,d=B("span",{class:c+"__arrow"}),p=T(t),h=B("div",{class:c,tabindex:!yt(t)&&!l&&0});f.mask=h;var m=B("div",{class:c+"__options"}),g=i.options;n(g)&&(g=g.call(f,null),r(g,Promise)&&g.then((function(t){vt(f,t,m),f.fire("load",[picker._event,t,null])}))),r(g,Promise)||vt(f,g,m);var k,y,A=B("div",{class:c+"__values"}),C=B("span",{class:c+"__"+(l?"text":"value")}),P=B("span",{autocapitalize:"off",contenteditable:!(yt(t)||xt(t)||!l)&&"",spellcheck:!!l&&"false"}),S=B("span",l?t.placeholder+"":"");H(h,A),H(h,m),H(A,C),H(A,d),l?(Z("blur",P,St),Z("cut",P,Mt),Z("focus",P,Dt),Z("keydown",P,Ht),Z("paste",P,Yt),H(C,P),H(C,S),zt(P,f)):(Z("blur",h,Ot),Z("focus",h,jt),Z("keydown",h,Bt)),I(t,c+"__self"),y=h,L(k=t).insertBefore(y,E(k,!0)),p&&(Z("reset",p,Qt),Z("submit",p,ee),zt(p,f)),Z("focus",t,Rt),Z("mousedown",b,Xt),Z("mousedown",h,Jt),Z("mousemove",b,$t),Z("mouseup",b,Gt),Z("resize",_,Zt),Z("scroll",_,te),Z("touchend",b,Gt),Z("touchmove",b,$t,{passive:!1}),Z("touchstart",b,Xt),Z("touchstart",h,Jt),t.tabIndex=-1,zt(h,f);var M,j={};if(j.arrow=d,j.hint=l?S:null,j.input=l?P:null,j.of=t,j.options=m,j.root=b,j.self=h,j[l?"text":"value"]=C,f._mask=j,f.size=null!=(o=i.size)?o:l?1:t.size,(M=kt(f._value,f._options)||(l?0:Lt(f._options).find((function(t){return!yt(t._[0])}))))&&(D(M._[0],"selected",""),l?(V(P,O(M)),O(P,!1)&&V(S,"")):(K(C,"value",x(M,"value",!1)),U(C,w(M)))),a(i)&&e(i.with))for(var N=0,R=v(i.with);N<R;++N){var Y=i.with[N];s(Y)&&(Y=Tt[Y]),n(Y)?Y.call(f,t,i):u(Y)&&n(Y.attach)&&Y.attach.call(f,t,i)}return f},At.blur=function(){ne();var t=this,e=t._mask,n=t.mask;return(e.input||n).blur(),t.exit()},At.detach=function(){var t,r=this,i=r._mask,o=r.mask,a=r.self,f=r.state,l=i.input,c=T(a);if(r._active=!1,r._value=bt(a)||null,c&&(q("reset",c,Qt),q("submit",c,ee)),l&&(q("blur",l,St),q("blur",o,Ot),q("cut",l,Mt),q("focus",l,Dt),q("focus",o,jt),q("keydown",l,Ht),q("keydown",o,Bt),q("paste",l,Yt)),q("focus",a,Rt),q("mousedown",b,Xt),q("mousedown",o,Jt),q("mousemove",b,$t),q("mouseup",b,Gt),q("resize",_,Zt),q("scroll",_,te),q("touchend",b,Gt),q("touchmove",b,$t),q("touchstart",b,Xt),q("touchstart",o,Jt),e(f.with))for(var d=0,p=v(f.with);d<p;++d){var h=f.with[d];s(h)&&(h=Tt[h]),u(h)&&n(h.detach)&&h.detach.call(r,a,f)}return a.tabIndex=null,N(a,f.n+"__self"),L(t=o),t.remove(),r._mask={of:a},r.mask=null,r},At.enter=function(t){var e,n=this,r=n._event,i=n._mask,o=n._options,u=n.mask,a=n.self,s=n.state,f=i.input,l=s.n;I(u,l+"--focus"),I(u,l+"--focus-option"),I(u,l+="--open");var c=gt(b);return c&&n!==c&&c.exit(),zt(b,n),zt(_,n),n.fire("enter",[r]),t&&(n.fire("focus",[r]),"input"===z(a)?(pt(f),re(f)):(e=kt(bt(a),o))&&pt(e),n.fire("focus.option",[r])),n},At.exit=function(t){var e=this,n=e._event,r=e._mask,i=e.mask,o=e.self,u=e.state,a=r.input,s=u.n;return N(i,s+"--focus"),N(i,s+"--focus-option"),N(i,s+="--open"),e.fire("exit",[n]),t&&("input"===z(o)?(pt(a),re(a)):pt(i),e.fire("focus",[n]).fire("focus.self",[n])),e},At.fit=function(){var t=this,e=t._mask,n=t.mask,r=e.options;if(x(n,"size"))return t;var i=C(n,"border-bottom-width"),o=C(n,"border-top-width"),u=X(n),a=X(_);return u[1]+u[3]/2>a[3]/2?J(r,{bottom:"100%","max-height":"calc("+u[1]+"px + "+i+")",top:"auto"}):J(r,{bottom:"auto","max-height":"calc("+(a[3]-u[1]-u[3])+"px + "+o+")",top:"100%"}),t},At.focus=function(t){var e=this,n=e._mask,r=e.mask,i=n.input;return i?(pt(i),re(i,t),e):(pt(r),e)},Tt}));