/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},i=function(t,e){return t&&r(e)&&t instanceof e},o=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||i(t,Object))},r=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},s=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return f(e)}))},l=function(t){return t.toLowerCase()},f=function(t){return t.toUpperCase()},a=function(t){return t.length},c=function t(n){if(e(n))return n.map((function(e){return t(e)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(n))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(n);if(o(n)){for(var i in n)n[i]=t(n[i]);return n}return"false"!==n&&("null"===n?null:"true"===n||n)},d=function n(){for(var i=arguments.length,u=Array(i),s=0;s<i;s++)u[s]=arguments[s];for(var l=u.shift(),f=0,c=a(u);f<c;++f)for(var d in u[f])if(r(l[d]))if(e(l[d])&&e(u[f][d])){l[d]=[].concat(l[d]);for(var p=0,h=a(u[f][d]);p<h;++p)t(u[f][d][p],l[d])||l[d].push(u[f][d][p])}else o(l[d])&&o(u[f][d])?l[d]=n({},l[d],u[f][d]):l[d]=u[f][d];else l[d]=u[f][d];return l},p=function t(n){if(e(n))return n.map((function(e){return t(n)}));if(o(n)){for(var i in n)n[i]=t(n[i]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},h=document,_=window,v=h.body,m=h.documentElement,b=function(t,e){void 0===e&&(e=!0);for(var n,i=t.attributes,o={},r=0,u=i.length;r<u;++r)n=i[r].value,o[i[r].name]=e?c(n):n;return o},g=function(t,e,n){void 0===n&&(n=!0);var i=function(t,e,n){if(void 0===n&&(n=!0),!L(t,e))return null;var i=t.getAttribute(e);return n?c(i):i}(t,"data-"+e,n),o=(i+"").trim();return n&&o&&("["===o[0]&&"]"===o.slice(-1)||"{"===o[0]&&"}"===o.slice(-1))&&null!==(o=function(t){var e=null;try{e=JSON.parse(t)}catch(t){}return e}(i))?o:i},k=function(t,e){void 0===e&&(e=!0);var n="innerHTML";if(!C(t,n))return!1;var i=t[n];return""!==(i=e?i.trim():i)?i:null},x=function(t){return l(t&&t.nodeName||"")||null},y=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},w=function(t,e){return e?t.closest(e)||null:t.parentNode||null},E=function(t){var e="form";return C(t,e)&&e===x(t.form)?t.form:w(t,e)},T=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},A=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!C(t,n))return!1;var i=t[n];return""!==(i=e?i.trim():i)?i:null},L=function(t,e){return t.hasAttribute(e)},O=function(t,e){return t.classList.contains(e)},C=function(t,e){return e in t},S=function(t,e){return t.removeAttribute(e),t},j=function(t,e){return t.classList.remove(e),t},M=function(t,e){return t.style[s(e)]=null,t},R=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,p(n)),t},N=function(t,e){return t.append(e),e},P=function(t,e){return t.classList.add(e),t},z=function(t,e,n){return t=u(t)?h.createElement(t):t,o(e)&&(n=e,e=!1),u(e)&&B(t,e),o(n)&&function(t,e){var n;for(var i in e)(n=e[i])||""===n||0===n?R(t,i,n):S(t,i)}(t,n),t},B=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var i="innerHTML";return C(t,i)&&(t[i]=n?e.trim():e),t},H=function(t,e,n){return"number"==typeof n&&(n+="px"),t.style[s(e)]=p(n),t},I=function(t,e){var n;for(var i in e)(n=e[i])||""===n||0===n?H(t,i,n):M(t,i);return t},D=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var i="textContent";return C(t,i)&&(t[i]=n?e.trim():e),t},K=function(t,e){var n;return function(){var i=arguments,o=this;n&&clearTimeout(n),n=setTimeout((function(){return t.apply(o,i)}),e)}},U=function(t,e){return function(){var n=arguments,i=this;setTimeout((function(){return t.apply(i,n)}),e)}},F=function(t){var e,n,i,o,r,u,s;return!function(t){return t===_}(t)?(o=(n=t.getBoundingClientRect()).left,r=n.top,i=n.width,e=n.height,u=n.right,s=n.bottom):(o=t.pageXOffset||m.scrollLeft||v.scrollLeft,r=t.pageYOffset||m.scrollTop||v.scrollTop,i=t.innerWidth,e=t.innerHeight),[o,r,i,e,u,s]};var J=function(t,e,n){e.removeEventListener(t,n)},W=function(t){return t&&t.preventDefault()},X=function(t){return t&&t.stopPropagation()},Y=function(t,e,n,i){void 0===i&&(i=!1),e.addEventListener(t,n,i)};const $="ArrowDown",q="ArrowUp",G="Enter",Q="Escape",V="Tab",Z=K((t=>t.fit()),10),tt="OptionPicker";function et(t,e){let n,o=this,{self:r,state:u}=o,{n:s}=u;s+="__option",(e=i(e,Map)&&e.size>0?e:ot(r)).forEach(((e,i)=>{"data-group"in e[1]?n||N(t,n=z("span",{class:s+"-group","data-value":e[1]["data-group"]})):n=!1;let{disabled:r,selected:u,value:l}=e[1],f=z("span",e[0],{class:s+(r?" "+s+"--disabled":"")+(u?" "+s+"--selected":""),"data-value":p(l||i),tabindex:!r&&-1});r||(Y("blur",f,ct),Y("focus",f,_t),Y("keydown",f,kt),Y("mousedown",f,wt),Y("touchstart",f,wt)),f._of=e[2],f["_"+tt]=o,o._options[i]=f,N(n||t,f)})),o.state.options=e}function nt(t,e,n){Object.defineProperty(t,e,n)}function it(t){t.focus()}function ot(t){const e=new Map,n=rt(t);let i,o,r=[];"input"===x(t)?(o=t.list,o=o?o.children:[]):o=t.children;for(let t=0,n=a(o);t<n;++t){let n=o[t],i=b(n);["disabled","selected"].forEach((e=>{e in i?(i[e]=""===i[e]||i[e],"selected"===e&&r.push(t)):i[e]=null})),"optgroup"!==x(n)?e.set(n.value,[A(n)||n.value,i,n]):ot(n).forEach(((t,i)=>{t[1]["data-group"]=n.label,e.set(i,t)}))}return 0===a(r)&&(i=e.get(n))&&(i[1].selected=!0,e.set(n,i)),e}function rt(t){return(t.value||"").replace(/\r/g,"")}function ut(t){return t.disabled}function st(t){return t.readOnly}function lt(t,e){const n=this;return t?i(n,lt)?(t["_"+tt]=function(t,e){return(e=e||t).fire=function(t,e,n){var i=this,o=i.hooks;return r(o[t])?(o[t].forEach((function(t){return t.apply(n||i,e)})),i):i},e.off=function(t,e){var n=this,i=n.hooks;if(!r(t))return i={},n;if(r(i[t]))if(r(e)){var o=i[t].length;if(0===o)delete i[t];else for(var u=0;u<o;++u)if(e===i[t][u]){i[t].splice(u,1);break}}else delete i[t];return n},e.on=function(t,e){var n=this.hooks;return r(n[t])||(n[t]=[]),r(e)&&n[t].push(e),this},t.hooks={},t}(n,lt.prototype),n.attach(t,d({},lt.state,e||{}))):new lt(t,e):n}lt.state={n:"option-picker",options:null,with:[]},lt.version="2.0.0",nt(lt,"name",{value:tt});const ft=lt.prototype;function at(){let t=this,e=t["_"+tt],{state:n}=e,{n:i}=n;j(t,i+="--focus"),j(t,i+="-self")}function ct(){let t=this["_"+tt],{mask:e,state:n}=t,{n:i}=n;j(e,i+"--focus-option")}function dt(){let t=this["_"+tt],{_mask:e,mask:n,state:i}=t,{text:o}=e,{n:r}=i;j(n,r+"--focus-text"),j(o,r+"__text--focus")}function pt(){let t=this,e=t["_"+tt],{_mask:n,self:i}=e,{hint:o}=n;U((()=>D(o,A(t,!1)?"":i.placeholder)),1)()}function ht(){let t=this,e=t["_"+tt],{state:n}=e,{n:i}=n;P(t,i+="--focus"),P(t,i+="-self")}function _t(){let t=this["_"+tt],{mask:e,state:n}=t,{n:i}=n;Ct(),P(e,i+="--focus"),P(e,i+="-option")}function vt(){let t=this["_"+tt],{_mask:e,mask:n,self:i,state:o}=t,{text:r}=e,{n:u}=o;P(r,u+"__text--focus"),P(n,u+="--focus"),P(n,u+="-text"),rt(i)?St(this):t.enter(!0)}nt(ft,"value",{get:function(){let t=rt(this.self);return""===t?null:t},set:function(t){this.fire("change")}});const mt=K(((e,n,i)=>{let o=l(A(n)||"");for(let e in i){let n=i[e],r=l(A(n)+"\t"+n);""===o||t(o,r)?S(n,"hidden"):R(n,"hidden","")}}),10);function bt(t){let e,n=this,i=t.key,o=n["_"+tt],{_mask:r,_options:u,self:s,state:l}=o,{hint:f}=r,{n:a}=l;if(a+="__option--disabled",U((()=>D(f,A(n,!1)?"":s.placeholder)),1)(),o.enter(),$===i||q===i||G===i){let t=u[rt(s)];if(!t||t.hidden)for(t=(c=u,Object.values(c)).shift();t&&(O(t,a)||t.hidden);)t=y(t);t&&it(t),e=!0}else V===i?o.exit():mt(o,n,u);var c;e&&(W(t),X(t))}function gt(t){let e,n=t.key,i=this["_"+tt];Q===n?i.exit(e=!0):$!==n&&q!==n&&G!==n&&" "!==n||i.enter(e=!0).fit(),e&&W(t)}function kt(t){let e,n=this,i=t.key;t.ctrlKey,t.shiftKey;let o=n["_"+tt],{_mask:r,_options:u,mask:s,self:l,state:f}=o,{hint:c,input:d,value:p}=r,{n:h}=f;h+="__option";let _,v,m,b="input"===x(l);if("Backspace"===i)o.exit(e=!0);else if(G===i||Q===i||V===i||" "===i)Q!==i&&((m=u[rt(l)])&&(S(m._of,"selected"),j(m,h+"--selected")),R(n._of,"selected",""),P(n,h+"--selected"),b?(D(c,""),D(d,A(n))):B(p,k(n)),l.value=g(n,"value")),o.exit(e=V!==i);else if($===i){for(e=!0,_=y(n);_&&(O(_,h+"--disabled")||_.hidden);)_=y(_);for(_?O(_,h+"-group")&&(_=_.firstElementChild||null):(v=w(n))&&O(v,h+"-group")&&(_=y(v));_&&(O(_,h+"--disabled")||_.hidden);)_=y(_);_&&it(_)}else if(q===i){for(e=!0,m=T(n);m&&(O(m,h+"--disabled")||m.hidden);)m=T(m);for(m?O(m,h+"-group")&&(m=function(t){return t.lastElementChild||null}(m)):(v=w(n))&&O(v,h+"-group")&&(m=T(v));m&&(O(m,h+"--disabled")||m.hidden);)m=T(m);m?it(m):b?(it(d),St(d)):o.exit(e)}else 1===a(i)&&D(c,""),o.exit(!(e=!1));e&&(W(t),X(t))}function xt(){let t=this,e=t["_"+tt],{_mask:n,self:i}=e,{hint:o}=n;U((()=>D(t,A(t))))(),U((()=>D(o,A(t,!1)?"":i.placeholder)),1)()}function yt(t){let e=this["_"+tt],{state:n}=e,{n:i}=n;e[O(this,i+"--open")?"exit":"enter"](!0).fit(),W(t)}function wt(t){let e=this,n=e["_"+tt],{_mask:i,_options:o,self:r,state:u}=n,{hint:s,input:l,value:f}=i,{n:a}=u;a+="__option--selected";for(let t in o){let n=o[t];e!==n&&(S(n._of,"selected"),j(n,a))}R(e._of,"selected",""),P(e,a),"input"===x(r)?(D(s,""),D(l,A(e))):B(f,k(e)),r.value=g(e,"value"),W(t)}function Et(t){let e=this,n=e["_"+tt];if(!n)return;let{mask:i,state:o}=n,{n:r}=o,u=t.target;i!==u&&i!==w(u,"."+r)&&(n.exit(),delete e["_"+tt])}function Tt(t){this["_"+tt].let().fire("reset",[t])}function At(){let t=this["_"+tt];t&&Z(t)}function Lt(){At.call(this)}function Ot(t){return this["_"+tt].fire("submit",[t])}function Ct(t){const e=h.getSelection();t||e.rangeCount&&e.removeRange(e.getRangeAt(0))}function St(t,e){const n=h.getSelection();Ct();const i=h.createRange();i.selectNodeContents(t),n.addRange(i),1===e?n.collapseToEnd():-1===e&&n.collapseToStart()}return ft.attach=function(t,i){let s=this;t=t||s.self,i=i||s.state,s._active=!ut(t)&&!st(t),s._options={},s._value=rt(t)||null,s.self=t,s.state=i;let l="input"===x(t),{n:f}=i;const c=z("span",{class:f+"__arrow"}),d=E(t),p=z("div",{class:f,tabindex:!ut(t)&&!l&&0});s.mask=p;const h=z("div",{class:f+"__options"});let{options:v}=i;n(v)&&(v=v.call(s));const b=new Map;if(e(v))v.forEach((t=>{e(t)?(t[0]=t[0]??"",t[1]=t[1]??{},b.set(t[0],t)):b.set(t,[t,{}])}));else if(o(v))for(let t in v)e(v[t])?(v[t][0]=v[t][0]??"",v[t][1]=v[t][1]??{}):b.set(t,[v[t],{}]);et.call(s,h,v=b);const g=z("div",{class:f+"__values"}),T=z("span",{class:f+"__"+(l?"text":"value")}),L=z("span",{contenteditable:!(ut(t)||st(t)||!l)&&"",spellcheck:!!l&&"false"}),O=z("span",l?t.placeholder+"":"");var C,S;N(p,g),N(p,h),N(g,T),N(g,c),l?(N(T,L),N(T,O),Y("blur",L,dt),Y("cut",L,pt),Y("focus",L,vt),Y("keydown",L,bt),Y("paste",L,xt),L["_"+tt]=s):(Y("blur",p,at),Y("focus",p,ht),Y("keydown",p,gt)),P(t,f+"__self"),S=p,w(C=t).insertBefore(S,y(C,!0)),d&&(d["_"+tt]=s,Y("reset",d,Tt),Y("submit",d,Ot)),Y("mousedown",m,Et),Y("mousedown",p,yt),Y("resize",_,At),Y("scroll",_,Lt),Y("touchstart",m,Et),Y("touchstart",p,yt),t.tabIndex=-1,p["_"+tt]=s;let j,M={};if(M.hint=l?O:null,M.input=l?L:null,M.of=t,M.options=h,M.root=m,M.self=p,M[l?"text":"value"]=T,s._mask=M,(j=s._options[s._value])&&(R(j._of,"selected",""),l?(D(L,A(j)),A(L,!1)&&D(O,"")):B(T,k(j))),r(i)&&e(i.with))for(let e=0,r=a(i.with);e<r;++e){let r=i.with[e];u(r)&&(r=lt[r]),n(r)?r.call(s,t,i):o(r)&&n(r.attach)&&r.attach.call(s,t,i)}return s},ft.blur=function(){},ft.detach=function(){let t=this,{_mask:i,mask:r,self:s,state:l}=t,{input:f}=i;const c=E(s);if(t._active=!1,t._value=rt(s)||null,c&&(J("reset",c,Tt),J("submit",c,Ot)),f&&(J("blur",f,dt),J("blur",r,at),J("cut",f,pt),J("focus",f,vt),J("focus",r,ht),J("keydown",f,bt),J("keydown",r,gt),J("paste",f,xt)),J("mousedown",m,Et),J("mousedown",r,yt),J("resize",_,At),J("scroll",_,Lt),J("touchstart",m,Et),J("touchstart",r,yt),e(l.with))for(let e=0,i=a(l.with);e<i;++e){let i=l.with[e];u(i)&&(i=lt[i]),o(i)&&n(i.detach)&&i.detach.call(t,s,l)}var d;return s.tabIndex=null,j(s,l.n+"__self"),w(d=r),d.remove(),t._mask={of:s},t.mask=null,t},ft.enter=function(t){let e,n=this,{_mask:i,_options:o,mask:r,self:u,state:s}=n,{input:l}=i,{n:f}=s;return P(r,f+="--open"),m["_"+tt]&&m["_"+tt]!==n&&m["_"+tt].exit(),m["_"+tt]=n,_["_"+tt]=n,n.fire("enter"),t&&(n.fire("focus"),"input"===x(u)?(it(l),St(l)):(e=o[rt(u)])&&it(e),n.fire("focus.option")),n},ft.exit=function(t){let e=this,{_mask:n,mask:i,self:o,state:r}=e,{input:u}=n,{n:s}=r;return j(i,s+="--open"),e.fire("exit"),t&&("input"===x(o)?(it(u),St(u)):it(i),e.fire("focus").fire("focus.self")),e},ft.fit=function(){let{_mask:t,mask:e}=this,{options:n}=t,i=F(e),o=F(_);return i[1]+i[3]/2>o[3]/2?I(n,{bottom:"100%","max-height":i[1],top:"auto"}):I(n,{bottom:"auto","max-height":o[3]-i[1]-i[3],top:"100%"}),this},ft.focus=function(){},lt}));