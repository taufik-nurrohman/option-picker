/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},o=function(t,e){return t&&i(e)&&t instanceof e},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||o(t,Object))},i=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},l=function(t){return t.length},s=function t(n){if(e(n))return n.map((function(e){return t(e)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(n))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(n);if(r(n)){for(var o in n)n[o]=t(n[o]);return n}return"false"!==n&&("null"===n?null:"true"===n||n)},f=function n(){for(var o=arguments.length,u=Array(o),s=0;s<o;s++)u[s]=arguments[s];for(var f=u.shift(),a=0,c=l(u);a<c;++a)for(var d in u[a])if(i(f[d]))if(e(f[d])&&e(u[a][d])){f[d]=[].concat(f[d]);for(var p=0,h=l(u[a][d]);p<h;++p)t(u[a][d][p],f[d])||f[d].push(u[a][d][p])}else r(f[d])&&r(u[a][d])?f[d]=n({},f[d],u[a][d]):f[d]=u[a][d];else f[d]=u[a][d];return f},a=function t(n){if(e(n))return n.map((function(e){return t(n)}));if(r(n)){for(var o in n)n[o]=t(n[o]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},c=document,d=function(t,e){void 0===e&&(e=!0);for(var n,o=t.attributes,r={},i=0,u=o.length;i<u;++i)n=o[i].value,r[o[i].name]=e?s(n):n;return r},p=function(t,e){void 0===e&&(e=!0);var n="innerHTML";if(!g(t,n))return!1;var o=t[n];return""!==(o=e?o.trim():o)?o:null},h=function(t){return(t&&t.nodeName||"").toLowerCase()||null},v=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},_=function(t,e){return e?t.closest(e)||null:t.parentNode||null},m=function(t){var e="form";return g(t,e)&&e===h(t.form)?t.form:_(t,e)},b=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},w=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!g(t,n))return!1;var o=t[n];return""!==(o=e?o.trim():o)?o:null},k=function(t,e){return t.classList.contains(e)},g=function(t,e){return e in t},y=function(t,e){return t.removeAttribute(e),t},x=function(t,e){return t.classList.remove(e),t},E=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,a(n)),t},L=function(t,e){return t.append(e),e},A=function(t,e){return t.classList.add(e),t},O=function(t,e,n){return t=u(t)?c.createElement(t):t,r(e)&&(n=e,e=!1),u(e)&&T(t,e),r(n)&&function(t,e){var n;for(var o in e)(n=e[o])||""===n||0===n?E(t,o,n):y(t,o)}(t,n),t},T=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var o="innerHTML";return g(t,o)&&(t[o]=n?e.trim():e),t};var C=function(t,e,n){e.removeEventListener(t,n)},P=function(t){return t&&t.preventDefault()},I=function(t,e,n,o){void 0===o&&(o=!1),e.addEventListener(t,n,o)};const D="ArrowDown",H="ArrowUp",K="Enter",M="Escape",N="OptionPicker";function S(t,e){let n,o=this,{self:r,state:i}=o,{n:u}=i;u+="__option",e=e||F(r);for(let r in e){let i=e[r];"data-group"in i[1]?n||L(t,n=O("span",{class:u+"-group","data-value":i[1]["data-group"]})):n=!1;let{disabled:l,selected:s,value:f}=i[1],c=O("span",i[0],{class:u+(l?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":a(f||r),tabindex:!l&&-1});l||(I("blur",c,Q),I("focus",c,V),I("keydown",c,X),I("mousedown",c,Z),I("touchstart",c,Z)),c._of=i[2],c["_"+N]=o,o._options[r]=c,L(n||t,c)}}function B(t,e,n){Object.defineProperty(t,e,n)}function F(t){const e={},n=U(t);if("input"===h(t));else{let o=t.children,r=[];for(let t=0,n=l(o);t<n;++t){let n=o[t],i=d(n);if(["disabled","selected"].forEach((e=>{e in i?(i[e]=""===i[e]||i[e],"selected"===e&&r.push(t)):i[e]=null})),"optgroup"!==h(n))e[n.value]=[w(n)||n.value,i,n];else{let t=F(n);for(let o in t)t[o][1]["data-group"]=n.label,e[o]=t[o]}}0===l(r)&&e[n]&&(e[n][1].selected=!0)}return e}function U(t){return(t.value||"").replace(/\r/g,"")}function $(t){return t.disabled}function q(t){return t.readOnly}function z(t,e){const n=this;return t?o(n,z)?(t["_"+N]=function(t){var e={};return t.hooks=e,t.fire=function(n,o){return i(e[n])?(e[n].forEach((function(e){return e.apply(t,o)})),t):t},t.off=function(n,o){if(!i(n))return e={},t;if(i(e[n]))if(i(o)){for(var r=0,u=e[n].length;r<u;++r)if(o===e[n][r]){e[n].splice(r,1);break}0===j&&delete e[n]}else delete e[n];return t},t.on=function(n,o){return i(e[n])||(e[n]=[]),i(o)&&e[n].push(o),t},t}(n),n.attach(t,f({},z.state,e||{}))):new z(t,e):n}z.state={n:"option-picker",options:null,root:c,with:[]},z.version="2.0.0",B(z,"name",{value:N});const G=z.prototype;function J(){let t=this,e=t["_"+N],{state:n}=e,{n:o}=n;x(t,o+="--focus"),x(t,o+="-self")}function Q(){let t=this["_"+N],{mask:e,state:n}=t,{n:o}=n;x(e,o+"--focus-option")}function R(){let t=this,e=t["_"+N],{state:n}=e,{n:o}=n;A(t,o+="--focus"),A(t,o+="-self")}function V(){let t=this["_"+N],{mask:e,state:n}=t,{n:o}=n;A(e,o+"--focus-option")}function W(t){let e,n=t.key,o=this["_"+N];M===n?o.exit(e=!0):D===n||K===n||" "===n?o.enter(e=!0,"down"):H===n&&o.enter(e=!0,"up"),e&&P(t)}function X(t){let e,n=this,o=t.key;t.ctrlKey,t.shiftKey;let r,i,u,l=n["_"+N],{_mask:s,_options:f,mask:a,self:c,state:d}=l,{input:h,value:m}=s,{n:w}=d;if(w+="__option",K===o||M===o||"Tab"===o||" "===o)l.exit(e="Tab"!==o);else if(D===o){for(e=!0,r=v(n);r&&k(r,w+"--disabled");)r=v(r);for(r?k(r,w+"-group")&&(r=r.firstElementChild||null):(i=_(n))&&k(i,w+"-group")&&(r=v(i));r&&k(r,w+"--disabled");)r=v(r);r?(y(n._of,"selected"),x(n,w+"--selected"),r.focus(),E(r._of,"selected",""),A(r,w+"--selected"),T(h||m,p(r))):k(a,d.n+"--open-up")&&l.exit(e)}else if(H===o){for(e=!0,u=b(n);u&&k(u,w+"--disabled");)u=b(u);for(u?k(u,w+"-group")&&(u=function(t){return t.lastElementChild||null}(u)):(i=_(n))&&k(i,w+"-group")&&(u=b(i));u&&k(u,w+"--disabled");)u=b(u);u?(y(n._of,"selected"),x(n,w+"--selected"),u.focus(),E(u._of,"selected",""),A(u,w+"--selected"),T(h||m,p(u))):k(a,d.n+"--open-down")&&l.exit(e)}e&&(P(t),function(t){t&&t.stopPropagation()}(t))}function Y(t){let e=this["_"+N],{state:n}=e,{n:o}=n;e[k(this,o+"--open")?"exit":"enter"](!0),P(t)}function Z(t){let e=this,n=e["_"+N],{_mask:o,_options:r,self:i,state:u}=n,{input:l,value:s}=o,{n:f}=u;f+="__option--selected";for(let t in r){let n=r[t];e!==n&&(y(n._of,"selected"),x(n,f))}E(e._of,"selected",""),A(e,f),T(l||s,p(e)),P(t)}function tt(t){let e=this,n=e["_"+N],{mask:o,state:r}=n,{n:i}=r,u=t.target;n&&o!==u&&o!==_(u,"."+i)&&(n.exit(),delete e["_"+N])}function et(t){this["_"+N].let().fire("reset",[t])}function nt(t){return this["_"+N].fire("submit",[t])}return B(G,"value",{get:function(){let t=this.self.value;return""===t?null:t},set:function(t){this.fire("change")}}),G.attach=function(t,o){let s=this;t=t||s.self,o=o||s.state,s._active=!$(t)&&!q(t),s._options={},s._value=U(t)||null,s.self=t,s.state=o;let f="input"===h(t),{n:a,root:c}=o;const d=O("span",{class:a+"__arrow"}),b=m(t),w=O("div",{class:a,tabindex:!$(t)&&0});s.mask=w;const k=O("div",{class:a+"__options"});let{options:g}=o;n(g)&&(g=g.call(s)),S.call(s,k,g);const y=O("div",{class:a+"__values"}),x=O("span",{class:a+"__"+(f?"text":"value")}),j=O("span",{contenteditable:!($(t)||q(t)||!f)&&"",spellcheck:!!f&&"false"}),C=O("span",f?t.placeholder+"":"");var P,D;L(w,y),L(w,k),L(y,x),L(y,d),f&&(L(x,j),L(x,C)),A(t,a+"__self"),D=w,_(P=t).insertBefore(D,v(P,!0)),b&&(b["_"+N]=s,I("reset",b,et),I("submit",b,nt)),c&&(I("mousedown",c,tt),I("touchstart",c,tt)),I("blur",w,J),I("focus",w,R),I("keydown",w,W),I("mousedown",w,Y),I("touchstart",w,Y),t.tabIndex=-1,w["_"+N]=s;let H={};H.hint=f?C:null,H.input=f?j:null,H.of=t,H.options=k,H.root=c||null,H.self=w,H[f?"text":"value"]=x,s._mask=H;let K=s._options[s._value];if(E(K._of,"selected",""),T(f?j:x,p(K)),i(o)&&e(o.with))for(let e=0,i=l(o.with);e<i;++e){let i=o.with[e];u(i)&&(i=z[i]),n(i)?i.call(s,t,o):r(i)&&n(i.attach)&&i.attach.call(s,t,o)}return s},G.blur=function(){},G.detach=function(){let t=this,{_mask:o,mask:i,self:s,state:f}=t,{root:a}=f;const c=m(s);if(t._active=!1,t._value=U(s)||null,c&&(C("reset",c,et),C("submit",c,nt)),a&&(C("mousedown",a,tt),C("touchstart",a,tt)),C("blur",i,J),C("focus",i,R),C("keydown",i,W),C("mousedown",i,Y),C("touchstart",i,Y),e(f.with))for(let e=0,o=l(f.with);e<o;++e){let o=f.with[e];u(o)&&(o=z[o]),r(o)&&n(o.detach)&&o.detach.call(t,s,f)}var d;return s.tabIndex=null,x(s,f.n+"__self"),_(d=i),d.remove(),t._mask={of:s},t.mask=null,t},G.enter=function(t,e="down"){let n,o=this,{_options:r,mask:i,self:u,state:l}=o,{n:s,root:f}=l;return A(i,s+="--open"),A(i,s+"-"+(e||"down")),f&&(f["_"+N]=o),o.fire("enter"),t&&(o.fire("focus"),(n=r[u.value])&&n.focus(),o.fire("focus.option")),o},G.exit=function(t,e=["down","up"]){let n=this,{mask:o,state:r}=n,{n:i}=r;return x(o,i+="--open"),u(e)&&(e=[e]),e.forEach((t=>x(o,i+"-"+t))),n.fire("exit"),t&&(o.focus(),n.fire("focus").fire("focus.self")),n},G.focus=function(){},z}));