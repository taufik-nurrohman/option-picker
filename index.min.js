/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},o=function(t,e){return t&&r(e)&&t instanceof e},i=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||o(t,Object))},r=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},s=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return f(e)}))},l=function(t){return t.toLowerCase()},f=function(t){return t.toUpperCase()},a=function(t){return t.length},c=function t(n){if(e(n))return n.map((function(e){return t(e)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(n))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(n);if(i(n)){for(var o in n)n[o]=t(n[o]);return n}return"false"!==n&&("null"===n?null:"true"===n||n)},d=function n(){for(var o=arguments.length,u=Array(o),s=0;s<o;s++)u[s]=arguments[s];for(var l=u.shift(),f=0,c=a(u);f<c;++f)for(var d in u[f])if(r(l[d]))if(e(l[d])&&e(u[f][d])){l[d]=[].concat(l[d]);for(var p=0,h=a(u[f][d]);p<h;++p)t(u[f][d][p],l[d])||l[d].push(u[f][d][p])}else i(l[d])&&i(u[f][d])?l[d]=n({},l[d],u[f][d]):l[d]=u[f][d];else l[d]=u[f][d];return l},p=function t(n){if(e(n))return n.map((function(e){return t(n)}));if(i(n)){for(var o in n)n[o]=t(n[o]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},h=document,v=window,_=h.body,m=h.documentElement,b=function(t,e){void 0===e&&(e=!0);for(var n,o=t.attributes,i={},r=0,u=o.length;r<u;++r)n=o[r].value,i[o[r].name]=e?c(n):n;return i},k=function(t,e,n){void 0===n&&(n=!0);var o=function(t,e,n){if(void 0===n&&(n=!0),!L(t,e))return null;var o=t.getAttribute(e);return n?c(o):o}(t,"data-"+e,n),i=(o+"").trim();return n&&i&&("["===i[0]&&"]"===i.slice(-1)||"{"===i[0]&&"}"===i.slice(-1))&&null!==(i=function(t){var e=null;try{e=JSON.parse(t)}catch(t){}return e}(o))?i:o},g=function(t,e){void 0===e&&(e=!0);var n="innerHTML";if(!C(t,n))return!1;var o=t[n];return""!==(o=e?o.trim():o)?o:null},y=function(t){return l(t&&t.nodeName||"")||null},x=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},w=function(t,e){return e?t.closest(e)||null:t.parentNode||null},E=function(t){var e="form";return C(t,e)&&e===y(t.form)?t.form:w(t,e)},T=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},A=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!C(t,n))return!1;var o=t[n];return""!==(o=e?o.trim():o)?o:null},L=function(t,e){return t.hasAttribute(e)},O=function(t,e){return t.classList.contains(e)},C=function(t,e){return e in t},S=function(t,e){return t.removeAttribute(e),t},j=function(t,e){return t.classList.remove(e),t},R=function(t,e){return t.style[s(e)]=null,t},N=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,p(n)),t},P=function(t,e){return t.append(e),e},B=function(t,e){return t.classList.add(e),t},H=function(t,e,n){return t=u(t)?h.createElement(t):t,i(e)&&(n=e,e=!1),u(e)&&I(t,e),i(n)&&function(t,e){var n;for(var o in e)(n=e[o])||""===n||0===n?N(t,o,n):S(t,o)}(t,n),t},I=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var o="innerHTML";return C(t,o)&&(t[o]=n?e.trim():e),t},z=function(t,e,n){return"number"==typeof n&&(n+="px"),t.style[s(e)]=p(n),t},D=function(t,e){var n;for(var o in e)(n=e[o])||""===n||0===n?z(t,o,n):R(t,o);return t},K=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var o="textContent";return C(t,o)&&(t[o]=n?e.trim():e),t},M=function(t,e){var n;return function(){var o=arguments,i=this;n&&clearTimeout(n),n=setTimeout((function(){return t.apply(i,o)}),e)}},U=function(t,e){return function(){var n=arguments,o=this;setTimeout((function(){return t.apply(o,n)}),e)}},F=function(t){var e,n,o,i,r,u,s;return!function(t){return t===v}(t)?(i=(n=t.getBoundingClientRect()).left,r=n.top,o=n.width,e=n.height,u=n.right,s=n.bottom):(i=t.pageXOffset||m.scrollLeft||_.scrollLeft,r=t.pageYOffset||m.scrollTop||_.scrollTop,o=t.innerWidth,e=t.innerHeight),[i,r,o,e,u,s]};var J=function(t,e,n){e.removeEventListener(t,n)},W=function(t){return t&&t.preventDefault()},X=function(t){return t&&t.stopPropagation()},Y=function(t,e,n,o){void 0===o&&(o=!1),e.addEventListener(t,n,o)};const $="ArrowDown",q="ArrowUp",G="Enter",Q="Escape",V="Tab",Z=M((t=>t.fit()),10),tt="OptionPicker";function et(t,e){let n,o=this,{self:i,state:r}=o,{n:u}=r;u+="__option",e=e||ot(i);for(let i in e){let r=e[i];"data-group"in r[1]?n||P(t,n=H("span",{class:u+"-group","data-value":r[1]["data-group"]})):n=!1;let{disabled:s,selected:l,value:f}=r[1],a=H("span",r[0],{class:u+(s?" "+u+"--disabled":"")+(l?" "+u+"--selected":""),"data-value":p(f||i),tabindex:!s&&-1});s||(Y("blur",a,at),Y("focus",a,ht),Y("keydown",a,kt),Y("mousedown",a,xt),Y("touchstart",a,xt)),a._of=r[2],a["_"+tt]=o,o._options[i]=a,P(n||t,a)}}function nt(t,e,n){Object.defineProperty(t,e,n)}function ot(t){const e={},n=it(t);let o,i=[];"input"===y(t)?(o=t.list,o=o?o.children:[]):o=t.children;for(let t=0,n=a(o);t<n;++t){let n=o[t],r=b(n);if(["disabled","selected"].forEach((e=>{e in r?(r[e]=""===r[e]||r[e],"selected"===e&&i.push(t)):r[e]=null})),"optgroup"!==y(n))e[n.value]=[A(n)||n.value,r,n];else{let t=ot(n);for(let o in t)t[o][1]["data-group"]=n.label,e[o]=t[o]}}return 0===a(i)&&e[n]&&(e[n][1].selected=!0),e}function it(t){return(t.value||"").replace(/\r/g,"")}function rt(t){return t.disabled}function ut(t){return t.readOnly}function st(t,e){const n=this;return t?o(n,st)?(t["_"+tt]=function(t,e){return(e=e||t).fire=function(t,e,n){var o=this,i=o.hooks;return r(i[t])?(i[t].forEach((function(t){return t.apply(n||o,e)})),o):o},e.off=function(t,e){var n=this,o=n.hooks;if(!r(t))return o={},n;if(r(o[t]))if(r(e)){var i=o[t].length;if(0===i)delete o[t];else for(var u=0;u<i;++u)if(e===o[t][u]){o[t].splice(u,1);break}}else delete o[t];return n},e.on=function(t,e){var n=this.hooks;return r(n[t])||(n[t]=[]),r(e)&&n[t].push(e),this},t.hooks={},t}(n,st.prototype),n.attach(t,d({},st.state,e||{}))):new st(t,e):n}st.state={n:"option-picker",options:null,with:[]},st.version="2.0.0",nt(st,"name",{value:tt});const lt=st.prototype;function ft(){let t=this,e=t["_"+tt],{state:n}=e,{n:o}=n;j(t,o+="--focus"),j(t,o+="-self")}function at(){let t=this["_"+tt],{mask:e,state:n}=t,{n:o}=n;j(e,o+"--focus-option")}function ct(){let t=this["_"+tt],{_mask:e,mask:n,state:o}=t,{text:i}=e,{n:r}=o;j(n,r+"--focus-text"),j(i,r+"__text--focus")}function dt(){let t=this,e=t["_"+tt],{_mask:n,self:o}=e,{hint:i}=n;U((()=>K(i,A(t,!1)?"":o.placeholder)),1)()}function pt(){let t=this,e=t["_"+tt],{state:n}=e,{n:o}=n;B(t,o+="--focus"),B(t,o+="-self")}function ht(){let t=this["_"+tt],{mask:e,state:n}=t,{n:o}=n;Ot(),B(e,o+"--focus-option")}function vt(){let t=this["_"+tt],{_mask:e,mask:n,state:o}=t,{text:i}=e,{n:r}=o;B(i,r+"__text--focus"),B(n,r+="--focus"),B(n,r+="-text"),Ct(this)}nt(lt,"value",{get:function(){let t=this.self.value;return""===t?null:t},set:function(t){this.fire("change")}});const _t=M(((e,n,o)=>{let i=l(A(n)||"");for(let e in o){let n=o[e],r=l(A(n)+"\t"+n);""===i||t(i,r)?S(n,"hidden"):N(n,"hidden","")}}),10);function mt(t){let e,n=this,o=t.key,i=n["_"+tt],{_mask:r,_options:u,self:s,state:l}=i,{hint:f}=r,{n:a}=l;if(a+="__option--disabled",U((()=>K(f,A(n,!1)?"":s.placeholder)),1)(),i.enter(),$===o||q===o||G===o){let t=u[s.value];if(!t||t.hidden)for(t=(c=u,Object.values(c)).shift();t&&(O(t,a)||t.hidden);)t=x(t);t&&t.focus(),e=!0}else V===o?i.exit():_t(i,n,u);var c;e&&(W(t),X(t))}function bt(t){let e,n=t.key,o=this["_"+tt];Q===n?o.exit(e=!0):$!==n&&q!==n&&G!==n&&" "!==n||o.enter(e=!0).fit(),e&&W(t)}function kt(t){let e,n=this,o=t.key;t.ctrlKey,t.shiftKey;let i,r,u,s=n["_"+tt],{_mask:l,_options:f,mask:a,self:c,state:d}=s,{hint:p,input:h,value:v}=l,{n:_}=d;if(_+="__option","Backspace"===o)e=!0,Ct(h);else if(G===o||Q===o||V===o||" "===o)Q!==o&&((u=f[c.value])&&(S(u._of,"selected"),j(u,_+"--selected")),N(n._of,"selected",""),B(n,_+"--selected"),"input"===y(c)?(K(p,""),K(h,A(n))):I(v,g(n)),c.value=k(n,"value")),s.exit(e=V!==o);else if($===o){for(e=!0,i=x(n);i&&(O(i,_+"--disabled")||i.hidden);)i=x(i);for(i?O(i,_+"-group")&&(i=i.firstElementChild||null):(r=w(n))&&O(r,_+"-group")&&(i=x(r));i&&(O(i,_+"--disabled")||i.hidden);)i=x(i);i&&i.focus()}else if(q===o){for(e=!0,u=T(n);u&&(O(u,_+"--disabled")||u.hidden);)u=T(u);for(u?O(u,_+"-group")&&(u=function(t){return t.lastElementChild||null}(u)):(r=w(n))&&O(r,_+"-group")&&(u=T(r));u&&(O(u,_+"--disabled")||u.hidden);)u=T(u);u?u.focus():Ct(h)}else e=!1,Ct(h);e&&(W(t),X(t))}function gt(){let t=this,e=t["_"+tt],{_mask:n,self:o}=e,{hint:i}=n;U((()=>K(t,A(t))))(),U((()=>K(i,A(t,!1)?"":o.placeholder)),1)()}function yt(t){let e=this["_"+tt],{state:n}=e,{n:o}=n;e[O(this,o+"--open")?"exit":"enter"](!0).fit(),W(t)}function xt(t){let e=this,n=e["_"+tt],{_mask:o,_options:i,self:r,state:u}=n,{hint:s,input:l,value:f}=o,{n:a}=u;a+="__option--selected";for(let t in i){let n=i[t];e!==n&&(S(n._of,"selected"),j(n,a))}N(e._of,"selected",""),B(e,a),"input"===y(r)?(K(s,""),K(l,A(e))):I(f,g(e)),r.value=k(e,"value"),W(t)}function wt(t){let e=this,n=e["_"+tt];if(!n)return;let{mask:o,state:i}=n,{n:r}=i,u=t.target;o!==u&&o!==w(u,"."+r)&&(n.exit(),delete e["_"+tt])}function Et(t){this["_"+tt].let().fire("reset",[t])}function Tt(){let t=this["_"+tt];t&&Z(t)}function At(){Tt.call(this)}function Lt(t){return this["_"+tt].fire("submit",[t])}function Ot(t){const e=h.getSelection();t||e.rangeCount&&e.removeRange(e.getRangeAt(0))}function Ct(t,e){const n=h.getSelection();Ot();const o=h.createRange();o.selectNodeContents(t),n.addRange(o),1===e?n.collapseToEnd():-1===e&&n.collapseToStart()}return lt.attach=function(t,o){let s=this;t=t||s.self,o=o||s.state,s._active=!rt(t)&&!ut(t),s._options={},s._value=it(t)||null,s.self=t,s.state=o;let l="input"===y(t),{n:f}=o;const c=H("span",{class:f+"__arrow"}),d=E(t),p=H("div",{class:f,tabindex:!rt(t)&&!l&&0});s.mask=p;const h=H("div",{class:f+"__options"});let{options:_}=o;if(e(_)){let t={};_.forEach((n=>{e(n)?(n[0]=n[0]??"",n[1]=n[1]??{},t[n[0]]=n):t[n]=[n,{}]})),_=t}else n(_)&&(_=_.call(s));if(i(_))for(let t in _)e(_[t])?(_[t][0]=_[t][0]??"",_[t][1]=_[t][1]??{}):_[t]=[_[t],{}];et.call(s,h,_);const b=H("div",{class:f+"__values"}),k=H("span",{class:f+"__"+(l?"text":"value")}),T=H("span",{contenteditable:!(rt(t)||ut(t)||!l)&&"",spellcheck:!!l&&"false"}),L=H("span",l?t.placeholder+"":"");var O,C;P(p,b),P(p,h),P(b,k),P(b,c),l?(P(k,T),P(k,L),Y("blur",T,ct),Y("cut",T,dt),Y("focus",T,vt),Y("keydown",T,mt),Y("paste",T,gt),T["_"+tt]=s):(Y("blur",p,ft),Y("focus",p,pt),Y("keydown",p,bt)),B(t,f+"__self"),C=p,w(O=t).insertBefore(C,x(O,!0)),d&&(d["_"+tt]=s,Y("reset",d,Et),Y("submit",d,Lt)),Y("mousedown",m,wt),Y("mousedown",p,yt),Y("resize",v,Tt),Y("scroll",v,At),Y("touchstart",m,wt),Y("touchstart",p,yt),t.tabIndex=-1,p["_"+tt]=s;let S,j={};if(j.hint=l?L:null,j.input=l?T:null,j.of=t,j.options=h,j.root=m,j.self=p,j[l?"text":"value"]=k,s._mask=j,(S=s._options[s._value])&&(N(S._of,"selected",""),l?(K(T,A(S)),A(T,!1)&&K(L,"")):I(k,g(S))),r(o)&&e(o.with))for(let e=0,r=a(o.with);e<r;++e){let r=o.with[e];u(r)&&(r=st[r]),n(r)?r.call(s,t,o):i(r)&&n(r.attach)&&r.attach.call(s,t,o)}return s},lt.blur=function(){},lt.detach=function(){let t=this,{_mask:o,mask:r,self:s,state:l}=t,{input:f}=o;const c=E(s);if(t._active=!1,t._value=it(s)||null,c&&(J("reset",c,Et),J("submit",c,Lt)),f&&(J("blur",f,ct),J("blur",r,ft),J("cut",f,dt),J("focus",f,vt),J("focus",r,pt),J("keydown",f,mt),J("keydown",r,bt),J("paste",f,gt)),J("mousedown",m,wt),J("mousedown",r,yt),J("resize",v,Tt),J("scroll",v,At),J("touchstart",m,wt),J("touchstart",r,yt),e(l.with))for(let e=0,o=a(l.with);e<o;++e){let o=l.with[e];u(o)&&(o=st[o]),i(o)&&n(o.detach)&&o.detach.call(t,s,l)}var d;return s.tabIndex=null,j(s,l.n+"__self"),w(d=r),d.remove(),t._mask={of:s},t.mask=null,t},lt.enter=function(t){let e,n=this,{_mask:o,_options:i,mask:r,self:u,state:s}=n,{input:l}=o,{n:f}=s;return B(r,f+="--open"),m["_"+tt]&&m["_"+tt]!==n&&m["_"+tt].exit(),m["_"+tt]=n,v["_"+tt]=n,n.fire("enter"),t&&(n.fire("focus"),"input"===y(u)?l.focus():(e=i[u.value])&&e.focus(),n.fire("focus.option")),n},lt.exit=function(t){let e=this,{_mask:n,mask:o,self:i,state:r}=e,{input:u}=n,{n:s}=r;return j(o,s+="--open"),e.fire("exit"),t&&("input"===y(i)?(u.focus(),Ct(u)):o.focus(),e.fire("focus").fire("focus.self")),e},lt.fit=function(){let{_mask:t,mask:e}=this,{options:n}=t,o=F(e),i=F(v);return o[1]+o[3]/2>i[3]/2?D(n,{bottom:"100%","max-height":o[1],top:"auto"}):D(n,{bottom:"auto","max-height":i[3]-o[1]-o[3],top:"100%"}),this},lt.focus=function(){},st}));