/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},r=function(t,e){return t&&o(e)&&t instanceof e},i=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||r(t,Object))},o=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},a=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return f(e)}))},s=function(t){return t.toLowerCase()},f=function(t){return t.toUpperCase()},l=function(t){return t.length},c=function(t){if(e(t))return t.map((function(t){return c(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(t))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(t);if(i(t)){for(var n in t)t[n]=c(t[n]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},v=function(){for(var n=arguments.length,r=Array(n),u=0;u<n;u++)r[u]=arguments[u];for(var a=r.shift(),s=0,f=l(r);s<f;++s)for(var c in r[s])if(o(a[c]))if(e(a[c])&&e(r[s][c])){a[c]=[].concat(a[c]);for(var d=0,p=l(r[s][c]);d<p;++d)t(r[s][c][d],a[c])||a[c].push(r[s][c][d])}else i(a[c])&&i(r[s][c])?a[c]=v({},a[c],r[s][c]):a[c]=r[s][c];else a[c]=r[s][c];return a},d=function(t){if(e(t))return t.map((function(e){return d(t)}));if(i(t)){for(var n in t)t[n]=d(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},p=document,h=window,_=p.body,m=p.documentElement,b=function(t,e,n){var r=function(t,e,n){if(void 0===n&&(n=!0),!L(t,e))return null;var r=t.getAttribute(e);return n?c(r):r}(t,"data-"+e,n);return r},g=function(t,e){void 0===e&&(e=!0);var n="innerHTML";if(!C(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},k=function(t){return s(t&&t.nodeName||"")||null},x=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},y=function(t,e){return e?t.closest(e)||null:t.parentNode||null},w=function(t){var e="form";return C(t,e)&&e===k(t[e])?t[e]:y(t,e)},E=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},A=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!C(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},L=function(t,e){return t.hasAttribute(e)},T=function(t,e){return t.classList.contains(e)},C=function(t,e){return e in t},O=function(t,e){return t.removeAttribute(e),t},j=function(t,e){return t.classList.remove(e),t},M=function(t,e){return t.style[a(e)]=null,t},R=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,d(n)),t},K=function(t,e){return t.append(e),e},P=function(t,e){return t.classList.add(e),t},S=function(t,e,n){return t=u(t)?p.createElement(t):t,i(e)&&(n=e,e=!1),u(e)&&z(t,e),i(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?R(t,r,n):O(t,r)}(t,n),t},z=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return C(t,r)&&(t[r]=n?e.trim():e),t},B=function(t,e,n){return"number"==typeof n&&(n+="px"),t.style[a(e)]=d(n),t},D=function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?B(t,r,n):M(t,r);return t},H=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="textContent";return C(t,r)&&(t[r]=n?e.trim():e),t},I=function(t,e){var n;return function(){var r=arguments,i=this;n&&clearTimeout(n),n=setTimeout((function(){return t.apply(i,r)}),e)}},N=function(t,e){return function(){var n=arguments,r=this;setTimeout((function(){return t.apply(r,n)}),e)}},U=function(t){var e,n,r,i,o,u,a;return!function(t){return t===h}(t)?(i=(n=t.getBoundingClientRect()).left,o=n.top,r=n.width,e=n.height,u=n.right,a=n.bottom):(i=t.pageXOffset||m.scrollLeft||_.scrollLeft,o=t.pageYOffset||m.scrollTop||_.scrollTop,r=t.innerWidth,e=t.innerHeight),[i,o,r,e,u,a]};var F=function(t,e,n){e.removeEventListener(t,n)},W=function(t){return t&&t.preventDefault()},X=function(t){return t&&t.stopPropagation()},Y=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)},$="ArrowDown",q="ArrowUp",G="Backspace",J="Enter",Q="Escape",V="Tab",Z=I((function(t){return t.fit()}),10),tt="OptionPicker";function et(t,e){var n,i=this,o=i.self,u=i.state.n;u+="__option",(e=r(e,Map)&&e.size>0?e:it(o)).forEach((function(e,r){"data-group"in e[1]?n||K(t,n=S("span",{class:u+"-group","data-value":e[1]["data-group"]})):n=!1;var o=e[1],a=o.disabled,s=o.selected,f=o.value,l=S("span",e[0],{class:u+(a?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":d(f||r),tabindex:!a&&-1});a||(Y("blur",l,vt),Y("focus",l,_t),Y("keydown",l,yt),Y("mousedown",l,At),Y("touchstart",l,At)),l._of=e[2],l["_"+tt]=i,i._options[r]=l,K(n||t,l)})),i.state.options=e}function nt(t,e,n){Object.defineProperty(t,e,n)}function rt(t){t.focus()}function it(t){var e,n,r=new Map,i=ot(t),o=[];n="input"===k(t)?(n=t.list)?n.children:[]:t.children;for(var u=function(t){var e=n[t],i=function(t,e){void 0===e&&(e=!0);for(var n,r=t.attributes,i={},o=0,u=r.length;o<u;++o)n=r[o].value,i[r[o].name]=e?c(n):n;return i}(e);if(["disabled","selected"].forEach((function(e){e in i?(i[e]=""===i[e]||i[e],"selected"===e&&o.push(t)):i[e]=null})),"optgroup"===k(e))return it(e).forEach((function(t,n){t[1]["data-group"]=e.label,r.set(n,t)})),1;r.set(e.value,[A(e)||e.value,i,e])},a=0,s=l(n);a<s;++a)u(a);return 0===l(o)&&(e=r.get(i))&&(e[1].selected=!0,r.set(i,e)),r}function ot(t){return(t.value||"").replace(/\r/g,"")}function ut(t){return t.disabled}function at(t){return t.readOnly}function st(t,e){var n=this;return t?r(n,st)?(t["_"+tt]=function(t,e){return(e=e||t).fire=function(t,e,n){var r=this,i=r.hooks;return o(i[t])?(i[t].forEach((function(t){return t.apply(n||r,e)})),r):r},e.off=function(t,e){var n=this,r=n.hooks;if(!o(t))return r={},n;if(o(r[t]))if(o(e)){var i=r[t].length;if(0===i)delete r[t];else for(var u=0;u<i;++u)if(e===r[t][u]){r[t].splice(u,1);break}}else delete r[t];return n},e.on=function(t,e){var n=this.hooks;return o(n[t])||(n[t]=[]),o(e)&&n[t].push(e),this},t.hooks={},t}(n,st.prototype),n.attach(t,v({},st.state,e||{}))):new st(t,e):n}st.state={n:"option-picker",options:null,with:[]},st.version="2.0.0",nt(st,"name",{value:tt});var ft=st.prototype;nt(ft,"value",{get:function(){var t=ot(this.self);return""===t?null:t},set:function(t){this.fire("change",[c(t)])}});var lt=I((function(e,n,r,i){var o=u(n)?n:A(n)||"",a=s(o),f=e._mask,v=e.self,d=e.state,p=f.value,h=d.n;if(h+="__option",i){var _,m=ot(v);for(var k in r){var x=r[k];O(x._of,"selected"),j(x,h+"--selected")}for(var y in r){var w=r[y],E=s(A(w)+"\t"+(_=b(w,"value",!1)));if(""!==a&&a===E.slice(0,l(a))){v.value=_,R(w._of,"selected",""),P(w,h+"--selected"),z(p,g(w)),_!==m&&e.fire("change",[c(_)]);break}}}else for(var L in r){var T=r[L],C=s(A(T)+"\t"+b(T,"value",!1));""===a||t(a,C)?O(T,"hidden"):R(T,"hidden","")}e.fire(i?"search":"filter",[o])}),10);function ct(){var t=this,e=t["_"+tt].state.n;j(t,e+="--focus"),j(t,e+="-self")}function vt(){var t=this["_"+tt],e=t.mask,n=t.state.n;j(e,n+"--focus-option")}function dt(){var t=this["_"+tt],e=t._mask,n=t.mask,r=t.state,i=e.text,o=r.n;j(n,o+"--focus-text"),j(i,o+"__text--focus")}function pt(){var t=this,e=t["_"+tt],n=e._mask,r=e.self,i=n.hint;N((function(){return H(i,A(t,!1)?"":r.placeholder)}),1)()}function ht(){var t=this,e=t["_"+tt].state.n;P(t,e+="--focus"),P(t,e+="-self")}function _t(){var t=this["_"+tt],e=t.mask,n=t.state.n;Mt(),P(e,n+="--focus"),P(e,n+="-option")}function mt(){var t=this["_"+tt],e=t._mask,n=t.mask,r=t.self,i=t.state,o=e.text,u=i.n;P(o,u+"__text--focus"),P(n,u+="--focus"),P(n,u+="-text"),ot(r)?Rt(this):t.enter(!0).fit()}function bt(t){var e,n,r=this,i=t.key,o=r["_"+tt],u=o._mask,a=o._options,s=o.self,f=o.state,l=u.hint,c=f.n;if(c+="__option--disabled",N((function(){return H(l,A(r,!1)?"":s.placeholder)}),1)(),o.enter().fit(),$===i||q===i||J===i){var v=a[ot(s)];if(!v||v.hidden)for(v=(n=a,Object.values(n)).shift();v&&(T(v,c)||v.hidden);)v=x(v);v&&rt(v),e=!0}else V===i?o.exit():lt(o,r,a);e&&(W(t),X(t))}var gt="",kt=I((function(){return gt=""}),500);function xt(t){var e,n=t.key,r=t.altKey,i=t.ctrlKey,o=this["_"+tt],u=o._options;kt(),G===n||"Delete"===n?gt="":Q===n?(gt="",o.exit(e=!0)):V===n?(gt="",o.exit(!(e=!1))):$===n||q===n||J===n||""===gt&&" "===n?o.enter(e=!0).fit():1!==l(n)||r||i||(gt+=n),""!==gt&&lt(o,gt,u,e=!0),e&&W(t)}function yt(t){var e,n=this,r=t.key,i=t.altKey,o=t.ctrlKey,u=n["_"+tt],a=u._mask,s=u._options;u.mask;var f=u.self,v=u.state,d=a.hint,p=a.input,h=a.value,_=v.n;_+="__option";var m,w,L,C="input"===k(f);if(G===r)u.exit(e=!0);else if(J===r||Q===r||V===r||" "===r){if(Q!==r){var M,K=ot(f);(L=s[ot(f)])&&(O(L._of,"selected"),j(L,_+"--selected")),R(n._of,"selected",""),P(n,_+"--selected"),C?(H(d,""),H(p,A(n))):z(h,g(n)),f.value=M=b(n,"value",!1),M!==K&&u.fire("change",[c(M)])}u.exit(e=V!==r)}else if($===r){for(e=!0,m=x(n);m&&(T(m,_+"--disabled")||m.hidden);)m=x(m);for(m?T(m,_+"-group")&&(m=m.firstElementChild||null):(w=y(n))&&T(w,_+"-group")&&(m=x(w));m&&(T(m,_+"--disabled")||m.hidden);)m=x(m);m&&rt(m)}else if(q===r){for(e=!0,L=E(n);L&&(T(L,_+"--disabled")||L.hidden);)L=E(L);for(L?T(L,_+"-group")&&(L=function(t){return t.lastElementChild||null}(L)):(w=y(n))&&T(w,_+"-group")&&(L=E(w));L&&(T(L,_+"--disabled")||L.hidden);)L=E(L);L?rt(L):C?(rt(p),Rt(p)):u.exit(e)}else C&&1===l(r)&&!i&&!o&&H(d,""),u.exit(!(e=!1));e&&(W(t),X(t))}function wt(){var t=this,e=t["_"+tt],n=e._mask,r=e.self,i=n.hint;N((function(){return H(t,A(t))}))(),N((function(){return H(i,A(t,!1)?"":r.placeholder)}),1)()}function Et(t){var e=this["_"+tt],n=e.state.n;e[T(this,n+"--open")?"exit":"enter"](!0).fit(),W(t)}function At(t){var e=this,n=e["_"+tt],r=n._mask,i=n._options,o=n.self,u=n.state,a=r.hint,s=r.input,f=r.value,l=u.n;l+="__option--selected";var v,d=ot(o);for(var p in i){var h=i[p];e!==h&&(O(h._of,"selected"),j(h,l))}R(e._of,"selected",""),P(e,l),"input"===k(o)?(H(a,""),H(s,A(e))):z(f,g(e)),o.value=v=b(e,"value",!1),v!==d&&n.fire("change",[c(v)]),W(t)}function Lt(t){var e=this["_"+tt];if(e){var n=e.mask,r=e.state.n,i=t.target;n!==i&&n!==y(i,"."+r)&&(e.exit(),delete this["_"+tt])}}function Tt(t){this["_"+tt].let().fire("reset",[t])}function Ct(){var t=this["_"+tt];t&&Z(t)}function Ot(){Ct.call(this)}function jt(t){return this["_"+tt].fire("submit",[t])}function Mt(t){var e=p.getSelection();e.rangeCount&&e.removeRange(e.getRangeAt(0))}function Rt(t,e){var n=p.getSelection();Mt();var r=p.createRange();r.selectNodeContents(t),n.addRange(r)}return ft.attach=function(t,r){var a=this;t=t||a.self,r=r||a.state,a._active=!ut(t)&&!at(t),a._options={},a._value=ot(t)||null,a.self=t,a.state=r;var s="input"===k(t),f=r.n,c=S("span",{class:f+"__arrow"}),v=w(t),d=S("div",{class:f,tabindex:!ut(t)&&!s&&0});a.mask=d;var p=S("div",{class:f+"__options"}),_=r.options;n(_)&&(_=_.call(a));var b=new Map;if(e(_))_.forEach((function(t){var n,r;e(t)?(t[0]=null!=(n=t[0])?n:"",t[1]=null!=(r=t[1])?r:{},b.set(t[0],t)):b.set(t,[t,{}])}));else if(i(_))for(var E in _){var L,T;if(e(_[E]))_[E][0]=null!=(L=_[E][0])?L:"",_[E][1]=null!=(T=_[E][1])?T:{};else b.set(E,[_[E],{}])}et.call(a,p,_=b);var C,O,j=S("div",{class:f+"__values"}),M=S("span",{class:f+"__"+(s?"text":"value")}),B=S("span",{contenteditable:!(ut(t)||at(t)||!s)&&"",spellcheck:!!s&&"false"}),D=S("span",s?t.placeholder+"":"");K(d,j),K(d,p),K(j,M),K(j,c),s?(K(M,B),K(M,D),Y("blur",B,dt),Y("cut",B,pt),Y("focus",B,mt),Y("keydown",B,bt),Y("paste",B,wt),B["_"+tt]=a):(Y("blur",d,ct),Y("focus",d,ht),Y("keydown",d,xt)),P(t,f+"__self"),O=d,y(C=t).insertBefore(O,x(C,!0)),v&&(v["_"+tt]=a,Y("reset",v,Tt),Y("submit",v,jt)),Y("mousedown",m,Lt),Y("mousedown",d,Et),Y("resize",h,Ct),Y("scroll",h,Ot),Y("touchstart",m,Lt),Y("touchstart",d,Et),t.tabIndex=-1,d["_"+tt]=a;var I,N={};if(N.hint=s?D:null,N.input=s?B:null,N.of=t,N.options=p,N.root=m,N.self=d,N[s?"text":"value"]=M,a._mask=N,(I=a._options[a._value])&&(R(I._of,"selected",""),s?(H(B,A(I)),A(B,!1)&&H(D,"")):z(M,g(I))),o(r)&&e(r.with))for(var U=0,F=l(r.with);U<F;++U){var W=r.with[U];u(W)&&(W=st[W]),n(W)?W.call(a,t,r):i(W)&&n(W.attach)&&W.attach.call(a,t,r)}return a},ft.blur=function(){},ft.detach=function(){var t,r=this,o=r._mask,a=r.mask,s=r.self,f=r.state,c=o.input,v=w(s);if(r._active=!1,r._value=ot(s)||null,v&&(F("reset",v,Tt),F("submit",v,jt)),c&&(F("blur",c,dt),F("blur",a,ct),F("cut",c,pt),F("focus",c,mt),F("focus",a,ht),F("keydown",c,bt),F("keydown",a,xt),F("paste",c,wt)),F("mousedown",m,Lt),F("mousedown",a,Et),F("resize",h,Ct),F("scroll",h,Ot),F("touchstart",m,Lt),F("touchstart",a,Et),e(f.with))for(var d=0,p=l(f.with);d<p;++d){var _=f.with[d];u(_)&&(_=st[_]),i(_)&&n(_.detach)&&_.detach.call(r,s,f)}return s.tabIndex=null,j(s,f.n+"__self"),y(t=a),t.remove(),r._mask={of:s},r.mask=null,r},ft.enter=function(t){var e,n=this,r=n._mask,i=n._options,o=n.mask,u=n.self,a=n.state,s=r.input,f=a.n;return P(o,f+="--open"),m["_"+tt]&&m["_"+tt]!==n&&m["_"+tt].exit(),m["_"+tt]=n,h["_"+tt]=n,n.fire("enter"),t&&(n.fire("focus"),"input"===k(u)?(rt(s),Rt(s)):(e=i[ot(u)])&&rt(e),n.fire("focus.option")),n},ft.exit=function(t){var e=this,n=e._mask,r=e.mask,i=e.self,o=e.state,u=n.input,a=o.n;return j(r,a+="--open"),e.fire("exit"),t&&("input"===k(i)?(rt(u),Rt(u)):rt(r),e.fire("focus").fire("focus.self")),e},ft.fit=function(){var t=this,e=t._mask,n=t.mask,r=e.options,i=U(n),o=U(h);return i[1]+i[3]/2>o[3]/2?D(r,{bottom:"100%","max-height":i[1],top:"auto"}):D(r,{bottom:"auto","max-height":o[3]-i[1]-i[3],top:"100%"}),t},ft.focus=function(){},st}));