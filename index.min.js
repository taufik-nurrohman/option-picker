/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OptionPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},r=function(t,e){return t&&o(e)&&t instanceof e},i=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||r(t,Object))},o=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},u=function(t){return"string"==typeof t},l=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return f(e)}))},s=function(t){return t.toLowerCase()},f=function(t){return t.toUpperCase()},a=function(t){return t.length},c=function t(n){if(e(n))return n.map((function(e){return t(e)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(n))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(n);if(i(n)){for(var r in n)n[r]=t(n[r]);return n}return"false"!==n&&("null"===n?null:"true"===n||n)},d=function n(){for(var r=arguments.length,u=Array(r),l=0;l<r;l++)u[l]=arguments[l];for(var s=u.shift(),f=0,c=a(u);f<c;++f)for(var d in u[f])if(o(s[d]))if(e(s[d])&&e(u[f][d])){s[d]=[].concat(s[d]);for(var p=0,h=a(u[f][d]);p<h;++p)t(u[f][d][p],s[d])||s[d].push(u[f][d][p])}else i(s[d])&&i(u[f][d])?s[d]=n({},s[d],u[f][d]):s[d]=u[f][d];else s[d]=u[f][d];return s},p=function t(n){if(e(n))return n.map((function(e){return t(n)}));if(i(n)){for(var r in n)n[r]=t(n[r]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},h=document,_=window,v=h.body,m=h.documentElement,b=function(t,e){void 0===e&&(e=!0);for(var n,r=t.attributes,i={},o=0,u=r.length;o<u;++o)n=r[o].value,i[r[o].name]=e?c(n):n;return i},k=function(t,e,n){void 0===n&&(n=!0);var r=function(t,e,n){if(void 0===n&&(n=!0),!T(t,e))return null;var r=t.getAttribute(e);return n?c(r):r}(t,"data-"+e,n),i=(r+"").trim();return n&&i&&("["===i[0]&&"]"===i.slice(-1)||"{"===i[0]&&"}"===i.slice(-1))&&null!==(i=function(t){var e=null;try{e=JSON.parse(t)}catch(t){}return e}(r))?i:r},g=function(t,e){void 0===e&&(e=!0);var n="innerHTML";if(!C(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},y=function(t){return s(t&&t.nodeName||"")||null},x=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},w=function(t,e){return e?t.closest(e)||null:t.parentNode||null},E=function(t){var e="form";return C(t,e)&&e===y(t.form)?t.form:w(t,e)},L=function(t,e){return t["previous"+(e?"":"Element")+"Sibling"]||null},O=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!C(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},T=function(t,e){return t.hasAttribute(e)},A=function(t,e){return t.classList.contains(e)},C=function(t,e){return e in t},P=function(t,e){return t.removeAttribute(e),t},H=function(t,e){return t.classList.remove(e),t},I=function(t,e){return t.style[l(e)]=null,t},N=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,p(n)),t},S=function(t,e){return t.append(e),e},z=function(t,e){return t.classList.add(e),t},B=function(t,e,n){return t=u(t)?h.createElement(t):t,i(e)&&(n=e,e=!1),u(e)&&D(t,e),i(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?N(t,r,n):P(t,r)}(t,n),t},D=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return C(t,r)&&(t[r]=n?e.trim():e),t},K=function(t,e,n){return"number"==typeof n&&(n+="px"),t.style[l(e)]=p(n),t},M=function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?K(t,r,n):I(t,r);return t},U=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="textContent";return C(t,r)&&(t[r]=n?e.trim():e),t},F=function(t,e){var n;return function(){var r=arguments,i=this;n&&clearTimeout(n),n=setTimeout((function(){return t.apply(i,r)}),e)}},J=function(t,e){return function(){var n=arguments,r=this;setTimeout((function(){return t.apply(r,n)}),e)}},R=function(t){var e,n,r,i,o,u,l;return!function(t){return t===_}(t)?(i=(n=t.getBoundingClientRect()).left,o=n.top,r=n.width,e=n.height,u=n.right,l=n.bottom):(i=t.pageXOffset||m.scrollLeft||v.scrollLeft,o=t.pageYOffset||m.scrollTop||v.scrollTop,r=t.innerWidth,e=t.innerHeight),[i,o,r,e,u,l]};var W=function(t,e,n){e.removeEventListener(t,n)},X=function(t){return t&&t.preventDefault()},Y=function(t){return t&&t.stopPropagation()},$=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)};const q="ArrowDown",G="ArrowUp",Q="Enter",V="Escape",Z="Tab",tt=F((t=>t.fit()),10),et="OptionPicker";function nt(t,e){let n,r=this,{self:i,state:o}=r,{n:u}=o;u+="__option",e=e||it(i);for(let i in e){let o=e[i];"data-group"in o[1]?n||S(t,n=B("span",{class:u+"-group","data-value":o[1]["data-group"]})):n=!1;let{disabled:l,selected:s,value:f}=o[1],a=B("span",o[0],{class:u+(l?" "+u+"--disabled":"")+(s?" "+u+"--selected":""),"data-value":p(f||i),tabindex:!l&&-1});l||($("blur",a,ct),$("focus",a,_t),$("keydown",a,gt),$("mousedown",a,wt),$("touchstart",a,wt)),a._of=o[2],a["_"+et]=r,r._options[i]=a,S(n||t,a)}}function rt(t,e,n){Object.defineProperty(t,e,n)}function it(t){const e={},n=ot(t);let r,i=[];"input"===y(t)?(r=t.list,r=r?r.children:[]):r=t.children;for(let t=0,n=a(r);t<n;++t){let n=r[t],o=b(n);if(["disabled","selected"].forEach((e=>{e in o?(o[e]=""===o[e]||o[e],"selected"===e&&i.push(t)):o[e]=null})),"optgroup"!==y(n))e[n.value]=[O(n)||n.value,o,n];else{let t=it(n);for(let r in t)t[r][1]["data-group"]=n.label,e[r]=t[r]}}return 0===a(i)&&e[n]&&(e[n][1].selected=!0),e}function ot(t){return(t.value||"").replace(/\r/g,"")}function ut(t){return t.disabled}function lt(t){return t.readOnly}function st(t,e){const n=this;return t?r(n,st)?(t["_"+et]=function(t){var e={};return t.hooks=e,t.fire=function(n,r){return o(e[n])?(e[n].forEach((function(e){return e.apply(t,r)})),t):t},t.off=function(n,r){if(!o(n))return e={},t;if(o(e[n]))if(o(r)){for(var i=0,u=e[n].length;i<u;++i)if(r===e[n][i]){e[n].splice(i,1);break}0===j&&delete e[n]}else delete e[n];return t},t.on=function(n,r){return o(e[n])||(e[n]=[]),o(r)&&e[n].push(r),t},t}(n),n.attach(t,d({},st.state,e||{}))):new st(t,e):n}st.state={n:"option-picker",options:null,with:[]},st.version="2.0.0",rt(st,"name",{value:et});const ft=st.prototype;function at(){let t=this,e=t["_"+et],{state:n}=e,{n:r}=n;H(t,r+="--focus"),H(t,r+="-self")}function ct(){let t=this["_"+et],{mask:e,state:n}=t,{n:r}=n;H(e,r+"--focus-option")}function dt(){let t=this["_"+et],{_mask:e,mask:n,state:r}=t,{text:i}=e,{n:o}=r;H(n,o+"--focus-text"),H(i,o+"__text--focus")}function pt(){let t=this,e=t["_"+et],{_mask:n,self:r}=e,{hint:i}=n;J((()=>U(i,O(t,!1)?"":r.placeholder)),1)()}function ht(){let t=this,e=t["_"+et],{state:n}=e,{n:r}=n;z(t,r+="--focus"),z(t,r+="-self")}function _t(){let t=this["_"+et],{mask:e,state:n}=t,{n:r}=n;z(e,r+"--focus-option")}function vt(){let t=this["_"+et],{_mask:e,mask:n,state:r}=t,{text:i}=e,{n:o}=r;z(i,o+"__text--focus"),z(n,o+="--focus"),z(n,o+="-text")}rt(ft,"value",{get:function(){let t=this.self.value;return""===t?null:t},set:function(t){this.fire("change")}});const mt=F(((e,n,r)=>{let i=s(O(n)||"");for(let e in r){let n=r[e],o=s(O(n)+"\t"+n);""===i||t(i,o)?P(n,"hidden"):N(n,"hidden","")}}),10);function bt(t){let e,n=this,r=t.key,i=n["_"+et],{_mask:o,_options:u,self:l,state:s}=i,{hint:f}=o,{n:a}=s;if(a+="__option--disabled",J((()=>U(f,O(n,!1)?"":l.placeholder)),1)(),i.enter(),q===r||G===r||Q===r){let t=u[l.value];if(t.hidden)for(t=(c=u,Object.values(c)).shift();t&&(A(t,a)||t.hidden);)t=x(t);t&&t.focus(),e=!0}else Z===r?i.exit():mt(i,n,u);var c;e&&(X(t),Y(t))}function kt(t){let e,n=t.key,r=this["_"+et];V===n?r.exit(e=!0):q!==n&&G!==n&&Q!==n&&" "!==n||r.enter(e=!0).fit(),e&&X(t)}function gt(t){let e,n=this,r=t.key;t.ctrlKey,t.shiftKey;let i,o,u,l=n["_"+et],{_mask:s,_options:f,mask:a,self:c,state:d}=l,{hint:p,input:h,value:_}=s,{n:v}=d;if(v+="__option",Q===r||V===r||Z===r||" "===r)V!==r&&(u=f[c.value])&&(P(u._of,"selected"),H(u,v+"--selected"),N(n._of,"selected",""),z(n,v+"--selected"),"input"===y(c)?(U(p,""),U(h,O(n))):D(_,g(n)),c.value=k(n,"value")),l.exit(e=Z!==r);else if(q===r){for(e=!0,i=x(n);i&&(A(i,v+"--disabled")||i.hidden);)i=x(i);for(i?A(i,v+"-group")&&(i=i.firstElementChild||null):(o=w(n))&&A(o,v+"-group")&&(i=x(o));i&&(A(i,v+"--disabled")||i.hidden);)i=x(i);i&&i.focus()}else if(G===r){for(e=!0,u=L(n);u&&(A(u,v+"--disabled")||u.hidden);)u=L(u);for(u?A(u,v+"-group")&&(u=function(t){return t.lastElementChild||null}(u)):(o=w(n))&&A(o,v+"-group")&&(u=L(o));u&&(A(u,v+"--disabled")||u.hidden);)u=L(u);u&&u.focus()}e&&(X(t),Y(t))}function yt(){let t=this,e=t["_"+et],{_mask:n,self:r}=e,{hint:i}=n;J((()=>U(t,O(t))))(),J((()=>U(i,O(t,!1)?"":r.placeholder)),1)()}function xt(t){let e=this["_"+et],{state:n}=e,{n:r}=n;e[A(this,r+"--open")?"exit":"enter"](!0).fit(),X(t)}function wt(t){let e=this,n=e["_"+et],{_mask:r,_options:i,self:o,state:u}=n,{hint:l,input:s,value:f}=r,{n:a}=u;a+="__option--selected";for(let t in i){let n=i[t];e!==n&&(P(n._of,"selected"),H(n,a))}N(e._of,"selected",""),z(e,a),"input"===y(o)?(U(l,""),U(s,O(e))):D(f,g(e)),o.value=k(e,"value"),X(t)}function Et(t){let e=this,n=e["_"+et];if(!n)return;let{mask:r,state:i}=n,{n:o}=i,u=t.target;r!==u&&r!==w(u,"."+o)&&(n.exit(),delete e["_"+et])}function Lt(t){this["_"+et].let().fire("reset",[t])}function Ot(){let t=this["_"+et];t&&tt(t)}function Tt(){Ot.call(this)}function At(t){return this["_"+et].fire("submit",[t])}return ft.attach=function(t,r){let l=this;t=t||l.self,r=r||l.state,l._active=!ut(t)&&!lt(t),l._options={},l._value=ot(t)||null,l.self=t,l.state=r;let s="input"===y(t),{n:f}=r;const c=B("span",{class:f+"__arrow"}),d=E(t),p=B("div",{class:f,tabindex:!ut(t)&&!s&&0});l.mask=p;const h=B("div",{class:f+"__options"});let{options:v}=r;n(v)&&(v=v.call(l)),nt.call(l,h,v);const b=B("div",{class:f+"__values"}),k=B("span",{class:f+"__"+(s?"text":"value")}),L=B("span",{contenteditable:!(ut(t)||lt(t)||!s)&&"",spellcheck:!!s&&"false"}),T=B("span",s?t.placeholder+"":"");var A,C;S(p,b),S(p,h),S(b,k),S(b,c),s?(S(k,L),S(k,T),$("blur",L,dt),$("cut",L,pt),$("focus",L,vt),$("keydown",L,bt),$("paste",L,yt),L["_"+et]=l):($("blur",p,at),$("focus",p,ht),$("keydown",p,kt)),z(t,f+"__self"),C=p,w(A=t).insertBefore(C,x(A,!0)),d&&(d["_"+et]=l,$("reset",d,Lt),$("submit",d,At)),$("mousedown",m,Et),$("mousedown",p,xt),$("resize",_,Ot),$("scroll",_,Tt),$("touchstart",m,Et),$("touchstart",p,xt),t.tabIndex=-1,p["_"+et]=l;let j,P={};if(P.hint=s?T:null,P.input=s?L:null,P.of=t,P.options=h,P.root=m,P.self=p,P[s?"text":"value"]=k,l._mask=P,(j=l._options[l._value])&&(N(j._of,"selected",""),s?(U(L,O(j)),O(L,!1)&&U(T,"")):D(k,g(j))),o(r)&&e(r.with))for(let e=0,o=a(r.with);e<o;++e){let o=r.with[e];u(o)&&(o=st[o]),n(o)?o.call(l,t,r):i(o)&&n(o.attach)&&o.attach.call(l,t,r)}return l},ft.blur=function(){},ft.detach=function(){let t=this,{_mask:r,mask:o,self:l,state:s}=t,{input:f}=r;const c=E(l);if(t._active=!1,t._value=ot(l)||null,c&&(W("reset",c,Lt),W("submit",c,At)),f&&(W("blur",f,dt),W("blur",o,at),W("cut",f,pt),W("focus",f,vt),W("focus",o,ht),W("keydown",f,bt),W("keydown",o,kt),W("paste",f,yt)),W("mousedown",m,Et),W("mousedown",o,xt),W("resize",_,Ot),W("scroll",_,Tt),W("touchstart",m,Et),W("touchstart",o,xt),e(s.with))for(let e=0,r=a(s.with);e<r;++e){let r=s.with[e];u(r)&&(r=st[r]),i(r)&&n(r.detach)&&r.detach.call(t,l,s)}var d;return l.tabIndex=null,H(l,s.n+"__self"),w(d=o),d.remove(),t._mask={of:l},t.mask=null,t},ft.enter=function(t){let e,n=this,{_mask:r,_options:i,mask:o,self:u,state:l}=n,{input:s}=r,{n:f}=l;return z(o,f+="--open"),m["_"+et]&&m["_"+et]!==n&&m["_"+et].exit(),m["_"+et]=n,_["_"+et]=n,n.fire("enter"),t&&(n.fire("focus"),"input"===y(u)?s.focus():(e=i[u.value])&&e.focus(),n.fire("focus.option")),n},ft.exit=function(t){let e=this,{_mask:n,mask:r,self:i,state:o}=e,{input:u}=n,{n:l}=o;return H(r,l+="--open"),e.fire("exit"),t&&("input"===y(i)?u.focus():r.focus(),e.fire("focus").fire("focus.self")),e},ft.fit=function(){let{_mask:t,mask:e}=this,{options:n}=t,r=R(e),i=R(_);return r[1]+r[3]/2>i[3]/2?M(n,{bottom:"100%","max-height":r[1],top:"auto"}):M(n,{bottom:"auto","max-height":i[3]-r[1]-r[3],top:"100%"}),this},ft.focus=function(){},st}));